<!DOCTYPE html>
<html style="display: none;" lang="zh">
    <head><meta name="generator" content="Hexo 3.8.0">
    <meta charset="utf-8">
    <!--
        © Material Theme
        https://github.com/viosey/hexo-theme-material
        Version: 1.5.6 -->
    <script>
        window.materialVersion = "1.5.6"
        // Delete localstorage with these tags
        window.oldVersion = [
            'codestartv1',
            '1.3.4',
            '1.4.0',
            '1.4.0b1',
            '1.5.0',
            '1.5.2',
            '1.5.5'
        ]
    </script>

    <!-- dns prefetch -->
    <meta http-equiv="x-dns-prefetch-control" content="on">









    <link rel="dns-prefetch" href="https://fonts.googleapis.com">





    <!-- Meta & Info -->
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta name="renderer" content="webkit">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!-- Title -->
    
    <title>
        
            线程知识 | 
        
        WarmCute&#39;s Blog
    </title>

    <!-- Favicons -->
    <link rel="icon shortcut" type="image/ico" href="/img/favicon.png">
    <link rel="icon" href="/img/favicon.png">

    <meta name="format-detection" content="telephone=no">
    <meta name="description" itemprop="description" content>
    <meta name="keywords" content>
    <meta name="theme-color" content="#0097A7">

    <!-- Disable Fucking Bloody Baidu Tranformation -->
    <meta http-equiv="Cache-Control" content="no-transform">
    <meta http-equiv="Cache-Control" content="no-siteapp">

    <!--[if lte IE 9]>
        <link rel="stylesheet" href="/css/ie-blocker.css">

        
            <script src="/js/ie-blocker.zhCN.js"></script>
        
    <![endif]-->

    <!-- Import lsloader -->
    <script>(function(){window.lsloader={jsRunSequence:[],jsnamemap:{},cssnamemap:{}};lsloader.removeLS=function(a){try{localStorage.removeItem(a)}catch(b){}};lsloader.setLS=function(a,c){try{localStorage.setItem(a,c)}catch(b){}};lsloader.getLS=function(a){var c="";try{c=localStorage.getItem(a)}catch(b){c=""}return c};versionString="/*"+(window.materialVersion||"unknownVersion")+"*/";lsloader.clean=function(){try{var b=[];for(var a=0;a<localStorage.length;a++){b.push(localStorage.key(a))}b.forEach(function(e){var f=lsloader.getLS(e);if(window.oldVersion){var d=window.oldVersion.reduce(function(g,h){return g||f.indexOf("/*"+h+"*/")!==-1},false);if(d){lsloader.removeLS(e)}}})}catch(c){}};lsloader.clean();lsloader.load=function(f,a,b,d){if(typeof b==="boolean"){d=b;b=undefined}d=d||false;b=b||function(){};var e;e=this.getLS(f);if(e&&e.indexOf(versionString)===-1){this.removeLS(f);this.requestResource(f,a,b,d);return}if(e){var c=e.split(versionString)[0];if(c!=a){console.log("reload:"+a);this.removeLS(f);this.requestResource(f,a,b,d);return}e=e.split(versionString)[1];if(d){this.jsRunSequence.push({name:f,code:e});this.runjs(a,f,e)}else{document.getElementById(f).appendChild(document.createTextNode(e));b()}}else{this.requestResource(f,a,b,d)}};lsloader.requestResource=function(b,e,a,c){var d=this;if(c){this.iojs(e,b,function(h,f,g){d.setLS(f,h+versionString+g);d.runjs(h,f,g)})}else{this.iocss(e,b,function(f){document.getElementById(b).appendChild(document.createTextNode(f));d.setLS(b,e+versionString+f)},a)}};lsloader.iojs=function(d,b,g){var a=this;a.jsRunSequence.push({name:b,code:""});try{var f=new XMLHttpRequest();f.open("get",d,true);f.onreadystatechange=function(){if(f.readyState==4){if((f.status>=200&&f.status<300)||f.status==304){if(f.response!=""){g(d,b,f.response);return}}a.jsfallback(d,b)}};f.send(null)}catch(c){a.jsfallback(d,b)}};lsloader.iocss=function(f,c,h,a){var b=this;try{var g=new XMLHttpRequest();g.open("get",f,true);g.onreadystatechange=function(){if(g.readyState==4){if((g.status>=200&&g.status<300)||g.status==304){if(g.response!=""){h(g.response);a();return}}b.cssfallback(f,c,a)}};g.send(null)}catch(d){b.cssfallback(f,c,a)}};lsloader.iofonts=function(f,c,h,a){var b=this;try{var g=new XMLHttpRequest();g.open("get",f,true);g.onreadystatechange=function(){if(g.readyState==4){if((g.status>=200&&g.status<300)||g.status==304){if(g.response!=""){h(g.response);a();return}}b.cssfallback(f,c,a)}};g.send(null)}catch(d){b.cssfallback(f,c,a)}};lsloader.runjs=function(f,c,e){if(!!c&&!!e){for(var b in this.jsRunSequence){if(this.jsRunSequence[b].name==c){this.jsRunSequence[b].code=e}}}if(!!this.jsRunSequence[0]&&!!this.jsRunSequence[0].code&&this.jsRunSequence[0].status!="failed"){var a=document.createElement("script");a.appendChild(document.createTextNode(this.jsRunSequence[0].code));a.type="text/javascript";document.getElementsByTagName("head")[0].appendChild(a);this.jsRunSequence.shift();if(this.jsRunSequence.length>0){this.runjs()}}else{if(!!this.jsRunSequence[0]&&this.jsRunSequence[0].status=="failed"){var d=this;var a=document.createElement("script");a.src=this.jsRunSequence[0].path;a.type="text/javascript";this.jsRunSequence[0].status="loading";a.onload=function(){d.jsRunSequence.shift();if(d.jsRunSequence.length>0){d.runjs()}};document.body.appendChild(a)}}};lsloader.tagLoad=function(b,a){this.jsRunSequence.push({name:a,code:"",path:b,status:"failed"});this.runjs()};lsloader.jsfallback=function(c,b){if(!!this.jsnamemap[b]){return}else{this.jsnamemap[b]=b}for(var a in this.jsRunSequence){if(this.jsRunSequence[a].name==b){this.jsRunSequence[a].code="";this.jsRunSequence[a].status="failed";this.jsRunSequence[a].path=c}}this.runjs()};lsloader.cssfallback=function(e,c,b){if(!!this.cssnamemap[c]){return}else{this.cssnamemap[c]=1}var d=document.createElement("link");d.type="text/css";d.href=e;d.rel="stylesheet";d.onload=d.onerror=b;var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(d,a)};lsloader.runInlineScript=function(c,b){var a=document.getElementById(b).innerText;this.jsRunSequence.push({name:c,code:a});this.runjs()}})();</script>

    <!-- Import queue -->
    <script>function Queue(){this.dataStore=[];this.offer=b;this.poll=d;this.execNext=a;this.debug=false;this.startDebug=c;function b(e){if(this.debug){console.log("Offered a Queued Function.")}if(typeof e==="function"){this.dataStore.push(e)}else{console.log("You must offer a function.")}}function d(){if(this.debug){console.log("Polled a Queued Function.")}return this.dataStore.shift()}function a(){var e=this.poll();if(e!==undefined){if(this.debug){console.log("Run a Queued Function.")}e()}}function c(){this.debug=true}}var queue=new Queue();</script>

    <!-- Import CSS -->
    
        <style id="material_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("material_css","/css/material.min.css?Z7a72R1E4SxzBKR/WGctOA==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>
        <style id="style_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("style_css","/css/style.min.css?NKhlKQkXw/c66TR5p4wO+w==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>

        

    

    

    <!-- Config CSS -->

<!-- Other Styles -->
<style>
  body, html {
    font-family: Roboto, "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "微软雅黑", Arial, sans-serif;
    overflow-x: hidden !important;
  }
  
  code {
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  }

  a {
    color: #00838F;
  }

  .mdl-card__media,
  #search-label,
  #search-form-label:after,
  #scheme-Paradox .hot_tags-count,
  #scheme-Paradox .sidebar_archives-count,
  #scheme-Paradox .sidebar-colored .sidebar-header,
  #scheme-Paradox .sidebar-colored .sidebar-badge{
    background-color: #0097A7 !important;
  }

  /* Sidebar User Drop Down Menu Text Color */
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:hover,
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:focus {
    color: #0097A7 !important;
  }

  #post_entry-right-info,
  .sidebar-colored .sidebar-nav li:hover > a,
  .sidebar-colored .sidebar-nav li:hover > a i,
  .sidebar-colored .sidebar-nav li > a:hover,
  .sidebar-colored .sidebar-nav li > a:hover i,
  .sidebar-colored .sidebar-nav li > a:focus i,
  .sidebar-colored .sidebar-nav > .open > a,
  .sidebar-colored .sidebar-nav > .open > a:hover,
  .sidebar-colored .sidebar-nav > .open > a:focus,
  #ds-reset #ds-ctx .ds-ctx-entry .ds-ctx-head a {
    color: #0097A7 !important;
  }

  .toTop {
    background: #757575 !important;
  }

  .material-layout .material-post>.material-nav,
  .material-layout .material-index>.material-nav,
  .material-nav a {
    color: #757575;
  }

  #scheme-Paradox .MD-burger-layer {
    background-color: #757575;
  }

  #scheme-Paradox #post-toc-trigger-btn {
    color: #757575;
  }

  .post-toc a:hover {
    color: #00838F;
    text-decoration: underline;
  }

</style>


<!-- Theme Background Related-->

    <style>
      body{
        background-color: #F5F5F5;
      }

      /* blog_info bottom background */
      #scheme-Paradox .material-layout .something-else .mdl-card__supporting-text{
        background-color: #fff;
      }
    </style>




<!-- Fade Effect -->

    <style>
      .fade {
        transition: all 800ms linear;
        -webkit-transform: translate3d(0,0,0);
        -moz-transform: translate3d(0,0,0);
        -ms-transform: translate3d(0,0,0);
        -o-transform: translate3d(0,0,0);
        transform: translate3d(0,0,0);
        opacity: 1;
      }

      .fade.out{
        opacity: 0;
      }
    </style>


<!-- Import Font -->
<!-- Import Roboto -->

    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500" rel="stylesheet">


<!-- Import Material Icons -->


    <style id="material_icons"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("material_icons","/css/material-icons.css?pqhB/Rd/ab0H2+kZp0RDmw==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>




    <!-- Import jQuery -->
    
        <script>lsloader.load("jq_js","/js/jquery.min.js?qcusAULNeBksqffqUM2+Ig==", true)</script>
    

    <!-- WebAPP Icons -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="WarmCute&#39;s Blog">
    <meta name="msapplication-starturl" content="http://yoursite.com/2016/09/15/Thread/">
    <meta name="msapplication-navbutton-color" content="#0097A7">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="WarmCute&#39;s Blog">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon" href="/img/favicon.png">

    <!-- Site Verification -->
    
    

    <!-- RSS -->
    

    <!-- The Open Graph protocol -->
    <meta property="og:url" content="http://yoursite.com/2016/09/15/Thread/">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="线程知识 | WarmCute&#39;s Blog">
    <meta property="og:image" content="/img/favicon.png">
    <meta property="og:description" content>
    

    
        <meta property="article:published_time" content="Thu Sep 15 2016 17:07:42 GMT+0800">
        <meta property="article:modified_time" content="Thu May 23 2019 15:49:04 GMT+0800">
    

    <!-- The Twitter Card protocol -->
    <meta name="twitter:card" content="summary_large_image">

    <!-- Add canonical link for SEO -->
    
        <link rel="canonical" href="http://yoursite.com/2016/09/15/Thread/index.html">
    

    <!-- Structured-data for SEO -->
    
        


<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "mainEntityOfPage": "http://yoursite.com/2016/09/15/Thread/index.html",
    "headline": "线程知识",
    "datePublished": "Thu Sep 15 2016 17:07:42 GMT+0800",
    "dateModified": "Thu May 23 2019 15:49:04 GMT+0800",
    "author": {
        "@type": "Person",
        "name": "WarmCute",
        "image": {
            "@type": "ImageObject",
            "url": "/img/avatar.png"
        },
        "description": "Hi, nice to meet you"
    },
    "publisher": {
        "@type": "Organization",
        "name": "WarmCute&#39;s Blog",
        "logo": {
            "@type":"ImageObject",
            "url": "/img/favicon.png"
        }
    },
    "keywords": "",
    "description": "",
}
</script>


    

    <!-- Analytics -->
    
    
    

    <!-- Custom Head -->
    

</head>


    
        <body id="scheme-Paradox" class="lazy">
            <div class="material-layout  mdl-js-layout has-drawer is-upgraded">
                

                <!-- Main Container -->
                <main class="material-layout__content" id="main">

                    <!-- Top Anchor -->
                    <div id="top"></div>

                    
                        <!-- Hamburger Button -->
                        <button class="MD-burger-icon sidebar-toggle">
                            <span id="MD-burger-id" class="MD-burger-layer"></span>
                        </button>
                    

                    <!-- Post TOC -->

    
    <!-- Back Button -->
    <!--
    <div class="material-back" id="backhome-div" tabindex="0">
        <a class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon"
           href="#" onclick="window.history.back();return false;"
           target="_self"
           role="button"
           data-upgraded=",MaterialButton,MaterialRipple">
            <i class="material-icons" role="presentation">arrow_back</i>
            <span class="mdl-button__ripple-container">
                <span class="mdl-ripple"></span>
            </span>
        </a>
    </div>
    -->


    <!-- Left aligned menu below button -->
    
    
    <button id="post-toc-trigger-btn" class="mdl-button mdl-js-button mdl-button--icon">
        <i class="material-icons">format_list_numbered</i>
    </button>

    <ul class="post-toc-wrap mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect" for="post-toc-trigger-btn" style="max-height:80vh; overflow-y:scroll;">
        <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#线程和进程的区别"><span class="post-toc-number">1.</span> <span class="post-toc-text">线程和进程的区别</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#进程"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">进程</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#线程"><span class="post-toc-number">1.2.</span> <span class="post-toc-text">线程</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#如何在java中实现线程"><span class="post-toc-number">2.</span> <span class="post-toc-text">如何在java中实现线程</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#继承Thread类"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">继承Thread类</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#实现Runnable接口"><span class="post-toc-number">2.2.</span> <span class="post-toc-text">实现Runnable接口</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#使用ExecutorService、Callable、Future实现有返回结果的多线程"><span class="post-toc-number">2.3.</span> <span class="post-toc-text">使用ExecutorService、Callable、Future实现有返回结果的多线程</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#常见的创建线程的线程池"><span class="post-toc-number">2.4.</span> <span class="post-toc-text">常见的创建线程的线程池</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#线程池"><span class="post-toc-number">2.4.1.</span> <span class="post-toc-text">线程池</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#创建方式"><span class="post-toc-number">2.4.2.</span> <span class="post-toc-text">创建方式</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#实现接口和继承线程类直接的不同"><span class="post-toc-number">2.5.</span> <span class="post-toc-text">实现接口和继承线程类直接的不同</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#线程的状态"><span class="post-toc-number">3.</span> <span class="post-toc-text">线程的状态</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#常用的一些方法"><span class="post-toc-number">4.</span> <span class="post-toc-text">常用的一些方法</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#多个线程之间的通信"><span class="post-toc-number">5.</span> <span class="post-toc-text">多个线程之间的通信</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#线程完全问题"><span class="post-toc-number">6.</span> <span class="post-toc-text">线程完全问题</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#什么时候会出现线程安全问题"><span class="post-toc-number">6.1.</span> <span class="post-toc-text">什么时候会出现线程安全问题</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#如何解决"><span class="post-toc-number">6.2.</span> <span class="post-toc-text">如何解决</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#synchronized"><span class="post-toc-number">6.2.1.</span> <span class="post-toc-text">synchronized</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#lock"><span class="post-toc-number">6.2.2.</span> <span class="post-toc-text">lock</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#如何使用"><span class="post-toc-number">6.2.3.</span> <span class="post-toc-text">如何使用</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#常用方法"><span class="post-toc-number">6.2.3.1.</span> <span class="post-toc-text">常用方法</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#实现类"><span class="post-toc-number">6.2.3.2.</span> <span class="post-toc-text">实现类</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#使用特殊域变量-Volatile-实现线程同步"><span class="post-toc-number">6.2.3.3.</span> <span class="post-toc-text">使用特殊域变量(Volatile)实现线程同步</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#使用局部变量"><span class="post-toc-number">6.2.3.4.</span> <span class="post-toc-text">使用局部变量</span></a></li></ol></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#线程同步"><span class="post-toc-number">7.</span> <span class="post-toc-text">线程同步</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#常见面试问题"><span class="post-toc-number">8.</span> <span class="post-toc-text">常见面试问题</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#lock接口和synchronized的区别"><span class="post-toc-number">8.1.</span> <span class="post-toc-text">lock接口和synchronized的区别</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#java中的wait和sleep方法有何不同"><span class="post-toc-number">8.2.</span> <span class="post-toc-text">java中的wait和sleep方法有何不同</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#编写java代码，解决生产者——消费者问题"><span class="post-toc-number">8.3.</span> <span class="post-toc-text">编写java代码，解决生产者——消费者问题</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#背景"><span class="post-toc-number">8.3.1.</span> <span class="post-toc-text">背景</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#方式一：synchronized、wait和notify"><span class="post-toc-number">8.3.2.</span> <span class="post-toc-text">方式一：synchronized、wait和notify</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#lock-和-condition-的await、signalAll"><span class="post-toc-number">8.3.3.</span> <span class="post-toc-text">lock 和 condition 的await、signalAll</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#BlockingQueue"><span class="post-toc-number">8.3.4.</span> <span class="post-toc-text">BlockingQueue</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#BlockingQueue的继承"><span class="post-toc-number">8.3.4.1.</span> <span class="post-toc-text">BlockingQueue的继承</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#BlockingQueue的方法"><span class="post-toc-number">8.3.4.2.</span> <span class="post-toc-text">BlockingQueue的方法</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#有T1、T2、T3三个线程，如何保证T2在T1执行完后执行，T3在T2执行完后执行"><span class="post-toc-number">8.4.</span> <span class="post-toc-text">有T1、T2、T3三个线程，如何保证T2在T1执行完后执行，T3在T2执行完后执行</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#什么是ThreadLocal类，怎么使用它"><span class="post-toc-number">9.</span> <span class="post-toc-text">什么是ThreadLocal类，怎么使用它</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#ThreadLocal的定义和用途"><span class="post-toc-number">9.1.</span> <span class="post-toc-text">ThreadLocal的定义和用途</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#ThreadLocal能做什么"><span class="post-toc-number">9.2.</span> <span class="post-toc-text">ThreadLocal能做什么</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#什么是死锁？如何解决死锁问题"><span class="post-toc-number">9.3.</span> <span class="post-toc-text">什么是死锁？如何解决死锁问题</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#死锁"><span class="post-toc-number">9.3.1.</span> <span class="post-toc-text">死锁</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#死锁发生所具备的条件"><span class="post-toc-number">9.3.2.</span> <span class="post-toc-text">死锁发生所具备的条件</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#如何解决死锁"><span class="post-toc-number">9.3.3.</span> <span class="post-toc-text">如何解决死锁</span></a></li></ol></li></ol></li></ol>
    </ul>
    




<!-- Layouts -->

    <!-- Post Module -->
    <div class="material-post_container">

        <div class="material-post mdl-grid">
            <div class="mdl-card mdl-shadow--4dp mdl-cell mdl-cell--12-col">

                <!-- Post Header(Thumbnail & Title) -->
                
    <!-- Paradox Post Header -->
    
        
            <!-- Random Thumbnail -->
            <div class="post_thumbnail-random mdl-card__media mdl-color-text--grey-50">
            <script type="text/ls-javascript" id="post-thumbnail-script">
    var randomNum = Math.floor(Math.random() * 19 + 1);

    $('.post_thumbnail-random').attr('data-original', '/img/random/material-' + randomNum + '.png');
    $('.post_thumbnail-random').addClass('lazy');
</script>

        
    
            <p class="article-headline-p">
                线程知识
            </p>
        </div>





                
                    <!-- Paradox Post Info -->
                    <div class="mdl-color-text--grey-700 mdl-card__supporting-text meta">

    <!-- Author Avatar -->
    <div id="author-avatar">
        <img src="/img/avatar.png" width="44px" height="44px" alt="Author Avatar">
    </div>
    <!-- Author Name & Date -->
    <div>
        <strong>WarmCute</strong>
        <span>9月 15, 2016</span>
    </div>

    <div class="section-spacer"></div>

    <!-- Favorite -->
    <!--
        <button id="article-functions-like-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon btn-like">
            <i class="material-icons" role="presentation">favorite</i>
            <span class="visuallyhidden">favorites</span>
        </button>
    -->

    <!-- Qrcode -->
    

    <!-- Tags (bookmark) -->
    

    <!-- Share -->
    
        <button id="article-fuctions-share-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">share</i>
    <span class="visuallyhidden">share</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-fuctions-share-button">
    

    

    <!-- Share Weibo -->
    
        <a class="post_share-link" href="http://service.weibo.com/share/share.php?appkey=&title=线程知识&url=http://yoursite.com/2016/09/15/Thread/index.html&pic=http://yoursite.com/img/favicon.png&searchPic=false&style=simple" target="_blank">
            <li class="mdl-menu__item">
                分享到微博
            </li>
        </a>
    

    <!-- Share Twitter -->
    
        <a class="post_share-link" href="https://twitter.com/intent/tweet?text=线程知识&url=http://yoursite.com/2016/09/15/Thread/index.html&via=WarmCute" target="_blank">
            <li class="mdl-menu__item">
                分享到 Twitter
            </li>
        </a>
    

    <!-- Share Facebook -->
    
        <a class="post_share-link" href="https://www.facebook.com/sharer/sharer.php?u=http://yoursite.com/2016/09/15/Thread/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 Facebook
            </li>
        </a>
    

    <!-- Share Google+ -->
    
        <a class="post_share-link" href="https://plus.google.com/share?url=http://yoursite.com/2016/09/15/Thread/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 Google+
            </li>
        </a>
    

    <!-- Share LinkedIn -->
    

    <!-- Share QQ -->
    

    <!-- Share Telegram -->
    
</ul>

    
</div>

                

                <!-- Post Content -->
                <div id="post-content" class="mdl-color-text--grey-700 mdl-card__supporting-text fade out">
    
        <p>线程是操作系统能够进行运算调度的最小单位，它被包含在进程之中，是进程中的实际运作单位。程序员可以通过它进行多处理器编程，你可以使用多线程对运算密集型任务提速。</p>
<h2 id="线程和进程的区别"><a href="#线程和进程的区别" class="headerlink" title="线程和进程的区别"></a>线程和进程的区别</h2><h3 id="进程"><a href="#进程" class="headerlink" title="进程"></a>进程</h3><p>正在运行的程序。确切的来说，当一个程序进入内存运行，即编程一个进程，进程是处于运行过程中的程序，并且具有一定独立功能。</p>
<h3 id="线程"><a href="#线程" class="headerlink" title="线程"></a>线程</h3><p>线程是进程中的一个执行单元，负责当前进程中程序的执行，一个进程中至少有一个线程。一个进程中是可以有多个线程的。这个应用程序也可以称之为多线程程序。</p>
<h2 id="如何在java中实现线程"><a href="#如何在java中实现线程" class="headerlink" title="如何在java中实现线程"></a>如何在java中实现线程</h2><h3 id="继承Thread类"><a href="#继承Thread类" class="headerlink" title="继承Thread类"></a>继承Thread类</h3><ul>
<li>Thread类本质也实现了Runnable接口<blockquote>
<p>class Thread implements Runnable</p>
</blockquote>
</li>
<li><p>实现代码</p>
<ul>
<li><p>在自己的累直接继承Thread接口，并重写run()方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">public class MyThread extends Thread&#123;</span><br><span class="line">	public void run() &#123;</span><br><span class="line">		……</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在需要的地方启动线程</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">MyThread myThread1 = new MyThread();</span><br><span class="line">MyThread myThread2 = new MyThread();</span><br><span class="line">myThread1.start();</span><br><span class="line">myThread2.start();</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h3 id="实现Runnable接口"><a href="#实现Runnable接口" class="headerlink" title="实现Runnable接口"></a>实现Runnable接口</h3><ul>
<li>自己的类实现Runnable接口，重写run()方法<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">public class MyThread implements Runnable() &#123;</span><br><span class="line">	public void run() &#123;</span><br><span class="line">		……</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">MyThread myThread = new MyThread();</span><br><span class="line">Thread thread = new Thread(myThread);</span><br><span class="line">thread.start();</span><br></pre></td></tr></table></figure>
<h3 id="使用ExecutorService、Callable、Future实现有返回结果的多线程"><a href="#使用ExecutorService、Callable、Future实现有返回结果的多线程" class="headerlink" title="使用ExecutorService、Callable、Future实现有返回结果的多线程"></a>使用ExecutorService、Callable、Future实现有返回结果的多线程</h3><ul>
<li>ExecutorService、Callable、Future这个对象实际上都是属于Executor框架中的功能类</li>
<li>执行Callable任务后，可以获取一个Future对象，在该对象上调用get就可以获取到Callable任务返回的Object了，再结合线程池接口ExecutorService就可以实现有返回结果的多线程了<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">class MyCallable implements Callable&lt;Object&gt; &#123;</span><br><span class="line">	private String taskNum;</span><br><span class="line">	</span><br><span class="line">	MyCallable(String taskNum) &#123;</span><br><span class="line">		this.taskNum = taskNum;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public Object call() throws Exception&#123;</span><br><span class="line">		System.out.println(&quot;&gt;&gt;&gt;&quot; + taskNum + &quot;任务开始&quot;);</span><br><span class="line">		Date dateTpm1 = new Date();</span><br><span class="line">		Thread.sleep(1000);</span><br><span class="line">		Date dateTpm2 = new Date();</span><br><span class="line">		long time = dateTpm2.getTime() - dateTpm1.getTime();</span><br><span class="line">		System.out.println(&quot;&gt;&gt;&gt;&quot; + taskNum + &quot;任务停止&quot;);</span><br><span class="line">		return taskNum + &quot;任务返回运行结果， 当前任务时间【&quot; + time + &quot;】毫秒&quot;;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">Date date = new Date();</span><br><span class="line">int taskSize = 5;</span><br><span class="line">// 创建一个线程池</span><br><span class="line">ExecutorService pool = Executors.newFixedThreadPool(taskSize);</span><br><span class="line">// 创建多个有返回值的任务</span><br><span class="line">List&lt;Future&gt; list = new ArrayList&lt;Future&gt;();</span><br><span class="line"></span><br><span class="line">for (int i = 0 ; i &lt; taskSize ; i ++ ) &#123;</span><br><span class="line">	Callable callable = new MyCallable(i + &quot; &quot;);</span><br><span class="line">	Future future = pool.submit(callable);</span><br><span class="line">	list.add(future);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 关闭线程池</span><br><span class="line">pool.shutdown();</span><br><span class="line">// 获取所有并发任务的运行结果</span><br><span class="line">for (Future future : list) &#123;</span><br><span class="line">	// 从Future对象上获取任务的返回值，并输出到控制台</span><br><span class="line">	System.out.println(&quot;&gt;&gt;&gt;&quot; + future.get().toString());</span><br><span class="line">&#125;</span><br><span class="line">Date newDate = new Date();</span><br><span class="line"></span><br><span class="line">System.out.println(&quot;---程序结束---,运行时间&quot; + (newDate.getTime() - date.getTime()) + &quot;毫秒&quot;);</span><br></pre></td></tr></table></figure>
<h3 id="常见的创建线程的线程池"><a href="#常见的创建线程的线程池" class="headerlink" title="常见的创建线程的线程池"></a>常见的创建线程的线程池</h3><h4 id="线程池"><a href="#线程池" class="headerlink" title="线程池"></a>线程池</h4><p>线程池的基本思想还是一种对象池的思想，开辟一块内存空间，里面存放了众多（未死亡）的线程，池中线程执行调度由池管理器来处理。当有线程任务时，从池中取一个，执行完成后线程对象归池，这样可以避免反复创建线程对象所带来的性能开销，节省了系统的资源。</p>
<h4 id="创建方式"><a href="#创建方式" class="headerlink" title="创建方式"></a>创建方式</h4><ul>
<li>new CachedThreadPool(可缓存线程池)<ul>
<li>创建一个可缓存线程池，如果线程池长度超过处理需要，可灵活回收空间线程，若无可回收，则新建线程</li>
<li>特点<ul>
<li>工作线程的创建数量几乎没有限制（其实也有限制，数目为Integer.MAX_VALUE），这样课灵活的往线程池中添加线程</li>
<li>如果长时间没有往线程池中提交任务，即如果工作线程空闲了指定的时间（默认为1分钟），则该工作线程将自动终止。终止后，如果你又提交了新的任务，则线程池重新创建一个工作线程。</li>
<li>在使用CachedThreadPool时，一定要注意控制任务的数量，否则，又有大量线程同时运行，很有可能会造成系统瘫痪。</li>
</ul>
</li>
</ul>
</li>
<li>new FixedThreadPool（指定工作线程数量的线程池）<ul>
<li>创建一个指定工作数量的线程池。每当提交一个任务就创建一个工作线程，如果工作线程数量达到线程池初始的最大数，则将提交的任务存入到池队列中。</li>
<li>FixedThreadPool是一个典型且优秀的线程池，它具有线程池提高程序效率和节省创建线程时所耗的开销的优点。但是，在线程池空闲时，即ianchengchi中没有可运行任务时，它不会释放工作线程，还会占用一定的系统资源。</li>
</ul>
</li>
<li>new ScheduleThreadPool(定长的线程池)<ul>
<li>创建一个定长的线程池，而且支持定时的以及周期性的任务执行，支持定时及周期性任务执行。</li>
</ul>
</li>
</ul>
<h3 id="实现接口和继承线程类直接的不同"><a href="#实现接口和继承线程类直接的不同" class="headerlink" title="实现接口和继承线程类直接的不同"></a>实现接口和继承线程类直接的不同</h3><ul>
<li>接口可以避免由于java的单继承特性带来的局限</li>
<li>增强程序的健壮性，代码能够被多个线程共享，代码与数据是独立的</li>
<li>适合多个相同程序代码的线程区处理同一资源的情况</li>
</ul>
<h2 id="线程的状态"><a href="#线程的状态" class="headerlink" title="线程的状态"></a>线程的状态</h2><ul>
<li>新建状态(new)<ul>
<li>当线程对象创建后，即进入了新建状态。如：Thread t = new MyThread();</li>
</ul>
</li>
<li>就绪状态(Runnable)<ul>
<li>当调用线程对象的start()方法后，线程即进入就绪状态。处于就绪状态的线程，只是说明线程已经做好了准备，随时等待CPU调度执行，并不是说执行了Start方法，此线程就会立即执行。注：就绪状态是进入到运行状态的唯一入口，也就是说，线程想要进入运行状态执行，首先必须处于就绪状态中；</li>
</ul>
</li>
<li>阻塞状态(Blocked)<br>  处于运行状态中的线程由于某种原因，暂时放弃对CPU的使用权，停止执行，此时进入阻塞状态，直到其进入到就绪状态，才有机会再次被CPU调用以进入到运行状态<ul>
<li>等待堵塞：运行状态中的线程执行wait()方法，使本线程进入到等待阻塞状态</li>
<li>同步堵塞：线程在获取synchronized同步锁失败（因为锁被其他线程所占用），它会进入同步阻塞状态；</li>
<li>其他堵塞：通过调用线程的sleep()或join()或发出了I/O请求时，线程会进入到阻塞状态。当sleep()状态超时、join()等待线程终止或者超时、或者I/O处理完毕时，线程重新转入就绪状态。</li>
</ul>
</li>
<li>死亡状态(Dead)<ul>
<li>线程执行完了或者因异常退出了run()方法，该线程结束生命周期。</li>
</ul>
</li>
</ul>
<h2 id="常用的一些方法"><a href="#常用的一些方法" class="headerlink" title="常用的一些方法"></a>常用的一些方法</h2><ul>
<li>start<br>用来启动一个线程，当调用start方法后，系统才会开启一个新的线程来执行用户定义的子任务，在这个过程中，会为相应的线程分配需要的资源</li>
<li>run<br>是不需要用户来调用的，当通过start方法启动一个线程之后，当线程获得了CPU执行时间，便进入run方法去执行具体的任务。注意，继承Thread类必须重写run方法，在run方法中定义具体要执行的任务</li>
<li>sleep(sleep(long millis))</li>
<li>sleep(long mills, int nanoseconds) // 第二个参数是纳秒<br>sleep相当于让线程睡眠，交出CPU，让CPU去执行其他的任务。<br>但是又一点要非常注意，sleep方法不会释放锁，也就是说如果当前线程持有对某个对象的锁，则即使调用sleep方法，其他线程也无法访问这个对象。</li>
<li>yield<br>调用yield方法会让当前线程交出CPU权限，让CPU去执行其他的线程。它跟sleep方法类似，同样不会释放锁，但是yield不能控制具体的交出CPU的时间，另外，yield方法只能让拥有相同优先级的线程CPU执行时间的机会<blockquote>
<p>调用yield方法并不会让线程进入阻塞状态，而是让线程重回就绪状态，它只需等待重新获取CPU执行时间，这一点和sleep不一样</p>
</blockquote>
</li>
<li>join<br>中断其他线程的执行，等待调用join方法的线程结束，即时是主线程main也会被中断。<blockquote>
<p>join()<br>join(long millis) //参数为毫秒<br>join（long millis,int nanoseconds） //第二个参数是纳秒</p>
</blockquote>
</li>
</ul>
<h2 id="多个线程之间的通信"><a href="#多个线程之间的通信" class="headerlink" title="多个线程之间的通信"></a>多个线程之间的通信</h2><ul>
<li>多个线程在处理同一个资源，但是处理的动作(线程的任务)却不相同。通过一定的手段使各个线程能有效的利用资源。</li>
<li>通常情况下，一个次级线程要为主线程完成某种特定类型的任务，这就隐含着表示在主线程和次线程之间需要建立一个通信的通道。</li>
<li>一般情况下，又下面集中方法实现这种通信任务：使用全局变量、使用事件对象、使用消息。</li>
</ul>
<h2 id="线程完全问题"><a href="#线程完全问题" class="headerlink" title="线程完全问题"></a>线程完全问题</h2><h3 id="什么时候会出现线程安全问题"><a href="#什么时候会出现线程安全问题" class="headerlink" title="什么时候会出现线程安全问题"></a>什么时候会出现线程安全问题</h3><p>在单线程中不会出现线程安全问题，而在多线程编程中，有可能会出现同时访问同一个资源的情况，这种资源可以是各种类型的资源：一个变量、一个对象、一个文件、一个数据库等。而当多个线程同时访问一个资源的时候，就会存在一个问题：由于每个线程执行的问题是不可控的，所以很可能导致最终的结果与实际上的愿望相违背或者直接导致程序出错</p>
<blockquote>
<p>举个例子:<br>现在有两个线程分别从网络上读取数据，然后插入一条数据库表中，要求不能插入重复的数据。<br>那么必然在插入数据的过程中存在两个操作：</p>
<ol>
<li>检查数据库中是否存在该条数据；</li>
<li>如果存在，则不插入；如果不存在，则插入；</li>
</ol>
<p>假如两个线程分别用Thread-1和Thread-2表示。某一时刻，Thread-1和Thread-2都读取到了数据X，那么可能会发生这种情况：<br>Thread-1去检查数据库中是否存在数据X，然后Thread-2也接着去检查数据库中是否存在数据X。<br>结果两个线程检查的结果都是数据库中不存在数据X，那么两个线程都分别将数据X插入数据库表中。<br>这个就是线程安全问题，即多个线程同时访问一个资源时，会导致程序运行结果并不是想看到的结果。<br>这里面，这个资源被称为：临界资源（有也称为共享资源）<br>也就是说，当多个线程同时访问临界资源时，就可能会产生线程安全问题。<br>不过，当多个线程执行一个方法，方法内部的局部变量并不是临界资源，因为方法是在栈上执行的，而java栈是线程私有的，因此不会产生线程安全问题。</p>
</blockquote>
<h3 id="如何解决"><a href="#如何解决" class="headerlink" title="如何解决"></a>如何解决</h3><ul>
<li>序列化访问临界资源，即在同一时刻，只能有一个线程访问临界资源，也称同步互斥访问。通常来说，是在访问临界资源的代码前面加一个锁，当访问完临界资源后释放锁，让其他线程继续访问。</li>
<li>两种方案实现同步互斥访问：synchronize和Lock<blockquote>
<p>将操作共享数据的代码行作为一个整体，同一时间只允许一个线程执行，执行过程中其他线程不能参与执行</p>
</blockquote>
</li>
</ul>
<h4 id="synchronized"><a href="#synchronized" class="headerlink" title="synchronized"></a>synchronized</h4><ul>
<li>同步方法<blockquote>
<p>有synchronized关键字修饰的方法，由于java的每个对象都有一个内置锁，当用此关键字修饰方法时，内置锁会保护整个方法，在调用该方法前，需要获得内置锁，否则就处于阻塞状态。 </p>
</blockquote>
</li>
</ul>
<h4 id="lock"><a href="#lock" class="headerlink" title="lock"></a>lock</h4><ul>
<li>jdk1.5之后出现的，并发包中新增了Lock接口以及相关实现类用来实现锁功能，lock接口提供的功能与synchronize类似的同步功能，但需要手动释放锁和获得锁。</li>
<li>lock接口却提供了锁的可操作性，可中断获取锁以及超时获得锁等</li>
<li>有两个非常强大的实现类重入锁和读写锁</li>
</ul>
<h4 id="如何使用"><a href="#如何使用" class="headerlink" title="如何使用"></a>如何使用</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Lock lock = new ReetrantLock();</span><br><span class="line">lock.lock();</span><br><span class="line">try (</span><br><span class="line">	// 可能会出现线程安全的操作</span><br><span class="line">) finally (</span><br><span class="line">	// 一定在finally中释放锁</span><br><span class="line">	// 也不能把获取锁在try中进行，因为正有可能在获取锁的时候抛出异常</span><br><span class="line">	lock.ublock();</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h5 id="常用方法"><a href="#常用方法" class="headerlink" title="常用方法"></a>常用方法</h5><ul>
<li><code>void lock()</code><strong>获取锁</strong>，调用该方法当前线程将会获取锁，当锁获取后，该方法将返回。</li>
<li><code>void lockInterruptibly() throw InterruptedException</code><strong>可中断获取锁</strong>，与lock()方法不同之处在于该方法会响应中断，即在锁的获取过程中可以中断当前线程</li>
<li><code>boolean tryLock()</code><strong>尝试非阻塞的获取锁</strong>,调用该方法立即返回，true表示获取到锁</li>
<li><code>boolean tryLock(long time, TimeUnit unit) throws InterruptedException</code><strong>超时获取锁</strong>，以下情况会返回:短时间内获取到了锁，时间内被中断，时间到了没有获取到锁。</li>
<li><code>void unlock()</code><strong>释放锁</strong></li>
</ul>
<h5 id="实现类"><a href="#实现类" class="headerlink" title="实现类"></a>实现类</h5><ul>
<li><code>ReetrantLock</code> <strong>排它锁</strong>: 该锁在同一时刻只允许一个线程来访问</li>
<li><code>ReetranReadWriteLock</code> <strong>读写锁</strong>: 在同一时刻允许可以有多个线程来访问，但在写线程访问时，所有的读线程和其他写线程被阻塞，读写锁维护了一对锁，一个读锁和一个写锁，通过读写锁分离，使得并发性相比一般的排他锁有了很大的提升。</li>
</ul>
<h5 id="使用特殊域变量-Volatile-实现线程同步"><a href="#使用特殊域变量-Volatile-实现线程同步" class="headerlink" title="使用特殊域变量(Volatile)实现线程同步"></a>使用特殊域变量(Volatile)实现线程同步</h5><p>它的原理是每次要线程要访问volatile修饰的变量时都是从内存中读取，而不是缓存中读取，因此每个线程访问到的变量值都是一样的，这样就保证了同步。</p>
<ul>
<li>volatile关键字为域变量的访问提供了一种免锁机制</li>
<li>使用volatile修饰域相当于告诉虚拟机该域可能会被其他线程更新</li>
<li>因此每次使用该域就要重新计算，而不是使用寄存器中的值</li>
<li>volatile不会提供任务原子操作，它也不能用来修饰final类型的类</li>
</ul>
<h5 id="使用局部变量"><a href="#使用局部变量" class="headerlink" title="使用局部变量"></a>使用局部变量</h5><p>如果使用ThreadLocal管理变量，则每一个使用该变量的线程都获得该变量的副本，副本之间相互独立，这样每一个线程都可以随意修改自己的变量副本，而不会对其他线程产生影响</p>
<h2 id="线程同步"><a href="#线程同步" class="headerlink" title="线程同步"></a>线程同步</h2><ol>
<li>只能同步方法，而不能同步变量和类</li>
<li>每个对象只有一个锁；当提到同步时，应该清楚在什么上同步。也就是说，在哪个对象上同步</li>
<li>不必同步类中所有的方法，类可以同时拥有同步和非同步方法</li>
<li>如果两个线程要执行一个类中的synchronized方法，并且两个线程使用相同的实例来调用方法，那么一次只能有一个线程能够执行方法，了另一个需要等待，直到锁被释放，也就是说：如果一个线程在对象中获得一个锁，就没有任何其他线程可以进入（该对象的）类中的任何一个同步方法。</li>
<li>如果线程拥有同步和非同步方法，则非同步方法可以被多个线程自由访问而不受锁的限制</li>
<li>线程水面时，它所持的任何锁都不会释放</li>
<li>线程可以获得多个锁。比如，在一个对象的同步方法里面调用另外一个对象的同步方法，则获得了两个对象的同步锁。</li>
<li>同步损害并发性，应该尽可能缩小同步返回。同步不但可以同步整个方法，还可以同步方法中一部分代码块</li>
<li>在使用同步代码块时，应该指定在那个对象上同步，也就是说要获取哪个对象的锁。</li>
</ol>
<h2 id="常见面试问题"><a href="#常见面试问题" class="headerlink" title="常见面试问题"></a>常见面试问题</h2><h3 id="lock接口和synchronized的区别"><a href="#lock接口和synchronized的区别" class="headerlink" title="lock接口和synchronized的区别"></a>lock接口和synchronized的区别</h3><ol>
<li>lock是一个接口，而synchronized是java中的关键字，synchronized是内置的语言实现。</li>
<li>synchronized在发生异常时，会自动释放线程占有的锁，因此不会导致死锁的现象发生；而lock在发生异常时，如果没有主动通过<code>unLock()</code>去释放锁，则很可能造成死锁现象，因此使用Lock时需要在finally块中释放锁。</li>
<li>lock可以让等待锁的线程响应中断，而synchronized却不行，使用synchronized时，等待的线程会一直等待下去，不能够相应中断。</li>
<li>通过lock可以知道有没有成功获取锁，而synchronized却无法办到</li>
<li>lock可以提高多个线程进行读操作的效率</li>
<li>在性能上来说，如果竞争资源不激烈，亮着的性能是差不多的，而当竞争资源非常激烈时（即有大量线程同时竞争），此时lock的性能要远远优于synchronized。所以说，在具体使用时要根据适当情况选择。lock的操作与synchronized相比，灵活性更高，而且lock提供多种方式获取锁，有lock、readWriteLock接口，以及实现这两个接口的ReentratLock类、ReentrantReadWriteLock类。</li>
</ol>
<h3 id="java中的wait和sleep方法有何不同"><a href="#java中的wait和sleep方法有何不同" class="headerlink" title="java中的wait和sleep方法有何不同"></a>java中的wait和sleep方法有何不同</h3><p>都能将线程状态变成等待状态</p>
<ul>
<li>sleep()状态，是属于Thread类中的。而wait()方法，则是属于Object类中的。</li>
<li>wait()方法必须是在同步环境下使用。比如synchronized方法或者同步代码快。如果你不在同步条件下使用，会抛出InllegalMonitorStateException异常。另外，sleep方法不需要在同步条件下使用，你可以任意正常的使用。</li>
<li>调用wait()的时候方法会释放当前持有的锁，而sleep()不会释放任何锁。</li>
</ul>
<h3 id="编写java代码，解决生产者——消费者问题"><a href="#编写java代码，解决生产者——消费者问题" class="headerlink" title="编写java代码，解决生产者——消费者问题"></a>编写java代码，解决生产者——消费者问题</h3><h4 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h4><p>生产者生产数据到<strong>缓冲区</strong>，消费者从<strong>缓冲区</strong>中取数据。<br>如果<strong>缓冲区</strong>已经满了，则生产者线程阻塞。<br>如果<strong>缓冲区</strong>为空，那么消费者线程阻塞。</p>
<h4 id="方式一：synchronized、wait和notify"><a href="#方式一：synchronized、wait和notify" class="headerlink" title="方式一：synchronized、wait和notify"></a>方式一：synchronized、wait和notify</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line">public class Main &#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        Resource resource = new Resource();</span><br><span class="line">        // 生产者线程</span><br><span class="line">        ProducerThread p1 = new ProducerThread(resource);</span><br><span class="line">        ProducerThread p2 = new ProducerThread(resource);</span><br><span class="line">        ProducerThread p3 = new ProducerThread(resource);</span><br><span class="line">        //消费者线程</span><br><span class="line">        ConsumerThread c1 = new ConsumerThread(resource);</span><br><span class="line">//        ConsumerThread c2 = new ConsumerThread(resource);</span><br><span class="line">//        ConsumerThread c3 = new ConsumerThread(resource);</span><br><span class="line"></span><br><span class="line">        p1.start();</span><br><span class="line">        p2.start();</span><br><span class="line">        p3.start();</span><br><span class="line">        c1.start();</span><br><span class="line">//        c2.start();</span><br><span class="line">//        c3.start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    static class Resource&#123;</span><br><span class="line">        /**</span><br><span class="line">         *  当前资源数目</span><br><span class="line">          */</span><br><span class="line">        private int num = 0;</span><br><span class="line">        /**</span><br><span class="line">         *  资源池中允许存放的资源数目;</span><br><span class="line">          */</span><br><span class="line">        private int size = 10;</span><br><span class="line"></span><br><span class="line">        /**</span><br><span class="line">         *  从资源池中取走资源</span><br><span class="line">         */</span><br><span class="line">        synchronized void remove()&#123;</span><br><span class="line">            if (num &gt; 0) &#123;</span><br><span class="line">                num --;</span><br><span class="line">                System.out.println(&quot;消费者&quot; + Thread.currentThread().getName() + &quot;消耗一件资源，当前线程池有&quot; + num + &quot;个&quot;);</span><br><span class="line">                // 通知生产者生产资源</span><br><span class="line">                notifyAll();</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                try &#123;</span><br><span class="line">                    // 如果没有资源，则消费者进入等待状态</span><br><span class="line">                    wait();</span><br><span class="line">                &#125; catch (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        /**</span><br><span class="line">         * 向资源池中添加资源</span><br><span class="line">         */</span><br><span class="line">        synchronized void add() &#123;</span><br><span class="line">            if (num &lt; size) &#123;</span><br><span class="line">                num ++;</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + &quot;生产一件资源，当前资源池&quot; + num + &quot;个&quot;);</span><br><span class="line">                //通知等待的消费者</span><br><span class="line">                notifyAll();</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                // 如果当前资源池有10个资源</span><br><span class="line">                try &#123;</span><br><span class="line">                    wait();</span><br><span class="line">                    System.out.println(Thread.currentThread().getName() + &quot;线程进入等待&quot;);</span><br><span class="line">                &#125; catch (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 消费者线程</span><br><span class="line">     */</span><br><span class="line">    static class ConsumerThread extends Thread &#123;</span><br><span class="line">        private Resource resource;</span><br><span class="line">        ConsumerThread(Resource resource) &#123;</span><br><span class="line">            this.resource = resource;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public void run() &#123;</span><br><span class="line">            do &#123;</span><br><span class="line">                try &#123;</span><br><span class="line">                    Thread.sleep(1000);</span><br><span class="line">                &#125; catch (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                resource.remove();</span><br><span class="line">            &#125; while (true);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 生产者线程</span><br><span class="line">     */</span><br><span class="line">    static class ProducerThread extends Thread&#123;</span><br><span class="line">        private Resource resource;</span><br><span class="line">        ProducerThread(Resource resource) &#123;</span><br><span class="line">            this.resource = resource;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public void run() &#123;</span><br><span class="line">            // 不断生产资源</span><br><span class="line">            do &#123;</span><br><span class="line">                try &#123;</span><br><span class="line">                    Thread.sleep(1000);</span><br><span class="line">                &#125; catch (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                resource.add();</span><br><span class="line">            &#125; while (true);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="lock-和-condition-的await、signalAll"><a href="#lock-和-condition-的await、signalAll" class="headerlink" title="lock 和 condition 的await、signalAll"></a>lock 和 condition 的await、signalAll</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">public class LockCondition &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        Lock lock = new ReentrantLock();</span><br><span class="line">        Condition producerCondition = lock.newCondition();</span><br><span class="line">        Condition consumerCondition = lock.newCondition();</span><br><span class="line">        Resource resource = new Resource(lock, producerCondition, consumerCondition);</span><br><span class="line"></span><br><span class="line">        // 生产者线程</span><br><span class="line">        ProducerThread p1 = new ProducerThread(resource);</span><br><span class="line">        ProducerThread p2 = new ProducerThread(resource);</span><br><span class="line">        ProducerThread p3 = new ProducerThread(resource);</span><br><span class="line"></span><br><span class="line">        //消费者线程</span><br><span class="line">        ConsumerThread c1 = new ConsumerThread(resource);</span><br><span class="line">        ConsumerThread c2 = new ConsumerThread(resource);</span><br><span class="line">        ConsumerThread c3 = new ConsumerThread(resource);</span><br><span class="line"></span><br><span class="line">        p1.start();</span><br><span class="line">        p2.start();</span><br><span class="line">        p3.start();</span><br><span class="line">        c1.start();</span><br><span class="line">        c2.start();</span><br><span class="line">        c3.start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 公共资源类</span><br><span class="line">     */</span><br><span class="line">    private static class Resource &#123;</span><br><span class="line">        /**</span><br><span class="line">         * 当前资源数量</span><br><span class="line">         */</span><br><span class="line">        private int num = 0;</span><br><span class="line">        /**</span><br><span class="line">         * 资源池中允许存放的资源数目</span><br><span class="line">         */</span><br><span class="line">        private int size = 10;</span><br><span class="line"></span><br><span class="line">        private Lock lock;</span><br><span class="line"></span><br><span class="line">        private Condition producerCondition;</span><br><span class="line"></span><br><span class="line">        private Condition consumerCondition;</span><br><span class="line"></span><br><span class="line">        Resource(Lock lock, Condition producerCondition, Condition consumerCondition) &#123;</span><br><span class="line">            this.lock = lock;</span><br><span class="line">            this.producerCondition = producerCondition;</span><br><span class="line">            this.consumerCondition = consumerCondition;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        /**</span><br><span class="line">         * 向资源池中添加资源</span><br><span class="line">         */</span><br><span class="line">        void add() &#123;</span><br><span class="line">            //为什么此处上锁，1保证操作原子性，2实现线程间通讯需要调用signalAll，signalAll的使用需要在同步代码块</span><br><span class="line">            lock.lock();</span><br><span class="line">            try &#123;</span><br><span class="line">                if (num &lt; size) &#123;</span><br><span class="line">                    num++;</span><br><span class="line">                    System.out.println(Thread.currentThread().getName() + &quot;生产一件资源，当前资源池有&quot; + num + &quot;个&quot;);</span><br><span class="line">                    // 唤醒等待的消费者</span><br><span class="line">                    consumerCondition.signalAll();</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    try &#123;</span><br><span class="line">                        System.out.println(Thread.currentThread().getName() + &quot;线程进入等待&quot;);</span><br><span class="line">                        producerCondition.wait();</span><br><span class="line">                    &#125; catch (InterruptedException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; finally &#123;</span><br><span class="line">                lock.unlock();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        void remove() &#123;</span><br><span class="line">            lock.lock();</span><br><span class="line">            try &#123;</span><br><span class="line">                if (num &gt; 0) &#123;</span><br><span class="line">                    num--;</span><br><span class="line">                    System.out.println(Thread.currentThread().getName() + &quot;消耗一件资源，当前资源池有&quot; + num + &quot;个&quot;);</span><br><span class="line">                    // 唤醒等待的生产者</span><br><span class="line">                    producerCondition.signalAll();</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    // 让消费者等待</span><br><span class="line">                        System.out.println(Thread.currentThread().getName() + &quot;线程进入等待&quot;);</span><br><span class="line">                    try &#123;</span><br><span class="line">                        consumerCondition.await();</span><br><span class="line">                    &#125; catch (InterruptedException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">            &#125; finally &#123;</span><br><span class="line">                lock.unlock();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 消费者线程</span><br><span class="line">     */</span><br><span class="line">    static class ConsumerThread extends Thread &#123;</span><br><span class="line">        private Resource resource;</span><br><span class="line"></span><br><span class="line">        ConsumerThread(Resource resource) &#123;</span><br><span class="line">            this.resource = resource;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public void run() &#123;</span><br><span class="line">            do &#123;</span><br><span class="line">                try &#123;</span><br><span class="line">                    Random random= ThreadLocalRandom.current();</span><br><span class="line">                    Thread.sleep(random.nextInt(900) + 100);</span><br><span class="line">                &#125; catch (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                resource.remove();</span><br><span class="line">            &#125; while (true);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 生产者线程</span><br><span class="line">     */</span><br><span class="line">    static class ProducerThread extends Thread &#123;</span><br><span class="line">        private Resource resource;</span><br><span class="line"></span><br><span class="line">        ProducerThread(Resource resource) &#123;</span><br><span class="line">            this.resource = resource;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public void run() &#123;</span><br><span class="line">            while (true) &#123;</span><br><span class="line">                try &#123;</span><br><span class="line">                    Random random= ThreadLocalRandom.current();</span><br><span class="line">                    Thread.sleep(random.nextInt(900) + 100);</span><br><span class="line">                &#125; catch (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                resource.add();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="BlockingQueue"><a href="#BlockingQueue" class="headerlink" title="BlockingQueue"></a>BlockingQueue</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line">public class BlockingQueueConsumerProduct &#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        Resource resource = new Resource();</span><br><span class="line">        //生产者线程</span><br><span class="line">        ProducerThread p1 = new ProducerThread(resource);</span><br><span class="line">        ProducerThread p2 = new ProducerThread(resource);</span><br><span class="line">        ProducerThread p3 = new ProducerThread(resource);</span><br><span class="line"></span><br><span class="line">        //消费者线程</span><br><span class="line">        ConsumerThread c1 = new ConsumerThread(resource);</span><br><span class="line">//        ConsumerThread c2 = new ConsumerThread(resource);</span><br><span class="line">//        ConsumerThread c3 = new ConsumerThread(resource);</span><br><span class="line">        p1.start();</span><br><span class="line">        p2.start();</span><br><span class="line">        p3.start();</span><br><span class="line">        c1.start();</span><br><span class="line">//        c2.start();</span><br><span class="line">//        c3.start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    static class Resource&#123;</span><br><span class="line">        </span><br><span class="line">        private BlockingQueue&lt;Integer&gt; resourceQueue = new LinkedBlockingQueue&lt;&gt;(10);</span><br><span class="line"></span><br><span class="line">        /**</span><br><span class="line">         * 向资源池中添加资源</span><br><span class="line">         */</span><br><span class="line">        void add() &#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                resourceQueue.put(1);</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + &quot;生产资源,当前资源池有&quot; + resourceQueue.size() + &quot;个&quot;);</span><br><span class="line">            &#125; catch (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        /**</span><br><span class="line">         * 向资源池中移除资源</span><br><span class="line">         */</span><br><span class="line">        void remove()&#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                resourceQueue.take();</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + &quot;消耗1件资源,当前资源池有&quot; + resourceQueue.size() + &quot;个&quot;);</span><br><span class="line">            &#125; catch (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    static class ConsumerThread extends Thread&#123;</span><br><span class="line">        private Resource resource;</span><br><span class="line"></span><br><span class="line">        public ConsumerThread(Resource resource) &#123;</span><br><span class="line">            this.resource = resource;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public void run()&#123;</span><br><span class="line">            while(true) &#123;</span><br><span class="line">                try &#123;</span><br><span class="line">                    Thread.sleep(500);</span><br><span class="line">                &#125; catch (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                resource.remove();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    static class ProducerThread extends Thread&#123;</span><br><span class="line">        private Resource resource;</span><br><span class="line"></span><br><span class="line">        public ProducerThread(Resource resource) &#123;</span><br><span class="line">            this.resource = resource;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public void run()&#123;</span><br><span class="line">            while(true) &#123;</span><br><span class="line">                try &#123;</span><br><span class="line">                    Thread.sleep(500);</span><br><span class="line">                &#125; catch (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                resource.add();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="BlockingQueue的继承"><a href="#BlockingQueue的继承" class="headerlink" title="BlockingQueue的继承"></a>BlockingQueue的继承</h5><p>BlockingQueue是一个接口，继承Queue接口，Queue接口继承Collection</p>
<h5 id="BlockingQueue的方法"><a href="#BlockingQueue的方法" class="headerlink" title="BlockingQueue的方法"></a>BlockingQueue的方法</h5><ul>
<li>BlockingQueue具有4组不同的方法用于插入、移除以及对队列中的元素进行检查。如下</li>
</ul>
<table>
<thead>
<tr>
<th>分类</th>
<th>抛出异常</th>
<th>特殊值</th>
<th>阻塞</th>
<th>超时</th>
</tr>
</thead>
<tbody>
<tr>
<td>插入</td>
<td>add(e)</td>
<td>offer(e)</td>
<td>put(e)</td>
<td>offer(e, time, unit)</td>
</tr>
<tr>
<td>移除</td>
<td>remove()</td>
<td>poll()</td>
<td>take()</td>
<td>poll(time, unit)</td>
</tr>
<tr>
<td>检查</td>
<td>element()</td>
<td>peek()</td>
<td>不可用</td>
<td>不可用</td>
</tr>
</tbody>
</table>
<ul>
<li><p>四种不同的行为方式解释</p>
<ol>
<li>异常<br>如果试图的操作无法立即执行，抛一个异常</li>
<li>特定值<br>如果试图的操作无法立即执行，返回一个特定的值（通常是 true /false）</li>
<li>阻塞<br>如果试图的操作无法立即执行，该方法调用将会发生阻塞，直到能够执行</li>
<li>超时<br>如果试图的操作无法立即执行，该方法调用将会发生阻塞，直到能够执行，但等待时间不会超过给定值。返回一个特定值告知操作是否成功（通常是 true / false）</li>
</ol>
</li>
<li><p>BlockingQueue</p>
<ul>
<li><strong>不接受null元素</strong>。某些实现会抛出NPE。null被用作指示poll操作失败的警戒值</li>
<li><strong>可以限定容量</strong>。超出容量，无法无阻塞地put附加元素。没有容量约束会报告Integer.MAX_VALUE的剩余容量</li>
<li><strong>实现主要用于生产者-消费者队列，但它另外还支持Collection接口</strong>。因此，使用remove(x)移除元素是有可能的。然后，这种操作通常不会有效执行，只能有计划地偶尔使用，比如在取消排队信息时。</li>
<li><strong>实现是线程安全的</strong>。所有排队方法都可以使用内部所或其他形式的并发控制来自动达到它们的目的。然后大量的Collection操作（addAll、containsAll、retainAll和removeAll） 没有必要自动执行，除非在实现中特别说明。因此，若在只添加了c中一些元素后，addAll(c)可能失败（抛出异常）</li>
<li>**实质上不支持任何一种”close”或”shutdown”来指示不再添加任何项。</li>
</ul>
</li>
</ul>
<h3 id="有T1、T2、T3三个线程，如何保证T2在T1执行完后执行，T3在T2执行完后执行"><a href="#有T1、T2、T3三个线程，如何保证T2在T1执行完后执行，T3在T2执行完后执行" class="headerlink" title="有T1、T2、T3三个线程，如何保证T2在T1执行完后执行，T3在T2执行完后执行"></a>有T1、T2、T3三个线程，如何保证T2在T1执行完后执行，T3在T2执行完后执行</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">public class TestJoin</span><br><span class="line">&#123;</span><br><span class="line">    public static void main(String[] args)</span><br><span class="line">    &#123;</span><br><span class="line">        Thread t1 = new MyThread(&quot;线程1&quot;);</span><br><span class="line">        Thread t2 = new MyThread(&quot;线程2&quot;);</span><br><span class="line">        Thread t3 = new MyThread(&quot;线程3&quot;);</span><br><span class="line">        </span><br><span class="line">        try</span><br><span class="line">        &#123;</span><br><span class="line">            //t1先启动</span><br><span class="line">            t1.start();</span><br><span class="line">			// join() = join(0)，无限等待1线程，直到执行完</span><br><span class="line">            t1.join();</span><br><span class="line">            //t2</span><br><span class="line">            t2.start();</span><br><span class="line">            t2.join();</span><br><span class="line">            //t3</span><br><span class="line">            t3.start();</span><br><span class="line">            t3.join();</span><br><span class="line">        &#125;</span><br><span class="line">        catch (InterruptedException e)</span><br><span class="line">        &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class MyThread extend Thread&#123;</span><br><span class="line">    public MyThread(String name)&#123;</span><br><span class="line">        setName(name);</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    public void run()</span><br><span class="line">    &#123;</span><br><span class="line">        for (int i = 0; i &lt; 5; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName()+&quot;: &quot;+i);</span><br><span class="line">            try</span><br><span class="line">            &#123;</span><br><span class="line">                Thread.sleep(100);</span><br><span class="line">            &#125;</span><br><span class="line">            catch (InterruptedException e)</span><br><span class="line">            &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>主要使用了Thread类的<code>join()</code>方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">public final synchronized void join(long millis)</span><br><span class="line">    throws InterruptedException &#123;</span><br><span class="line">        long base = System.currentTimeMillis();</span><br><span class="line">        long now = 0;</span><br><span class="line"></span><br><span class="line">        if (millis &lt; 0) &#123;</span><br><span class="line">            throw new IllegalArgumentException(&quot;timeout value is negative&quot;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">	 // 如果线程存活调用wait，一直阻塞</span><br><span class="line">        if (millis == 0) &#123;</span><br><span class="line">            while (isAlive()) &#123;</span><br><span class="line">                wait(0);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">		 // 如果线程存活，计算需要当前线程执行的时间，超过millis退出</span><br><span class="line">            while (isAlive()) &#123;</span><br><span class="line">                long delay = millis - now;</span><br><span class="line">                if (delay &lt;= 0) &#123;</span><br><span class="line">                    break;</span><br><span class="line">                &#125;</span><br><span class="line">                wait(delay);</span><br><span class="line">                now = System.currentTimeMillis() - base;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h2 id="什么是ThreadLocal类，怎么使用它"><a href="#什么是ThreadLocal类，怎么使用它" class="headerlink" title="什么是ThreadLocal类，怎么使用它"></a>什么是ThreadLocal类，怎么使用它</h2><h3 id="ThreadLocal的定义和用途"><a href="#ThreadLocal的定义和用途" class="headerlink" title="ThreadLocal的定义和用途"></a>ThreadLocal的定义和用途</h3><ul>
<li>线程局部变量，在并发模式下是绝对安全的变量，也是线程封闭的一种标准用法（局部变量除外），即时定义为static，也是线程安全的</li>
<li>为每一个使用变量的线程提供一个变量值的副本，是java中一种较为特殊的线程绑定机制，是每个线程都可以独立的改变自己的副本，而不会和其他线程的副本发生冲突</li>
<li>线程消失之后，其线程局部实例的所有副本都会被垃圾回收机制回收（除非存在对这些副本的其他引用）</li>
</ul>
<h3 id="ThreadLocal能做什么"><a href="#ThreadLocal能做什么" class="headerlink" title="ThreadLocal能做什么"></a>ThreadLocal能做什么</h3><p>这个一句话不好说，我们不如来看看实际项目中遇到的一些困解：当你在项目中根据一些参数调用进入一些方法，然后方法再调用方法，进而跨对象调用方法，很多层次，这些方法可能都会用到一些相似的参数，例如，A中需要参数a、b、c，A调用B后，B中需要b、c参数，而B调用C方法需要a、b参数，此时不得不将所有的参数全部传递给B，以此类推，若有很多方法的调用，此时的参数就会越来越繁杂，另外，当程序需要增加参数的时候，此时需要对相关的方法逐个增加参数，是的，很麻烦，相信你也遇到过，这也是在C语言面向对象过来的一些常见处理手段，不过我们简单的处理方法是将它包装成对象传递进去，通过增加对象的属性就可以解决这个问题，不过对象通常是有意义的，所以有些时候简单的对象包装增加一些扩展不相关的属性会使得我们class的定义变得十分的奇怪，所以在这些情况下我们在架构这类复杂的程序的时候，我们通过使用一些类似于Scope的作用域的类来处理，名称和使用起来都会比较通用，类似web应用中会有context、session、request、page等级别的scope，而ThreadLocal也可以解决这类问题，只是他并不是很适合解决这类问题，它面对这些问题通常是初期并没有按照scope以及对象的方式传递，认为不会增加参数，当增加参数时，发现要改很多地方的地方，为了不破坏代码的结构，也有可能参数已经太多，已经使得方法的代码可读性降低，增加ThreadLocal来处理，例如，一个方法调用另一个方法时传入了8个参数，通过逐层调用到第N个方法，传入了其中一个参数，此时最后一个方法需要增加一个参数，第一个方法变成9个参数是自然的，但是这个时候，相关的方法都会受到牵连，使得代码变得臃肿不堪。</p>
<p>上面提及到了ThreadLocal一种亡羊补牢的用途，<strong>不过也不是特别推荐使用的方式，它还有一些类似的方式用来使用，就是在框架级别有很多动态调用，调用过程中需要满足一些协议，虽然协议我们会尽量的通用，而很多扩展的参数在定义协议时是不容易考虑完全的以及版本也是随时在升级的，但是在框架扩展时也需要满足接口的通用性和向下兼容，而一些扩展的内容我们就需要ThreadLocal来做方便简单的支持。</strong></p>
<p>简单来说，ThreadLocal是将一些复杂的系统扩展变成了简单定义，使得相关参数牵连的部分变得非常容易，以下是我们例子说明：</p>
<p><strong>Spring的事务管理器中，对数据源获取的Connection放入了ThreadLocal中，程序执行完后由ThreadLocal中获取connection然后做commit和rollback，使用中，要保证程序通过DataSource获取的connection就是从spring中获取的，为什么要做这样的操作呢，因为业务代码完全由应用程序来决定，而框架不能要求业务代码如何去编写，否则就失去了框架不让业务代码去管理connection的好处了，此时业务代码被切入后，spring不会向业务代码区传入一个connection，它必须保存在一个地方，当底层通过ibatis、spring jdbc等框架获取同一个datasource的connection的时候，就会调用按照spring约定的规则去获取，由于执行过程都是在同一个线程中处理，从而获取到相同的connection以保证commit、rollback以及业务操作过程中，使用的connection是同一个，因为只有同一个conneciton才能保证事务，否则数据库本身也是不支持的。</strong></p>
<p>其实在很多并发编程的应用中，ThreadLocal起着很重要的重要，它不加锁，非常轻松的将线程封闭做得天衣无缝，又不会像局部变量那样每次需要从新分配空间，很多空间由于是线程安全，所以，可以反复利用线程私有的缓冲区。</p>
<h3 id="什么是死锁？如何解决死锁问题"><a href="#什么是死锁？如何解决死锁问题" class="headerlink" title="什么是死锁？如何解决死锁问题"></a>什么是死锁？如何解决死锁问题</h3><h4 id="死锁"><a href="#死锁" class="headerlink" title="死锁"></a>死锁</h4><p>死锁是指两个或两个以上的进程在执行过程中，因竞争资源而造成的一种互相等待的现象，若无外力作用，他们都将无法推进下来。此时称系统处于死锁状态或系统产生了死锁，这些永远在互相等待的进程称为死锁进程。<br>由于资源占用是互斥的，当某个进程提出申请资源后，使得有关进程在无外力协助下，永远分配不到必须的资源而无法继续运作，这就产生了一种特殊现象死锁。</p>
<h4 id="死锁发生所具备的条件"><a href="#死锁发生所具备的条件" class="headerlink" title="死锁发生所具备的条件"></a>死锁发生所具备的条件</h4><ol>
<li>互斥条件</li>
<li>请求和保持条件</li>
<li>不剥夺条件</li>
<li>环路等待条件</li>
</ol>
<h4 id="如何解决死锁"><a href="#如何解决死锁" class="headerlink" title="如何解决死锁"></a>如何解决死锁</h4><ol>
<li>按同一顺序访问对象<br>如果所有并发事务按同一顺序访问对象，则发生死锁的可能性会降低。例如：如果两个并发事务获得Supplier表上的锁，然后获得Part表上的锁，则在其中一个事务完成之前，另一个事务被阻塞在Supplier表上。第一个事务提交或回滚后，第二个事务继续进行。不发生死锁。将存储过程用于所有的数据修改可以标准化访问对象的顺序。</li>
<li>避免事务中的用户交互<br>避免编写包含用户交互的事务，因为运行没有用户交互的批处理的速度要圆圆快于用户手动响应查询的速度，例如答复应用程序请求参数的提示。例如，如果事务正在等待用户输入，而用户去吃午餐了或者甚至回家过周末了，则用户将此事务挂起使之不能完成。这样将降低系统的吞吐量，因为事务持有的任何锁只有在事务提交或回滚时才会释放，即使不出现死锁的情况，访问同一资源的其他事务也会被阻塞，等待该事务完成。</li>
<li>保持事务简单并在一个批处理中<br>在同一数据库中并发执行多个需要长时间运行的事务时通常发生死锁。事务运行时间越长，其持有排它锁或更新锁的时间也就越长，从而堵塞了其他活动并可能导致死锁。包吃事务在一个批处理中，可以最小化事务的网络通信往返量，减少完成事务可能的延迟并释放锁。</li>
<li>使用低隔离级别<br>确定事务是否能在更低的隔离级别上运行，执行提交读允许事务读取另一个事务已读取（未修改）的数据，而不必等待第一个事务完成。使用较低的隔离级别（例如隔离读）而不使用较高的隔离级别（例如可串行读）可以缩短持有共享锁的时间，从而降低了锁定争夺。</li>
<li>使用绑定连接<br>使用绑定连接同一应用程序锁打开的两个或多个连接可以相互合作，次级连接锁获得的任何锁可以象由住连接获得的锁那样持有，反之亦然，因此不会相互阻塞。</li>
</ol>

        
    

    
</div>


                

                <!-- Post Comments -->
                
                    
                
            </div>

            <!-- Post Prev & Next Nav -->
            <nav class="material-nav mdl-color-text--grey-50 mdl-cell mdl-cell--12-col">
    <!-- Prev Nav -->
    
        <a href="/2016/09/15/databaseOptimize/" id="post_nav-newer" class="prev-content">
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_back</i>
            </button>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            新篇
        </a>
    

    <!-- Section Spacer -->
    <div class="section-spacer"></div>

    <!-- Next Nav -->
    
        <a href="/2016/08/02/network/" id="post_nav-older" class="next-content">
            旧篇
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_forward</i>
            </button>
        </a>
    
</nav>

        </div>
    </div>



                    
                        <!-- Overlay For Active Sidebar -->
<div class="sidebar-overlay"></div>

<!-- Material sidebar -->
<aside id="sidebar" class="sidebar sidebar-colored sidebar-fixed-left" role="navigation">
    <div id="sidebar-main">
        <!-- Sidebar Header -->
        <div class="sidebar-header header-cover" style="background-image: url(/img/sidebar_header.png);">
    <!-- Top bar -->
    <div class="top-bar"></div>

    <!-- Sidebar toggle button -->
    <button type="button" class="sidebar-toggle mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" style="display: initial;" data-upgraded=",MaterialButton,MaterialRipple">
        <i class="material-icons">clear_all</i>
        <span class="mdl-button__ripple-container">
            <span class="mdl-ripple">
            </span>
        </span>
    </button>

    <!-- Sidebar Avatar -->
    <div class="sidebar-image">
        <img src="/img/avatar.png" alt="WarmCute's avatar">
    </div>

    <!-- Sidebar Email -->
    <a data-toggle="dropdown" class="sidebar-brand" href="#settings-dropdown">
        youremail@email.com
        <b class="caret"></b>
    </a>
</div>


        <!-- Sidebar Navigation  -->
        <ul class="nav sidebar-nav">
    <!-- User dropdown  -->
    <li class="dropdown">
        <ul id="settings-dropdown" class="dropdown-menu">
            
                <li>
                    <a href="#" target="_blank" title="Email Me">
                        
                            <i class="material-icons sidebar-material-icons sidebar-indent-left1pc-element">email</i>
                        
                        Email Me
                    </a>
                </li>
            
        </ul>
    </li>

    <!-- Homepage -->
    
        <li id="sidebar-first-li">
            <a href="/">
                
                    <i class="material-icons sidebar-material-icons">home</i>
                
                主页
            </a>
        </li>
        
    

    <!-- Archives  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">inbox</i>
                
                    归档
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
            <li>
                <a class="sidebar_archives-link" href="/archives/2019/04/">四月 2019<span class="sidebar_archives-count">9</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/03/">三月 2018<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/01/">一月 2018<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/12/">十二月 2017<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/11/">十一月 2017<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/10/">十月 2017<span class="sidebar_archives-count">5</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/09/">九月 2017<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/04/">四月 2017<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/03/">三月 2017<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/01/">一月 2017<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/11/">十一月 2016<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/10/">十月 2016<span class="sidebar_archives-count">5</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/09/">九月 2016<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/08/">八月 2016<span class="sidebar_archives-count">1</span></a>
            </li></ul>
        </li>
        
    

    <!-- Categories  -->
    

    <!-- Pages  -->
    

    <!-- Article Number  -->
    
</ul>


        <!-- Sidebar Footer -->
        <!--
I'm glad you use this theme, the development is no so easy, I hope you can keep the copyright, I will thank you so much.
If you still want to delete the copyrights, could you still retain the first one? Which namely "Theme Material"
It will not impact the appearance and can give developers a lot of support :)

很高兴您使用并喜欢该主题，开发不易 十分谢谢与希望您可以保留一下版权声明。
如果您仍然想删除的话 能否只保留第一项呢？即 "Theme Material"
它不会影响美观并可以给开发者很大的支持和动力。 :)
-->

<!-- Sidebar Divider -->

    <div class="sidebar-divider"></div>


<!-- Theme Material -->

    <a href="https://github.com/viosey/hexo-theme-material" class="sidebar-footer-text-a" target="_blank">
        <div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
            主题 - Material
            <span class="sidebar-badge badge-circle">i</span>
        </div>
    </a>


<!-- Help & Support -->
<!--

-->

<!-- Feedback -->
<!--

-->

<!-- About Theme -->
<!--

-->

    </div>

    <!-- Sidebar Image -->
    

</aside>

                    

                    
                        <!-- Footer Top Button -->
                        <div id="back-to-top" class="toTop-wrap">
    <a href="#top" class="toTop">
        <i class="material-icons footer_top-i">expand_less</i>
    </a>
</div>

                    

                    <!--Footer-->
<footer class="mdl-mini-footer" id="bottom">
    
        <!-- Paradox Footer Left Section -->
        <div class="mdl-mini-footer--left-section sns-list">
    <!-- Twitter -->
    
        <a href="https://twitter.com/twitter" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-twitter">
                <span class="visuallyhidden">Twitter</span>
            </button><!--
     --></a>
    

    <!-- Facebook -->
    
        <a href="https://www.facebook.com/facebook" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-facebook">
                <span class="visuallyhidden">Facebook</span>
            </button><!--
     --></a>
    

    <!-- Google + -->
    
        <a href="https://www.google.com/" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-gplus">
                <span class="visuallyhidden">Google Plus</span>
            </button><!--
     --></a>
    

    <!-- Weibo -->
    

    <!-- Instagram -->
    

    <!-- Tumblr -->
    

    <!-- Github -->
    

    <!-- LinkedIn -->
    

    <!-- Zhihu -->
    

    <!-- Bilibili -->
    

    <!-- Telegram -->
    

    <!-- V2EX -->
    

    <!-- Segmentfault -->
    
</div>


        <!--Copyright-->
        <div id="copyright">
            Copyright&nbsp;©&nbsp;<span year></span>&nbsp;WarmCute's Blog
            
        </div>

        <!-- Paradox Footer Right Section -->

        <!--
        I am glad you use this theme, the development is no so easy, I hope you can keep the copyright.
        It will not impact the appearance and can give developers a lot of support :)

        很高兴您使用该主题，开发不易，希望您可以保留一下版权声明。
        它不会影响美观并可以给开发者很大的支持。 :)
        -->

        <div class="mdl-mini-footer--right-section">
            <div>
                <div class="footer-develop-div">Powered by <a href="https://hexo.io" target="_blank" class="footer-develop-a">Hexo</a></div>
                <div class="footer-develop-div">Theme - <a href="https://github.com/viosey/hexo-theme-material" target="_blank" class="footer-develop-a">Material</a></div>
            </div>
        </div>
    
</footer>


                    <!-- Import JS File -->

    <script>lsloader.load("lazyload_js","/js/lazyload.min.js?1BcfzuNXqV+ntF6gq+5X3Q==", true)</script>



    <script>lsloader.load("js_js","/js/js.min.js?Bn9UzEm8RrBSxqyZB0zPjA==", true)</script>



    <script>lsloader.load("np_js","/js/nprogress.js?pl3Qhb9lvqR1FlyLUna1Yw==", true)</script>


<script type="text/ls-javascript" id="NProgress-script">
    NProgress.configure({
        showSpinner: true
    });
    NProgress.start();
    $('#nprogress .bar').css({
        'background': '#29d'
    });
    $('#nprogress .peg').css({
        'box-shadow': '0 0 10px #29d, 0 0 15px #29d'
    });
    $('#nprogress .spinner-icon').css({
        'border-top-color': '#29d',
        'border-left-color': '#29d'
    });
    setTimeout(function() {
        NProgress.done();
        $('.fade').removeClass('out');
    }, 800);
</script>













<!-- UC Browser Compatible -->
<script>
	var agent = navigator.userAgent.toLowerCase();
	if(agent.indexOf('ucbrowser')>0) {
		document.write('<link rel="stylesheet" href="/css/uc.css">');
	   alert('由于 UC 浏览器使用极旧的内核，而本网站使用了一些新的特性。\n为了您能更好的浏览，推荐使用 Chrome 或 Firefox 浏览器。');
	}
</script>

<!-- Import prettify js  -->



<!-- Window Load -->
<!-- add class for prettify -->
<script type="text/ls-javascript" id="window-load">
    $(window).on('load', function() {
        // Post_Toc parent position fixed
        $('.post-toc-wrap').parent('.mdl-menu__container').css('position', 'fixed');
    });

    
    
</script>

<!-- MathJax Load-->


<!-- Bing Background -->


<script type="text/ls-javascript" id="lazy-load">
    // Offer LazyLoad
    queue.offer(function(){
        $('.lazy').lazyload({
            effect : 'show'
        });
    });

    // Start Queue
    $(document).ready(function(){
        setInterval(function(){
            queue.execNext();
        },200);
    });
</script>

<!-- Custom Footer -->



<script>
    var copyrightNow = new Date().getFullYear();
    var textContent = document.querySelector('span[year]')

    copyrightSince = 0000;
    if (copyrightSince === copyrightNow||copyrightSince === 0000) {
        textContent.textContent = copyrightNow
    } else {
        textContent.textContent = copyrightSince + ' - ' + copyrightNow
    }

    (function(){
        var scriptList = document.querySelectorAll('script[type="text/ls-javascript"]')

        for (var i = 0; i < scriptList.length; ++i) {
            var item = scriptList[i];
            lsloader.runInlineScript(item.id,item.id);
        }
    })()
console.log('\n %c © Material Theme | Version: 1.5.6 | https://github.com/viosey/hexo-theme-material %c \n', 'color:#455a64;background:#e0e0e0;padding:5px 0;border-top-left-radius:5px;border-bottom-left-radius:5px;', 'color:#455a64;background:#e0e0e0;padding:5px 0;border-top-right-radius:5px;border-bottom-right-radius:5px;');
</script>

                </main>
            </div>
        </body>
    
</html>
