<!DOCTYPE html>
<html style="display: none;" lang="zh">
    <head><meta name="generator" content="Hexo 3.8.0">
    <meta charset="utf-8">
    <!--
        © Material Theme
        https://github.com/viosey/hexo-theme-material
        Version: 1.5.6 -->
    <script>
        window.materialVersion = "1.5.6"
        // Delete localstorage with these tags
        window.oldVersion = [
            'codestartv1',
            '1.3.4',
            '1.4.0',
            '1.4.0b1',
            '1.5.0',
            '1.5.2',
            '1.5.5'
        ]
    </script>

    <!-- dns prefetch -->
    <meta http-equiv="x-dns-prefetch-control" content="on">









    <link rel="dns-prefetch" href="https://fonts.googleapis.com">





    <!-- Meta & Info -->
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta name="renderer" content="webkit">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!-- Title -->
    
    <title>
        
            Spring Boot 2.1.X 学习笔记 | 
        
        WarmCute&#39;s Blog
    </title>

    <!-- Favicons -->
    <link rel="icon shortcut" type="image/ico" href="/img/favicon.png">
    <link rel="icon" href="/img/favicon.png">

    <meta name="format-detection" content="telephone=no">
    <meta name="description" itemprop="description" content>
    <meta name="keywords" content>
    <meta name="theme-color" content="#0097A7">

    <!-- Disable Fucking Bloody Baidu Tranformation -->
    <meta http-equiv="Cache-Control" content="no-transform">
    <meta http-equiv="Cache-Control" content="no-siteapp">

    <!--[if lte IE 9]>
        <link rel="stylesheet" href="/css/ie-blocker.css">

        
            <script src="/js/ie-blocker.zhCN.js"></script>
        
    <![endif]-->

    <!-- Import lsloader -->
    <script>(function(){window.lsloader={jsRunSequence:[],jsnamemap:{},cssnamemap:{}};lsloader.removeLS=function(a){try{localStorage.removeItem(a)}catch(b){}};lsloader.setLS=function(a,c){try{localStorage.setItem(a,c)}catch(b){}};lsloader.getLS=function(a){var c="";try{c=localStorage.getItem(a)}catch(b){c=""}return c};versionString="/*"+(window.materialVersion||"unknownVersion")+"*/";lsloader.clean=function(){try{var b=[];for(var a=0;a<localStorage.length;a++){b.push(localStorage.key(a))}b.forEach(function(e){var f=lsloader.getLS(e);if(window.oldVersion){var d=window.oldVersion.reduce(function(g,h){return g||f.indexOf("/*"+h+"*/")!==-1},false);if(d){lsloader.removeLS(e)}}})}catch(c){}};lsloader.clean();lsloader.load=function(f,a,b,d){if(typeof b==="boolean"){d=b;b=undefined}d=d||false;b=b||function(){};var e;e=this.getLS(f);if(e&&e.indexOf(versionString)===-1){this.removeLS(f);this.requestResource(f,a,b,d);return}if(e){var c=e.split(versionString)[0];if(c!=a){console.log("reload:"+a);this.removeLS(f);this.requestResource(f,a,b,d);return}e=e.split(versionString)[1];if(d){this.jsRunSequence.push({name:f,code:e});this.runjs(a,f,e)}else{document.getElementById(f).appendChild(document.createTextNode(e));b()}}else{this.requestResource(f,a,b,d)}};lsloader.requestResource=function(b,e,a,c){var d=this;if(c){this.iojs(e,b,function(h,f,g){d.setLS(f,h+versionString+g);d.runjs(h,f,g)})}else{this.iocss(e,b,function(f){document.getElementById(b).appendChild(document.createTextNode(f));d.setLS(b,e+versionString+f)},a)}};lsloader.iojs=function(d,b,g){var a=this;a.jsRunSequence.push({name:b,code:""});try{var f=new XMLHttpRequest();f.open("get",d,true);f.onreadystatechange=function(){if(f.readyState==4){if((f.status>=200&&f.status<300)||f.status==304){if(f.response!=""){g(d,b,f.response);return}}a.jsfallback(d,b)}};f.send(null)}catch(c){a.jsfallback(d,b)}};lsloader.iocss=function(f,c,h,a){var b=this;try{var g=new XMLHttpRequest();g.open("get",f,true);g.onreadystatechange=function(){if(g.readyState==4){if((g.status>=200&&g.status<300)||g.status==304){if(g.response!=""){h(g.response);a();return}}b.cssfallback(f,c,a)}};g.send(null)}catch(d){b.cssfallback(f,c,a)}};lsloader.iofonts=function(f,c,h,a){var b=this;try{var g=new XMLHttpRequest();g.open("get",f,true);g.onreadystatechange=function(){if(g.readyState==4){if((g.status>=200&&g.status<300)||g.status==304){if(g.response!=""){h(g.response);a();return}}b.cssfallback(f,c,a)}};g.send(null)}catch(d){b.cssfallback(f,c,a)}};lsloader.runjs=function(f,c,e){if(!!c&&!!e){for(var b in this.jsRunSequence){if(this.jsRunSequence[b].name==c){this.jsRunSequence[b].code=e}}}if(!!this.jsRunSequence[0]&&!!this.jsRunSequence[0].code&&this.jsRunSequence[0].status!="failed"){var a=document.createElement("script");a.appendChild(document.createTextNode(this.jsRunSequence[0].code));a.type="text/javascript";document.getElementsByTagName("head")[0].appendChild(a);this.jsRunSequence.shift();if(this.jsRunSequence.length>0){this.runjs()}}else{if(!!this.jsRunSequence[0]&&this.jsRunSequence[0].status=="failed"){var d=this;var a=document.createElement("script");a.src=this.jsRunSequence[0].path;a.type="text/javascript";this.jsRunSequence[0].status="loading";a.onload=function(){d.jsRunSequence.shift();if(d.jsRunSequence.length>0){d.runjs()}};document.body.appendChild(a)}}};lsloader.tagLoad=function(b,a){this.jsRunSequence.push({name:a,code:"",path:b,status:"failed"});this.runjs()};lsloader.jsfallback=function(c,b){if(!!this.jsnamemap[b]){return}else{this.jsnamemap[b]=b}for(var a in this.jsRunSequence){if(this.jsRunSequence[a].name==b){this.jsRunSequence[a].code="";this.jsRunSequence[a].status="failed";this.jsRunSequence[a].path=c}}this.runjs()};lsloader.cssfallback=function(e,c,b){if(!!this.cssnamemap[c]){return}else{this.cssnamemap[c]=1}var d=document.createElement("link");d.type="text/css";d.href=e;d.rel="stylesheet";d.onload=d.onerror=b;var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(d,a)};lsloader.runInlineScript=function(c,b){var a=document.getElementById(b).innerText;this.jsRunSequence.push({name:c,code:a});this.runjs()}})();</script>

    <!-- Import queue -->
    <script>function Queue(){this.dataStore=[];this.offer=b;this.poll=d;this.execNext=a;this.debug=false;this.startDebug=c;function b(e){if(this.debug){console.log("Offered a Queued Function.")}if(typeof e==="function"){this.dataStore.push(e)}else{console.log("You must offer a function.")}}function d(){if(this.debug){console.log("Polled a Queued Function.")}return this.dataStore.shift()}function a(){var e=this.poll();if(e!==undefined){if(this.debug){console.log("Run a Queued Function.")}e()}}function c(){this.debug=true}}var queue=new Queue();</script>

    <!-- Import CSS -->
    
        <style id="material_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("material_css","/css/material.min.css?Z7a72R1E4SxzBKR/WGctOA==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>
        <style id="style_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("style_css","/css/style.min.css?NKhlKQkXw/c66TR5p4wO+w==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>

        

    

    

    <!-- Config CSS -->

<!-- Other Styles -->
<style>
  body, html {
    font-family: Roboto, "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "微软雅黑", Arial, sans-serif;
    overflow-x: hidden !important;
  }
  
  code {
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  }

  a {
    color: #00838F;
  }

  .mdl-card__media,
  #search-label,
  #search-form-label:after,
  #scheme-Paradox .hot_tags-count,
  #scheme-Paradox .sidebar_archives-count,
  #scheme-Paradox .sidebar-colored .sidebar-header,
  #scheme-Paradox .sidebar-colored .sidebar-badge{
    background-color: #0097A7 !important;
  }

  /* Sidebar User Drop Down Menu Text Color */
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:hover,
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:focus {
    color: #0097A7 !important;
  }

  #post_entry-right-info,
  .sidebar-colored .sidebar-nav li:hover > a,
  .sidebar-colored .sidebar-nav li:hover > a i,
  .sidebar-colored .sidebar-nav li > a:hover,
  .sidebar-colored .sidebar-nav li > a:hover i,
  .sidebar-colored .sidebar-nav li > a:focus i,
  .sidebar-colored .sidebar-nav > .open > a,
  .sidebar-colored .sidebar-nav > .open > a:hover,
  .sidebar-colored .sidebar-nav > .open > a:focus,
  #ds-reset #ds-ctx .ds-ctx-entry .ds-ctx-head a {
    color: #0097A7 !important;
  }

  .toTop {
    background: #757575 !important;
  }

  .material-layout .material-post>.material-nav,
  .material-layout .material-index>.material-nav,
  .material-nav a {
    color: #757575;
  }

  #scheme-Paradox .MD-burger-layer {
    background-color: #757575;
  }

  #scheme-Paradox #post-toc-trigger-btn {
    color: #757575;
  }

  .post-toc a:hover {
    color: #00838F;
    text-decoration: underline;
  }

</style>


<!-- Theme Background Related-->

    <style>
      body{
        background-color: #F5F5F5;
      }

      /* blog_info bottom background */
      #scheme-Paradox .material-layout .something-else .mdl-card__supporting-text{
        background-color: #fff;
      }
    </style>




<!-- Fade Effect -->

    <style>
      .fade {
        transition: all 800ms linear;
        -webkit-transform: translate3d(0,0,0);
        -moz-transform: translate3d(0,0,0);
        -ms-transform: translate3d(0,0,0);
        -o-transform: translate3d(0,0,0);
        transform: translate3d(0,0,0);
        opacity: 1;
      }

      .fade.out{
        opacity: 0;
      }
    </style>


<!-- Import Font -->
<!-- Import Roboto -->

    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500" rel="stylesheet">


<!-- Import Material Icons -->


    <style id="material_icons"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("material_icons","/css/material-icons.css?pqhB/Rd/ab0H2+kZp0RDmw==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>




    <!-- Import jQuery -->
    
        <script>lsloader.load("jq_js","/js/jquery.min.js?qcusAULNeBksqffqUM2+Ig==", true)</script>
    

    <!-- WebAPP Icons -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="WarmCute&#39;s Blog">
    <meta name="msapplication-starturl" content="http://yoursite.com/2019/04/15/springBoot/">
    <meta name="msapplication-navbutton-color" content="#0097A7">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="WarmCute&#39;s Blog">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon" href="/img/favicon.png">

    <!-- Site Verification -->
    
    

    <!-- RSS -->
    

    <!-- The Open Graph protocol -->
    <meta property="og:url" content="http://yoursite.com/2019/04/15/springBoot/">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="Spring Boot 2.1.X 学习笔记 | WarmCute&#39;s Blog">
    <meta property="og:image" content="/img/favicon.png">
    <meta property="og:description" content>
    

    
        <meta property="article:published_time" content="Mon Apr 15 2019 15:29:35 GMT+0800">
        <meta property="article:modified_time" content="Sun May 19 2019 13:14:28 GMT+0800">
    

    <!-- The Twitter Card protocol -->
    <meta name="twitter:card" content="summary_large_image">

    <!-- Add canonical link for SEO -->
    
        <link rel="canonical" href="http://yoursite.com/2019/04/15/springBoot/index.html">
    

    <!-- Structured-data for SEO -->
    
        


<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "mainEntityOfPage": "http://yoursite.com/2019/04/15/springBoot/index.html",
    "headline": "Spring Boot 2.1.X 学习笔记",
    "datePublished": "Mon Apr 15 2019 15:29:35 GMT+0800",
    "dateModified": "Sun May 19 2019 13:14:28 GMT+0800",
    "author": {
        "@type": "Person",
        "name": "WarmCute",
        "image": {
            "@type": "ImageObject",
            "url": "/img/avatar.png"
        },
        "description": "隐约雷鸣 阴霾天空,但盼风雨来 能留你在此"
    },
    "publisher": {
        "@type": "Organization",
        "name": "WarmCute&#39;s Blog",
        "logo": {
            "@type":"ImageObject",
            "url": "/img/favicon.png"
        }
    },
    "keywords": "",
    "description": "",
}
</script>


    

    <!-- Analytics -->
    
    
    

    <!-- Custom Head -->
    

</head>


    
        <body id="scheme-Paradox" class="lazy">
            <div class="material-layout  mdl-js-layout has-drawer is-upgraded">
                

                <!-- Main Container -->
                <main class="material-layout__content" id="main">

                    <!-- Top Anchor -->
                    <div id="top"></div>

                    
                        <!-- Hamburger Button -->
                        <button class="MD-burger-icon sidebar-toggle">
                            <span id="MD-burger-id" class="MD-burger-layer"></span>
                        </button>
                    

                    <!-- Post TOC -->

    
    <!-- Back Button -->
    <!--
    <div class="material-back" id="backhome-div" tabindex="0">
        <a class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon"
           href="#" onclick="window.history.back();return false;"
           target="_self"
           role="button"
           data-upgraded=",MaterialButton,MaterialRipple">
            <i class="material-icons" role="presentation">arrow_back</i>
            <span class="mdl-button__ripple-container">
                <span class="mdl-ripple"></span>
            </span>
        </a>
    </div>
    -->


    <!-- Left aligned menu below button -->
    
    
    <button id="post-toc-trigger-btn" class="mdl-button mdl-js-button mdl-button--icon">
        <i class="material-icons">format_list_numbered</i>
    </button>

    <ul class="post-toc-wrap mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect" for="post-toc-trigger-btn" style="max-height:80vh; overflow-y:scroll;">
        <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Spring-Boot-简介"><span class="post-toc-number">1.</span> <span class="post-toc-text">Spring Boot 简介</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#第一阶段-xml配置"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">第一阶段: xml配置</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#第二阶段-注解配置"><span class="post-toc-number">1.2.</span> <span class="post-toc-text">第二阶段: 注解配置</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#第三阶段-Java配置"><span class="post-toc-number">1.3.</span> <span class="post-toc-text">第三阶段: Java配置</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Spring-Boot-2-x-新特性"><span class="post-toc-number">2.</span> <span class="post-toc-text">Spring Boot 2.x 新特性</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#搭建Spring-Boot-项目"><span class="post-toc-number">3.</span> <span class="post-toc-text">搭建Spring Boot 项目</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#使用”spring-boot-starter-parent”的方式"><span class="post-toc-number">3.1.</span> <span class="post-toc-text">使用”spring-boot-starter-parent”的方式</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#pom-文件"><span class="post-toc-number">3.1.1.</span> <span class="post-toc-text">pom 文件</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Application-java"><span class="post-toc-number">3.1.2.</span> <span class="post-toc-text">Application.java</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#HelloController-java"><span class="post-toc-number">3.1.3.</span> <span class="post-toc-text">HelloController.java</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#不继承官方的parent"><span class="post-toc-number">3.2.</span> <span class="post-toc-text">不继承官方的parent</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#自定义banner"><span class="post-toc-number">4.</span> <span class="post-toc-text">自定义banner</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#普通banner"><span class="post-toc-number">4.1.</span> <span class="post-toc-text">普通banner</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#动态GIF-banner"><span class="post-toc-number">4.2.</span> <span class="post-toc-text">动态GIF banner</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#属性配置"><span class="post-toc-number">5.</span> <span class="post-toc-text">属性配置</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#常规属性配置"><span class="post-toc-number">5.1.</span> <span class="post-toc-text">常规属性配置</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Value"><span class="post-toc-number">5.1.1.</span> <span class="post-toc-text">@Value</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#启动参数"><span class="post-toc-number">5.1.1.1.</span> <span class="post-toc-text">启动参数</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#application-properties"><span class="post-toc-number">5.1.1.2.</span> <span class="post-toc-text">application.properties</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#类型安全的属性配置-推荐"><span class="post-toc-number">5.2.</span> <span class="post-toc-text">类型安全的属性配置 (推荐)</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#YMAL"><span class="post-toc-number">5.2.1.</span> <span class="post-toc-text">YMAL</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#多种多样的属性配置"><span class="post-toc-number">5.3.</span> <span class="post-toc-text">多种多样的属性配置</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#AppProps-java"><span class="post-toc-number">5.3.1.</span> <span class="post-toc-text">AppProps.java</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#application-yml"><span class="post-toc-number">5.3.2.</span> <span class="post-toc-text">application.yml</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#profile-针对不同环境使用不同配置"><span class="post-toc-number">5.4.</span> <span class="post-toc-text">profile: 针对不同环境使用不同配置</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#日志"><span class="post-toc-number">6.</span> <span class="post-toc-text">日志</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#SpringBoot中提供的日志的配置参数"><span class="post-toc-number">6.1.</span> <span class="post-toc-text">SpringBoot中提供的日志的配置参数</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Slf4j"><span class="post-toc-number">6.2.</span> <span class="post-toc-text">@Slf4j</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#单元测试"><span class="post-toc-number">7.</span> <span class="post-toc-text">单元测试</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#简单实例"><span class="post-toc-number">7.1.</span> <span class="post-toc-text">简单实例</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#TestConfiguration"><span class="post-toc-number">7.2.</span> <span class="post-toc-text">@TestConfiguration</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#TestConfiguration-应用实例"><span class="post-toc-number">7.3.</span> <span class="post-toc-text">@TestConfiguration 应用实例</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#使用mock方式对controller进行单元测试（无需运行web服务）"><span class="post-toc-number">7.4.</span> <span class="post-toc-text">使用mock方式对controller进行单元测试（无需运行web服务）</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#对随机端口进行单元测试"><span class="post-toc-number">7.4.1.</span> <span class="post-toc-text">对随机端口进行单元测试</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#打开随机端口"><span class="post-toc-number">7.4.1.1.</span> <span class="post-toc-text">打开随机端口</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#编写测试类"><span class="post-toc-number">7.4.1.2.</span> <span class="post-toc-text">编写测试类</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#使用mock方式对controller进行单元测试（需运行web服务且-使用webflux）"><span class="post-toc-number">7.5.</span> <span class="post-toc-text">使用mock方式对controller进行单元测试（需运行web服务且 使用webflux）</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#编写测试类-1"><span class="post-toc-number">7.5.1.</span> <span class="post-toc-text">编写测试类</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#MockBean-对bean进行mock测试"><span class="post-toc-number">7.6.</span> <span class="post-toc-text">@MockBean 对bean进行mock测试</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#编写单元测试代码"><span class="post-toc-number">7.6.1.</span> <span class="post-toc-text">编写单元测试代码</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#测试json-JsonTest"><span class="post-toc-number">7.7.</span> <span class="post-toc-text">测试json @JsonTest</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#有时候我们会自定义序列化风格，这里对-JsonComponent进行测试："><span class="post-toc-number">7.7.1.</span> <span class="post-toc-text">有时候我们会自定义序列化风格，这里对@JsonComponent进行测试：</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#编写测试类-2"><span class="post-toc-number">7.7.2.</span> <span class="post-toc-text">编写测试类</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#TestPropertySource-对属性配置进行mock"><span class="post-toc-number">7.8.</span> <span class="post-toc-text">@TestPropertySource 对属性配置进行mock</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#使用spring提供的-PropertySource"><span class="post-toc-number">7.8.1.</span> <span class="post-toc-text">使用spring提供的@PropertySource</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#对springboot提供的类型安全的属性配置进行mock"><span class="post-toc-number">7.9.</span> <span class="post-toc-text">对springboot提供的类型安全的属性配置进行mock</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#为单元测试单独提供测试配置"><span class="post-toc-number">7.10.</span> <span class="post-toc-text">为单元测试单独提供测试配置</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#对AOP进行测试"><span class="post-toc-number">7.11.</span> <span class="post-toc-text">对AOP进行测试</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#引入AOP依赖"><span class="post-toc-number">7.11.1.</span> <span class="post-toc-text">引入AOP依赖</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#对AOP进行测试-1"><span class="post-toc-number">7.11.2.</span> <span class="post-toc-text">对AOP进行测试</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#另一种AOP测试"><span class="post-toc-number">7.12.</span> <span class="post-toc-text">另一种AOP测试</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#SpringBoot-整合MyBatis"><span class="post-toc-number">8.</span> <span class="post-toc-text">SpringBoot 整合MyBatis</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#创建表"><span class="post-toc-number">8.1.</span> <span class="post-toc-text">创建表</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#引入依赖"><span class="post-toc-number">8.2.</span> <span class="post-toc-text">引入依赖</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#MybatisGenerator插件"><span class="post-toc-number">8.3.</span> <span class="post-toc-text">MybatisGenerator插件</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#在src-main-resources-generator目录下新建generatorConfig-xml"><span class="post-toc-number">8.4.</span> <span class="post-toc-text">在src/main/resources/generator目录下新建generatorConfig.xml</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#application-yml-1"><span class="post-toc-number">8.5.</span> <span class="post-toc-text">application.yml</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#MAVEN中双击执行mybatis-generator-generate生成mapper及实体类。"><span class="post-toc-number">8.6.</span> <span class="post-toc-text">MAVEN中双击执行mybatis-generator:generate生成mapper及实体类。</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#User-java"><span class="post-toc-number">8.6.1.</span> <span class="post-toc-text">User.java</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#UserExample-java"><span class="post-toc-number">8.6.2.</span> <span class="post-toc-text">UserExample.java</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#UserMapper-java"><span class="post-toc-number">8.6.3.</span> <span class="post-toc-text">UserMapper.java</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#UserSqlProvider-java"><span class="post-toc-number">8.6.4.</span> <span class="post-toc-text">UserSqlProvider.java</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#编写一个简单的CRUD"><span class="post-toc-number">8.7.</span> <span class="post-toc-text">编写一个简单的CRUD</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#UserInfoService-java"><span class="post-toc-number">8.7.1.</span> <span class="post-toc-text">UserInfoService.java</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#UserInfoServiceImpl-java"><span class="post-toc-number">8.7.2.</span> <span class="post-toc-text">UserInfoServiceImpl.java</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#UserInfoController-java"><span class="post-toc-number">8.7.3.</span> <span class="post-toc-text">UserInfoController.java</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#SpringBoot-配置多数据源和事务"><span class="post-toc-number">9.</span> <span class="post-toc-text">SpringBoot 配置多数据源和事务</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#多数据源属性配置"><span class="post-toc-number">9.1.</span> <span class="post-toc-text">多数据源属性配置</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#application-yml-需要增加第二个数据源的配置"><span class="post-toc-number">9.1.1.</span> <span class="post-toc-text">application.yml 需要增加第二个数据源的配置</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#配置数据源及事务"><span class="post-toc-number">9.1.2.</span> <span class="post-toc-text">配置数据源及事务</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#SpringBoot-集成-Redis"><span class="post-toc-number">10.</span> <span class="post-toc-text">SpringBoot 集成 Redis</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#序列化"><span class="post-toc-number">10.1.</span> <span class="post-toc-text">序列化</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#StringRedisTemplate"><span class="post-toc-number">10.1.1.</span> <span class="post-toc-text">StringRedisTemplate</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#RedisTemplate"><span class="post-toc-number">10.2.</span> <span class="post-toc-text">RedisTemplate</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#切换序列化方式"><span class="post-toc-number">10.3.</span> <span class="post-toc-text">切换序列化方式</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#集成多数据源"><span class="post-toc-number">11.</span> <span class="post-toc-text">集成多数据源</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#多数据源配置"><span class="post-toc-number">11.1.</span> <span class="post-toc-text">多数据源配置</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Lettuce"><span class="post-toc-number">11.1.1.</span> <span class="post-toc-text">Lettuce</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Jedis"><span class="post-toc-number">11.2.</span> <span class="post-toc-text">Jedis</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#SpringBoot-整合-Dubbo"><span class="post-toc-number">12.</span> <span class="post-toc-text">SpringBoot 整合 Dubbo</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#环境搭建"><span class="post-toc-number">12.1.</span> <span class="post-toc-text">环境搭建</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#zk搭建"><span class="post-toc-number">12.1.1.</span> <span class="post-toc-text">zk搭建</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#dubbo搭建"><span class="post-toc-number">12.1.2.</span> <span class="post-toc-text">dubbo搭建</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#项目结构"><span class="post-toc-number">12.2.</span> <span class="post-toc-text">项目结构</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#版本控制"><span class="post-toc-number">12.3.</span> <span class="post-toc-text">版本控制</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#demo-dubbo-interface"><span class="post-toc-number">12.4.</span> <span class="post-toc-text">demo-dubbo-interface</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#demo-dubbo-annotation"><span class="post-toc-number">12.5.</span> <span class="post-toc-text">demo-dubbo-annotation</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#demo-dubbo-annotation-provider"><span class="post-toc-number">12.5.1.</span> <span class="post-toc-text">demo-dubbo-annotation-provider</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#引入依赖pom-xml"><span class="post-toc-number">12.5.1.1.</span> <span class="post-toc-text">引入依赖pom.xml</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#DemoServiceImpl"><span class="post-toc-number">12.5.1.2.</span> <span class="post-toc-text">DemoServiceImpl</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#application-yml-2"><span class="post-toc-number">12.5.1.3.</span> <span class="post-toc-text">application.yml</span></a></li></ol></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#demo-dubbo-annotation-consumer"><span class="post-toc-number">12.5.2.</span> <span class="post-toc-text">demo-dubbo-annotation-consumer</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#DemoController"><span class="post-toc-number">12.5.2.1.</span> <span class="post-toc-text">DemoController</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#application-yml-3"><span class="post-toc-number">12.5.2.2.</span> <span class="post-toc-text">application.yml</span></a></li></ol></li></ol></li></ol></li></ol>
    </ul>
    




<!-- Layouts -->

    <!-- Post Module -->
    <div class="material-post_container">

        <div class="material-post mdl-grid">
            <div class="mdl-card mdl-shadow--4dp mdl-cell mdl-cell--12-col">

                <!-- Post Header(Thumbnail & Title) -->
                
    <!-- Paradox Post Header -->
    
        
            <!-- Random Thumbnail -->
            <div class="post_thumbnail-random mdl-card__media mdl-color-text--grey-50">
            <script type="text/ls-javascript" id="post-thumbnail-script">
    var randomNum = Math.floor(Math.random() * 19 + 1);

    $('.post_thumbnail-random').attr('data-original', '/img/random/material-' + randomNum + '.png');
    $('.post_thumbnail-random').addClass('lazy');
</script>

        
    
            <p class="article-headline-p">
                Spring Boot 2.1.X 学习笔记
            </p>
        </div>





                
                    <!-- Paradox Post Info -->
                    <div class="mdl-color-text--grey-700 mdl-card__supporting-text meta">

    <!-- Author Avatar -->
    <div id="author-avatar">
        <img src="/img/avatar.png" width="44px" height="44px" alt="Author Avatar">
    </div>
    <!-- Author Name & Date -->
    <div>
        <strong>WarmCute</strong>
        <span>4月 15, 2019</span>
    </div>

    <div class="section-spacer"></div>

    <!-- Favorite -->
    <!--
        <button id="article-functions-like-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon btn-like">
            <i class="material-icons" role="presentation">favorite</i>
            <span class="visuallyhidden">favorites</span>
        </button>
    -->

    <!-- Qrcode -->
    

    <!-- Tags (bookmark) -->
    

    <!-- Share -->
    
        <button id="article-fuctions-share-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">share</i>
    <span class="visuallyhidden">share</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-fuctions-share-button">
    

    

    <!-- Share Weibo -->
    
        <a class="post_share-link" href="http://service.weibo.com/share/share.php?appkey=&title=Spring Boot 2.1.X 学习笔记&url=http://yoursite.com/2019/04/15/springBoot/index.html&pic=http://yoursite.com/img/favicon.png&searchPic=false&style=simple" target="_blank">
            <li class="mdl-menu__item">
                分享到微博
            </li>
        </a>
    

    <!-- Share Twitter -->
    
        <a class="post_share-link" href="https://twitter.com/intent/tweet?text=Spring Boot 2.1.X 学习笔记&url=http://yoursite.com/2019/04/15/springBoot/index.html&via=WarmCute" target="_blank">
            <li class="mdl-menu__item">
                分享到 Twitter
            </li>
        </a>
    

    <!-- Share Facebook -->
    
        <a class="post_share-link" href="https://www.facebook.com/sharer/sharer.php?u=http://yoursite.com/2019/04/15/springBoot/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 Facebook
            </li>
        </a>
    

    <!-- Share Google+ -->
    
        <a class="post_share-link" href="https://plus.google.com/share?url=http://yoursite.com/2019/04/15/springBoot/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 Google+
            </li>
        </a>
    

    <!-- Share LinkedIn -->
    

    <!-- Share QQ -->
    

    <!-- Share Telegram -->
    
</ul>

    
</div>

                

                <!-- Post Content -->
                <div id="post-content" class="mdl-color-text--grey-700 mdl-card__supporting-text fade out">
    
        <h2 id="Spring-Boot-简介"><a href="#Spring-Boot-简介" class="headerlink" title="Spring Boot 简介"></a>Spring Boot 简介</h2><p>Spring诞生时是Java企业版的轻量级代替品。无需开发重量级的Enterprise JavaBean (EJB)，Spring 为企业级Java开发提供了一种相对简单的方法，通过依赖注入和面向切面变成，用简单的Java对象(Plain Old Java Object, POJO) 实现了EJB的功能。</p>
<p>虽然Spring的组件代码是轻量级的，但是配置是重量级的。</p>
<h3 id="第一阶段-xml配置"><a href="#第一阶段-xml配置" class="headerlink" title="第一阶段: xml配置"></a>第一阶段: xml配置</h3><p>在Sprng 1.x 时代，使用Spring开发满眼都是xml配置的bean，随着项目的扩大，我们需要把xml配置文件放到不同的配置文件里，那时需要频繁的在开发的累和配置文件之间进行切换。例如</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 配置Service --&gt;</span><br><span class="line">&lt;bean id = &quot;demoService&quot; class=&quot;com.lemon.service.demoService&quot;&gt;</span><br><span class="line">	&lt;property name=&quot;demoDao&quot; ref=&quot;demoDao&quot;&gt;&lt;/property&gt;</span><br><span class="line">&lt;/bean&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 配置dao --&gt;</span><br><span class="line">&lt;bean id = &quot;demoDao&quot; class=&quot;com.lemon.dao.demoDao&quot;&gt;</span><br><span class="line">	&lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&gt;&lt;/property&gt;</span><br><span class="line">&lt;/bean&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 配置数据源 --&gt;</span><br><span class="line">&lt;bean id=&quot;dataSource&quot; class=&quot;org.springframework.jdbc.datasource.DriverManagerDataSource&quot;&gt;</span><br><span class="line">	&lt;property name=&quot;driverClassName&quot; value=&quot;com.mysql.jdbc.Driver&quot;&gt;&lt;/property&gt;</span><br><span class="line">	&lt;property name=&quot;url&quot; value=&quot;jdbc:mysql://localhost:3306/spring5&quot;&gt;&lt;/property&gt;</span><br><span class="line">	&lt;property name=&quot;username&quot; value=&quot;root&quot;&gt;&lt;/property&gt;</span><br><span class="line">	&lt;property name=&quot;password&quot; value=&quot;1234&quot;&gt;&lt;/property&gt;</span><br><span class="line">&lt;/bean&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 事务管理器 --&gt;</span><br><span class="line">&lt;bean id=&quot;transactionManager&quot; class=&quot;org.springframework.jdbc.datasource.DataSourceTrasactionManager&quot;&gt;</span><br><span class="line">	&lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;&gt;&lt;/property&gt;</span><br><span class="line">&lt;/bean&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 使用tx名称空间下的标签配置事务的通知 --&gt;</span><br><span class="line">&lt;tx:advice id=&quot;txAdvice&quot; transaction-manager=&quot;transactionManager&quot;&gt;</span><br><span class="line">&lt;tx:attributes&gt;</span><br><span class="line">	&lt;tx:method name=&quot;*&quot; read-only=&quot;false&quot; propagation=&quot;REQUIRED&quot;/&gt;</span><br><span class="line">	&lt;tx:method name=&quot;find*&quot; read-only=&quot;true&gt; propagation=&quot;SUPPORTS&quot;/&gt;</span><br><span class="line">&lt;/tx:attributes&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 配置aop --&gt;</span><br><span class="line">&lt;aop:config&gt;</span><br><span class="line">&lt;!-- 配置切入点表达式&gt;</span><br><span class="line">&lt;aop:pointcut expression=&quot;execution(* com.lemon.service.*.*(..))&quot; id=&quot;pt1&quot;/&gt;</span><br><span class="line">&lt;!-- 建立切入点表达式和事务通知之间的关系 --&gt;</span><br><span class="line">&lt;aop:advisor advice-ref=&quot;txAdvice&quot; pointcut-ref=&quot;pt1&quot;/&gt;</span><br><span class="line">&lt;/aop:config&gt;</span><br></pre></td></tr></table></figure>
<h3 id="第二阶段-注解配置"><a href="#第二阶段-注解配置" class="headerlink" title="第二阶段: 注解配置"></a>第二阶段: 注解配置</h3><p>在Spring 2.x 时代，随着JDK1.5 带来的注解支持，Spring提供了声明Bean的注解（例如@Component、@Service），大大减少了配置量。主要使用的方式是应用的基本配置（如数据库配置）用xml，业务配置用注解</p>
<h3 id="第三阶段-Java配置"><a href="#第三阶段-Java配置" class="headerlink" title="第三阶段: Java配置"></a>第三阶段: Java配置</h3><p>spring 3.0 引入了基于java 的配置能力，这是一种类型安全的可重构配置方式，可以代替XML，我们目前刚好处于这个时代，Spring 4.x 和Spring Boot都推荐使用Java 配置。</p>
<h2 id="Spring-Boot-2-x-新特性"><a href="#Spring-Boot-2-x-新特性" class="headerlink" title="Spring Boot 2.x 新特性"></a>Spring Boot 2.x 新特性</h2><ol>
<li>基于 Java 8，支持 Java 9，这意味着不可以使用JDK7 或更旧的版本运行SpringBoot2.</li>
<li>支持 Quartz 调度程序</li>
<li>大大简化了安全自动配置</li>
<li>支持嵌入式 Netty</li>
<li>Tomcat, Undertow 和 Jetty 均已支持 HTTP/2</li>
<li>全新的执行器架构，支持 Spring MVC, WebFlux 和 Jersey</li>
<li>使用 Spring WebFlux/WebFlux.fn 提供响应式 Web 编程支持</li>
<li>为各种组件的响应式编程提供了自动化配置，如：Reactive Spring Data、Reactive Spring Security 等</li>
<li>用于响应式 Spring Data Cassandra, MongoDB, Couchbase 和 Redis 的自动化配置和启动器 POM</li>
<li>引入对 Kotlin 1.2.x 的支持，并提供了一个 runApplication 函数，让你通过惯用的 Kotlin 来运行 Spring Boot 应用程序。更多信息请参阅参考文档中对 Kotlin 的支持部分</li>
<li>启动时的 ASCII 图像 Spring Boot banner 现已支持 GIF</li>
</ol>
<h2 id="搭建Spring-Boot-项目"><a href="#搭建Spring-Boot-项目" class="headerlink" title="搭建Spring Boot 项目"></a>搭建Spring Boot 项目</h2><h3 id="使用”spring-boot-starter-parent”的方式"><a href="#使用”spring-boot-starter-parent”的方式" class="headerlink" title="使用”spring-boot-starter-parent”的方式"></a>使用”spring-boot-starter-parent”的方式</h3><h4 id="pom-文件"><a href="#pom-文件" class="headerlink" title="pom 文件"></a>pom 文件</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">    &lt;parent&gt;</span><br><span class="line">        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;2.1.4.RELEASE&lt;/version&gt;</span><br><span class="line">        &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;</span><br><span class="line">    &lt;/parent&gt;</span><br><span class="line">    &lt;groupId&gt;com.lemon&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;basicservice&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;</span><br><span class="line">    &lt;name&gt;basicservice&lt;/name&gt;</span><br><span class="line">    &lt;description&gt;Demo project for Spring Boot&lt;/description&gt;</span><br><span class="line"></span><br><span class="line">    &lt;properties&gt;</span><br><span class="line">        &lt;java.version&gt;1.8&lt;/java.version&gt;</span><br><span class="line">    &lt;/properties&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">    &lt;/dependencies&gt;</span><br><span class="line"></span><br><span class="line">    &lt;build&gt;</span><br><span class="line">        &lt;plugins&gt;</span><br><span class="line">            &lt;plugin&gt;</span><br><span class="line">                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;</span><br><span class="line">            &lt;/plugin&gt;</span><br><span class="line">        &lt;/plugins&gt;</span><br><span class="line">    &lt;/build&gt;</span><br><span class="line"></span><br><span class="line">&lt;/project&gt;</span><br></pre></td></tr></table></figure>
<h4 id="Application-java"><a href="#Application-java" class="headerlink" title="Application.java"></a>Application.java</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@SpringBootApplication</span><br><span class="line">public class BasicserviceApplication &#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        SpringApplication.run(BasicserviceApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="HelloController-java"><a href="#HelloController-java" class="headerlink" title="HelloController.java"></a>HelloController.java</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">@RestController</span><br><span class="line">public class HelloController &#123;</span><br><span class="line"></span><br><span class="line">    @GetMapping(&quot;/getHello&quot;)</span><br><span class="line">    public String getHello ()&#123;</span><br><span class="line">        return &quot;Hello World&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行程序，打开浏览器访问 localhost:8080/getHello 即可看到 Hello World</p>
<h3 id="不继承官方的parent"><a href="#不继承官方的parent" class="headerlink" title="不继承官方的parent"></a>不继承官方的parent</h3><p>翻看了官方文档.发现有这样一段,特地记下.</p>
<blockquote>
<p>Not everyone likes inheriting from the spring-boot-starter-parent POM. You may have your own corporate standard parent that you need to use or you may prefer to explicitly declare all your Maven configuration.<br>If you do not want to use the spring-boot-starter-parent, you can still keep the benefit of the dependency management (but not the plugin management) by using a scope=import dependency, as follows:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependencyManagement&gt;</span><br><span class="line">        &lt;dependencies&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;!-- Import dependency management from Spring Boot --&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-dependencies&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;2.1.4.RELEASE&lt;/version&gt;</span><br><span class="line">            &lt;type&gt;pom&lt;/type&gt;</span><br><span class="line">            &lt;scope&gt;import&lt;/scope&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">    &lt;/dependencies&gt;</span><br><span class="line">&lt;/dependencyManagement&gt;</span><br></pre></td></tr></table></figure>
<h2 id="自定义banner"><a href="#自定义banner" class="headerlink" title="自定义banner"></a>自定义banner</h2><p>官网中说已经支持动态banner，那么我们试一下</p>
<h3 id="普通banner"><a href="#普通banner" class="headerlink" title="普通banner"></a>普通banner</h3><p>首先传统模式，将banner.txt放入resources中。</p>
<blockquote>
<p>文字转换字符画网址: <a href="http://www.network-science.de/ascii/" target="_blank" rel="noopener">http://www.network-science.de/ascii/</a></p>
</blockquote>
<h3 id="动态GIF-banner"><a href="#动态GIF-banner" class="headerlink" title="动态GIF banner"></a>动态GIF banner</h3><p>按照官方文档，我们只需要添加banner.gif, banner.jpg, or banner.png即可。</p>
<h2 id="属性配置"><a href="#属性配置" class="headerlink" title="属性配置"></a>属性配置</h2><p>属性配置是springboot中比较常用且重要的功能，很多自定义的配置及自动装配都依赖该功能</p>
<h3 id="常规属性配置"><a href="#常规属性配置" class="headerlink" title="常规属性配置"></a>常规属性配置</h3><h4 id="Value"><a href="#Value" class="headerlink" title="@Value"></a>@Value</h4><p>假设我们这里使用@value来注入name：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">@RestController</span><br><span class="line">@Slf4j</span><br><span class="line">public class HelloController &#123;</span><br><span class="line"></span><br><span class="line">    private static final Logger logger = LoggerFactory.getLogger(HelloController.class);</span><br><span class="line"></span><br><span class="line">    @Value(&quot;$&#123;basic-service.name=lemon&#125;&quot;)</span><br><span class="line">    private String name;</span><br><span class="line"></span><br><span class="line">    @GetMapping(&quot;/getHello&quot;)</span><br><span class="line">    public String getHello ()&#123;</span><br><span class="line">        logger.info(&quot;name = &#123;&#125;&quot;, name);</span><br><span class="line">        return &quot;Hello World&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="启动参数"><a href="#启动参数" class="headerlink" title="启动参数"></a>启动参数</h5><p>可以在项目启动时设置启动参数，@value可以将值注入到name:</p>
<p>springboot的项目我们一般会将其打成一个jar包执行，那么也可以通过在执行jar包时传入：</p>
<p><code>java -jar basicService-1.0-SNAPSHOT.jar --basic-service.name=&quot;lemon&quot;</code></p>
<h5 id="application-properties"><a href="#application-properties" class="headerlink" title="application.properties"></a>application.properties</h5><p>在application.properties 定义一个变量</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">basic-service.name=lemon</span><br></pre></td></tr></table></figure>
<h3 id="类型安全的属性配置-推荐"><a href="#类型安全的属性配置-推荐" class="headerlink" title="类型安全的属性配置 (推荐)"></a>类型安全的属性配置 (推荐)</h3><p>上述只是简单的举例，但是实际项目中如果全都这样写，会比较麻烦，而且容易类型出错，故官方建议使用类型安全的属性配置，借助实体类进行注入，方便使用且类型更加安全。</p>
<p>新建 AppProps 类</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@Data</span><br><span class="line">@Component</span><br><span class="line">@ConfigurationProperties(prefix = &quot;basic-service&quot;)</span><br><span class="line">public class AppProps &#123;</span><br><span class="line"></span><br><span class="line">    private String name;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在controller层这样使用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">@RestController</span><br><span class="line">@Slf4j</span><br><span class="line">public class HelloController &#123;</span><br><span class="line"></span><br><span class="line">    private static final Logger logger = LoggerFactory.getLogger(HelloController.class);</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private AppProps appProps;</span><br><span class="line"></span><br><span class="line">    @GetMapping(&quot;/getHello&quot;)</span><br><span class="line">    public String getHello ()&#123;</span><br><span class="line">        logger.info(&quot;name = &#123;&#125;&quot;, appProps.getName());</span><br><span class="line">        return &quot;Hello World&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="YMAL"><a href="#YMAL" class="headerlink" title="YMAL"></a>YMAL</h4><p>目前比较流行ymal, 固接下来都会使用ymal来进行配置。使用ymal需要将application.properties文件名称改为application.yml(yaml也可以)。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">basic-service:</span><br><span class="line">  name: lemon</span><br><span class="line">  age: 18</span><br></pre></td></tr></table></figure>
<h3 id="多种多样的属性配置"><a href="#多种多样的属性配置" class="headerlink" title="多种多样的属性配置"></a>多种多样的属性配置</h3><h4 id="AppProps-java"><a href="#AppProps-java" class="headerlink" title="AppProps.java"></a>AppProps.java</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">@Data</span><br><span class="line">@Component</span><br><span class="line">@ToString</span><br><span class="line">@ConfigurationProperties(prefix = &quot;basic-service&quot;)</span><br><span class="line">public class AppProps &#123;</span><br><span class="line">    // 简单数据类型</span><br><span class="line">    private String name;</span><br><span class="line">    private Integer age;</span><br><span class="line">    private Date birth;</span><br><span class="line"></span><br><span class="line">    //复杂数据类型</span><br><span class="line">    private Map&lt;String, Object&gt; map;</span><br><span class="line">    private List&lt;Object&gt; list;</span><br><span class="line">    private List&lt;Dog&gt; dogs;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="application-yml"><a href="#application-yml" class="headerlink" title="application.yml"></a>application.yml</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">basic-service:</span><br><span class="line">  name: lemon</span><br><span class="line">  age: 18</span><br><span class="line">  birth: 1995/01/01 00:00:00</span><br><span class="line">  map: &#123;k1: 1, k2: 2&#125;</span><br><span class="line">  list:</span><br><span class="line">    - where</span><br><span class="line">    - are</span><br><span class="line">    - you</span><br><span class="line">  dogs:</span><br><span class="line">    - dog:</span><br><span class="line">      name: aaa</span><br><span class="line">      weiget: 10</span><br><span class="line">    - dog:</span><br><span class="line">      name: ccc</span><br><span class="line">      weight: 12</span><br></pre></td></tr></table></figure>
<h3 id="profile-针对不同环境使用不同配置"><a href="#profile-针对不同环境使用不同配置" class="headerlink" title="profile: 针对不同环境使用不同配置"></a>profile: 针对不同环境使用不同配置</h3><p>springboot默认使用application.yml中的配置。我们可以在application.yml中使用<code>spring.profiles.active=prod</code>来指定环境配置。也可以在执行过程中通过命令传递<code>--spring.profiles.active=prod</code>。当指定了文件后，如果有相同的配置，那么指定的文件中的配置是有效的。</p>
<p>####<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">resource</span><br><span class="line">	application.yml</span><br><span class="line">	application-dev.yml</span><br><span class="line">	application-prod.yml</span><br></pre></td></tr></table></figure></p>
<h2 id="日志"><a href="#日志" class="headerlink" title="日志"></a>日志</h2><p>SpringBoot官方文档中指出，如果我们使用<strong>Starters</strong>, 那么默认使用<strong>logback</strong>作为日志输出组件。当然还支持Commons Logging,Log4j等组件。</p>
<p>简单日志配置（包含了指定文件目录，格式，以及level）:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">l</span><br></pre></td></tr></table></figure>
<h3 id="SpringBoot中提供的日志的配置参数"><a href="#SpringBoot中提供的日志的配置参数" class="headerlink" title="SpringBoot中提供的日志的配置参数"></a>SpringBoot中提供的日志的配置参数</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># ----------------------------------------</span><br><span class="line"># CORE PROPERTIES</span><br><span class="line"># ----------------------------------------</span><br><span class="line">debug=false # Enable debug logs.</span><br><span class="line">trace=false # Enable trace logs.</span><br><span class="line"></span><br><span class="line"># LOGGING</span><br><span class="line">logging.config= # Location of the logging configuration file. For instance, `classpath:logback.xml` for Logback.</span><br><span class="line">logging.exception-conversion-word=%wEx # Conversion word used when logging exceptions.</span><br><span class="line">logging.file= # Log file name (for instance, `myapp.log`). Names can be an exact location or relative to the current directory.</span><br><span class="line">logging.file.max-history=0 # Maximum of archive log files to keep. Only supported with the default logback setup.</span><br><span class="line">logging.file.max-size=10MB # Maximum log file size. Only supported with the default logback setup.</span><br><span class="line">logging.group.*= # Log groups to quickly change multiple loggers at the same time. For instance, `logging.level.db=org.hibernate,org.springframework.jdbc`.</span><br><span class="line">logging.level.*= # Log levels severity mapping. For instance, `logging.level.org.springframework=DEBUG`.</span><br><span class="line">logging.path= # Location of the log file. For instance, `/var/log`.</span><br><span class="line">logging.pattern.console= # Appender pattern for output to the console. Supported only with the default Logback setup.</span><br><span class="line">logging.pattern.dateformat=yyyy-MM-dd HH:mm:ss.SSS # Appender pattern for log date format. Supported only with the default Logback setup.</span><br><span class="line">logging.pattern.file= # Appender pattern for output to a file. Supported only with the default Logback setup.</span><br><span class="line">logging.pattern.level=%5p # Appender pattern for log level. Supported only with the default Logback setup.</span><br><span class="line">logging.register-shutdown-hook=false # Register a shutdown hook for the logging system when it is initialized.</span><br></pre></td></tr></table></figure>
<h3 id="Slf4j"><a href="#Slf4j" class="headerlink" title="@Slf4j"></a>@Slf4j</h3><p>为了方便的使用日志，可以借助spring的@slf4j注解，可以自动注入log，代码中可以直接使用，比较方便：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">@RestController</span><br><span class="line">@Slf4j</span><br><span class="line">public class HelloController &#123;</span><br><span class="line"></span><br><span class="line">    private static final Logger logger = LoggerFactory.getLogger(HelloController.class);</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private AppProps appProps;</span><br><span class="line"></span><br><span class="line">    @GetMapping(&quot;/getHello&quot;)</span><br><span class="line">    public String getHello ()&#123;</span><br><span class="line">        logger.info(&quot;name = &#123;&#125;&quot;, appProps.toString());</span><br><span class="line">        return &quot;Hello World&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="单元测试"><a href="#单元测试" class="headerlink" title="单元测试"></a>单元测试</h2><p>一个Spring Boot application 是Spring ApplicationContext, 在单元测试时没有什么特殊的。<br>当你使用SpringApplication 时，外部属性，日志等其他功能会被默认装配</p>
<p>springboot提供了@SpringBootTest注解来辅助我们进行测试。</p>
<blockquote>
<p>如果我们使用的是JUnit 4 ，那么需要添加@RunWith(SpringRunner.class)否则所有注解将会被忽略。<br>如果你使用的是JUnit5 ,那么在 SpringBootTest 上没有必要添加 @ExtendWith,因为@SpringBootTest已经添加了ExtendWith</p>
</blockquote>
<h3 id="简单实例"><a href="#简单实例" class="headerlink" title="简单实例"></a>简单实例</h3><p>记得先给IDEA安装JUnitGenerator V2.0 和Junit 插件</p>
<ol>
<li><p>引入test的starter依赖</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;</span><br><span class="line">    &lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在src/test/java目录下创建SimpleTest.java：</p>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">@RunWith(SpringRunner.class)</span><br><span class="line">@SpringBootTest(classes = &#123;BasicserviceApplication.class&#125;) // 指定启动类</span><br><span class="line">@Slf4j</span><br><span class="line">public class SimpleTest &#123;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private AppProps appProps;</span><br><span class="line">    @Autowired</span><br><span class="line">    private HelloController helloController;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 使用断言</span><br><span class="line">     */</span><br><span class="line">    @Test</span><br><span class="line">    public void test1()&#123;</span><br><span class="line">        log.info(&quot;test 1&quot;);</span><br><span class="line">        TestCase.assertEquals(1, 1);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void test2()&#123;</span><br><span class="line">        log.info(&quot;appProp = &quot;, appProps.toString());</span><br><span class="line">        log.info(&quot;helloController.getHello = &quot;, helloController.getHello());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Before</span><br><span class="line">    public void testBefore()&#123;</span><br><span class="line">        log.info(&quot;test Before&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @After</span><br><span class="line">    public void testAfter()&#123;</span><br><span class="line">        log.info(&quot;test After&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="TestConfiguration"><a href="#TestConfiguration" class="headerlink" title="@TestConfiguration"></a>@TestConfiguration</h3><p>@TestConfiguration是Spring Boot Test提供的一种工具，用它我们可以在一般的@Configuration之外补充测试专门用的Bean或者自定义的配置。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@Target(ElementType.TYPE)</span><br><span class="line">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="line">@Documented</span><br><span class="line">@Configuration</span><br><span class="line">@TestComponent</span><br><span class="line">public @interface TestConfiguration &#123;</span><br><span class="line">//...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>@TestComponent 用于声明专门用于测试的bean , 他不应该被自动扫描到。也就是说如果你使用@ComponentScan来扫描bean，那么需要将其排除在外：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@ComponentScan(excludeFilters = &#123;</span><br><span class="line">  @Filter(type = FilterType.CUSTOM, classes = TypeExcludeFilter.class),</span><br><span class="line">  ...&#125;)</span><br></pre></td></tr></table></figure>
<p>由于@SpringBootApplication已经添加有排除TypeExcludeFilter的功能，固使用@SpringBootApplication时不会加载@TestComponent声明的bean:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">@Target(ElementType.TYPE)</span><br><span class="line">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="line">@Documented</span><br><span class="line">@Inherited</span><br><span class="line">@SpringBootConfiguration</span><br><span class="line">@EnableAutoConfiguration</span><br><span class="line">@ComponentScan(excludeFilters = &#123;</span><br><span class="line">		@Filter(type = FilterType.CUSTOM, classes = TypeExcludeFilter.class),</span><br><span class="line">		@Filter(type = FilterType.CUSTOM,</span><br><span class="line">				classes = AutoConfigurationExcludeFilter.class) &#125;)</span><br><span class="line">public @interface SpringBootApplication &#123;</span><br></pre></td></tr></table></figure></p>
<h3 id="TestConfiguration-应用实例"><a href="#TestConfiguration-应用实例" class="headerlink" title="@TestConfiguration 应用实例"></a>@TestConfiguration 应用实例</h3><ol>
<li><p>编写TestProps类:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@TestConfiguration</span><br><span class="line">public class TestProps &#123;</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    public Foo foo() &#123;</span><br><span class="line">        return new Foo(&quot;from testProps&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Foo.java</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@Data</span><br><span class="line">@AllArgsConstructor</span><br><span class="line">@NoArgsConstructor</span><br><span class="line">public class Foo &#123;</span><br><span class="line">    private String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>编写测试类</p>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">@RunWith(SpringRunner.class)</span><br><span class="line">@SpringBootTest(classes = &#123;Application.class&#125;)// 指定启动类</span><br><span class="line">@Import(Config.class)</span><br><span class="line">@Slf4j</span><br><span class="line">public class SimpleTest &#123;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private Foo foo;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void testConfiguration() &#123;</span><br><span class="line">        log.info(&quot;TestConfiguration1&quot;);</span><br><span class="line">        Assert.assertEquals(foo.getName(), &quot;from testProps&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行通过,testConfiguration，测试通过。<br>当然上面Config中的注解@TestConfiguration可以换成@Configuration效果也是一样的，@TestConfiguration是专门用于测试的。</p>
<h3 id="使用mock方式对controller进行单元测试（无需运行web服务）"><a href="#使用mock方式对controller进行单元测试（无需运行web服务）" class="headerlink" title="使用mock方式对controller进行单元测试（无需运行web服务）"></a>使用mock方式对controller进行单元测试（无需运行web服务）</h3><p>默认情况下，使用@SpringBootTest不会真正启动web服务，当我们测试controller时，spring测试提供了MockMvc供我们方便的测试controller，就像从浏览器发起请求一样。<br>在HelloController中有这么一个方法<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@GetMapping(&quot;/getHello&quot;)</span><br><span class="line">public String getHello ()&#123;</span><br><span class="line">    logger.info(&quot;name = &#123;&#125;&quot;, appProps.toString());</span><br><span class="line">    return &quot;Hello World&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>需要启动浏览器运行 <code>localhost:8080/getHello</code></p>
<p>关闭tomcat服务，我们看如何进行单元测试。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">@RunWith(SpringRunner.class)</span><br><span class="line">@SpringBootTest(classes = &#123;BasicserviceApplication.class&#125;)</span><br><span class="line">@AutoConfigureMockMvc</span><br><span class="line">public class MockMvcSimpleTest &#123;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private MockMvc mockMvc;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void simpleTest1() throws Exception &#123;</span><br><span class="line">        this.mockMvc</span><br><span class="line">                .perform(get(&quot;/getHello&quot;))</span><br><span class="line">                .andExpect(status().isOk())</span><br><span class="line">                .andExpect(content().string(&quot;Hello World&quot;))</span><br><span class="line">                .andDo(MockMvcResultHandlers.print());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="对随机端口进行单元测试"><a href="#对随机端口进行单元测试" class="headerlink" title="对随机端口进行单元测试"></a>对随机端口进行单元测试</h4><p>如果您需要启动运行web服务，我们建议您使用随机端口。 如果您使用的是@SpringBootTest（webEnvironment = WebEnvironment.RANDOM_PORT），则可以随机进行测试运行。</p>
<h5 id="打开随机端口"><a href="#打开随机端口" class="headerlink" title="打开随机端口"></a>打开随机端口</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">server:</span><br><span class="line">  port: 0</span><br></pre></td></tr></table></figure>
<p>或者</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">server:</span><br><span class="line">  port: $&#123;random.int[10000,65535]&#125;</span><br></pre></td></tr></table></figure>
<h5 id="编写测试类"><a href="#编写测试类" class="headerlink" title="编写测试类"></a>编写测试类</h5><p>这里允许自动注入TestRestTemplate:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">@RunWith(SpringRunner.class)</span><br><span class="line">// 使用随机端口</span><br><span class="line">@SpringBootTest(classes = BasicserviceApplication.class, webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)</span><br><span class="line">public class RandomPortTestRestTemplateSimpleTests &#123;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private TestRestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void simpleTest()&#123;</span><br><span class="line">        String body = this.restTemplate.getForObject(&quot;/getHello&quot;, String.class);</span><br><span class="line">        Assertions.assertThat(body).isEqualTo(&quot;Hello World&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="使用mock方式对controller进行单元测试（需运行web服务且-使用webflux）"><a href="#使用mock方式对controller进行单元测试（需运行web服务且-使用webflux）" class="headerlink" title="使用mock方式对controller进行单元测试（需运行web服务且 使用webflux）"></a>使用mock方式对controller进行单元测试（需运行web服务且 使用webflux）</h3><p>具体的webflux相关的内容后续会讲。这里只需要知道这个springboot提供的是基于reactor的响应式编程（异步非阻塞）架构就行了。而我们之前使用的基于Tomcat的servlet3.1之前的springmvc是同步阻塞的。</p>
<p>要想使用webflux，需要更换<code>spring-boot-starter-web</code>为<code>spring-boot-starter-webflux</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-webflux&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<h4 id="编写测试类-1"><a href="#编写测试类-1" class="headerlink" title="编写测试类"></a>编写测试类</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">@RunWith(SpringRunner.class)</span><br><span class="line">// 使用随机端口</span><br><span class="line">@SpringBootTest(classes = BasicserviceApplication.class, webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)</span><br><span class="line">public class RandomPortTestRestTemplateSimpleTests &#123;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private WebTestClient webTestClient;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void simpleTest1()&#123;</span><br><span class="line">        String responseBody = this.webTestClient.get().uri(&quot;/getHello&quot;).exchange().expectStatus().isOk()</span><br><span class="line">                .expectBody(String.class).returnResult().getResponseBody();</span><br><span class="line">        System.out.println(responseBody);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="MockBean-对bean进行mock测试"><a href="#MockBean-对bean进行mock测试" class="headerlink" title="@MockBean 对bean进行mock测试"></a>@MockBean 对bean进行mock测试</h3><p>在实际项目中，有一些bean可能会调用第三方，依赖外部组件或项目。但是我们单元测试不需要真正调用。那么我们可以使用@MockBean进行mock结果。<br>假设HelloService中有调用外部服务的方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">public interface HelloService &#123;</span><br><span class="line">    //模拟远程调用，或者其他服务调用</span><br><span class="line">    String getRemoteVal();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@Component</span><br><span class="line">@Slf4j</span><br><span class="line">public class HelloServiceImpl implements HelloService &#123;</span><br><span class="line"></span><br><span class="line">    public String getRemoteVal()&#123;</span><br><span class="line">        log.info(&quot;真正发起外部请求&quot;);</span><br><span class="line">        return &quot;remote val&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="编写单元测试代码"><a href="#编写单元测试代码" class="headerlink" title="编写单元测试代码"></a>编写单元测试代码</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">@RunWith(SpringRunner.class)</span><br><span class="line">@SpringBootTest(classes = &#123;BasicserviceApplication.class&#125;)</span><br><span class="line">public class MockBeanTest &#123;</span><br><span class="line"></span><br><span class="line">    @MockBean //这里使用SpyBean是一样的效果</span><br><span class="line">    private HelloService helloService;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void simpleTest()&#123;</span><br><span class="line">        //这句的意思是当调用helloService的getRemoteVal方法时，返回mock的结果：&quot;远程调用结果&quot;</span><br><span class="line">        BDDMockito.given(this.helloService.getRemoteVal()).willReturn(&quot;远程调用结果&quot;);</span><br><span class="line"></span><br><span class="line">        // 进行调用测试</span><br><span class="line">        String remoteVal = helloService.getRemoteVal();</span><br><span class="line">        Assertions.assertThat(remoteVal).isEqualTo(&quot;远程调用结果&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>执行单元测试，可以发现并没有真正发起请求。</p>
<h3 id="测试json-JsonTest"><a href="#测试json-JsonTest" class="headerlink" title="测试json @JsonTest"></a>测试json @JsonTest</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">@RunWith(SpringRunner.class)</span><br><span class="line">// 这里不能使用SpringBootTest</span><br><span class="line">@ContextConfiguration(classes = &#123;BasicserviceApplication.class&#125;)</span><br><span class="line">@JsonTest</span><br><span class="line">public class JsonSimpleTest &#123;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private JacksonTester&lt;Dog&gt; json;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void testSerialize() throws IOException &#123;</span><br><span class="line">        Dog dogOne = new Dog(&quot;dogOne&quot;, 1.0);</span><br><span class="line">        JsonContentAssert jsonContentAssert = Assertions.assertThat(this.json.write(dogOne));</span><br><span class="line"></span><br><span class="line">        jsonContentAssert.hasJsonPathStringValue(&quot;@.name&quot;);</span><br><span class="line">        jsonContentAssert.extractingJsonPathStringValue(&quot;@.name&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void testDeserialize() throws IOException &#123;</span><br><span class="line">        String content = &quot;&#123;\&quot;name\&quot;:\&quot;2\&quot;,\&quot;weight\&quot;:\&quot;11.0\&quot;&#125;&quot;;</span><br><span class="line">        Assertions.assertThat(this.json.parse(content)).isEqualTo(new Dog(&quot;2&quot;,11.0));</span><br><span class="line">        Assertions.assertThat(this.json.parseObject(content).getName()).isEqualTo(&quot;2&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="有时候我们会自定义序列化风格，这里对-JsonComponent进行测试："><a href="#有时候我们会自定义序列化风格，这里对-JsonComponent进行测试：" class="headerlink" title="有时候我们会自定义序列化风格，这里对@JsonComponent进行测试："></a>有时候我们会自定义序列化风格，这里对@JsonComponent进行测试：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">@JsonComponent</span><br><span class="line">public class FooJsonComponent &#123;</span><br><span class="line"></span><br><span class="line">    public static class Serializer extends JsonSerializer&lt;Dog&gt; &#123;</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public void serialize(Dog value, JsonGenerator gen, SerializerProvider seri) throws IOException &#123;</span><br><span class="line">            gen.writeString(&quot;name=&quot; + value.getName() + &quot;,weight=&quot; + value.getWeight());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static class Deserializer extends JsonDeserializer&lt;Dog&gt; &#123;</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public Dog deserialize(JsonParser p, DeserializationContext ctxt) throws IOException, JsonProcessingException &#123;</span><br><span class="line">            JsonToken currentToken = p.getCurrentToken();</span><br><span class="line">            if (currentToken == JsonToken.VALUE_STRING) &#123;</span><br><span class="line">                String trim = p.getText().trim();</span><br><span class="line"></span><br><span class="line">                String[] split = trim.split(&quot;,&quot;);</span><br><span class="line">                Dog dog = new Dog();</span><br><span class="line">                dog.setName(split[0].split(&quot;=&quot;)[1]);</span><br><span class="line">                dog.setWeight(Double.parseDouble(split[1].split(&quot;=&quot;)[1]));</span><br><span class="line">                return dog;</span><br><span class="line">            &#125;</span><br><span class="line">            return (Dog) ctxt.handleUnexpectedToken(handledType(), p);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="编写测试类-2"><a href="#编写测试类-2" class="headerlink" title="编写测试类"></a>编写测试类</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">@RunWith(SpringRunner.class)</span><br><span class="line">@ContextConfiguration(classes = &#123;JsonComponentJacksonTest.class, FooJsonComponent.class&#125;)</span><br><span class="line">@JsonTest</span><br><span class="line">public class JsonComponentJacksonTest extends AbstractTestNGSpringContextTests &#123;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private JacksonTester&lt;Dog&gt; json;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void testSerialize() throws IOException &#123;</span><br><span class="line">        Dog aaa = new Dog(&quot;aaa&quot;, 12.0);</span><br><span class="line">        assertThat(this.json.write(aaa).getJson()).isEqualTo(&quot;\&quot;name=aaa,weight=12.0\&quot;&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void testDeserialize() throws IOException &#123;</span><br><span class="line">        String content = &quot;\&quot;name=aaa,weight=12.0\&quot;&quot;;</span><br><span class="line">        Dog dog = this.json.parseObject(content);</span><br><span class="line">        assertThat(dog).isEqualTo(new Dog(&quot;aaa&quot;,12.0));</span><br><span class="line">        assertThat(dog.getName()).isEqualTo(&quot;aaa&quot;);</span><br><span class="line">        assertThat(dog.getWeight()).isEqualTo(12.0);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="TestPropertySource-对属性配置进行mock"><a href="#TestPropertySource-对属性配置进行mock" class="headerlink" title="@TestPropertySource 对属性配置进行mock"></a>@TestPropertySource 对属性配置进行mock</h3><p>使用springboot我们通常会将配置设置在application.yml中，但是在测试的时候，可能会对某些配置的值进行修改，接下来我们使用@TestPropertySource来实现这个功能。</p>
<h4 id="使用spring提供的-PropertySource"><a href="#使用spring提供的-PropertySource" class="headerlink" title="使用spring提供的@PropertySource"></a>使用spring提供的@PropertySource</h4><p>springboot提供的<code>@ConfigurationProperties</code>可以加载<code>application.yml</code>中的配置，如果你的配置放到其他目录或者叫其他名称，可以使用<code>@PropertySource</code>来进行加载。</p>
<p>我们先在resource下编写property-source.yml<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">name:ghost</span><br></pre></td></tr></table></figure></p>
<p>@PropertySource可以支持properties和yml两种格式。<br>编写类PropertySourceConfig.java来加载配置文件中的内容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">@PropertySource(&quot;classpath:property-source.yml&quot;)</span><br><span class="line">public class PropertySourceConfig &#123;</span><br><span class="line"></span><br><span class="line">    private String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>编写测试类</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">@RunWith(SpringRunner.class)</span><br><span class="line">@SpringBootTest</span><br><span class="line">@Slf4j</span><br><span class="line">@ContextConfiguration(classes = PropertySourceConfig.class)</span><br><span class="line">@TestPropertySource( // 对属性进行设置</span><br><span class="line">        properties = &#123;&quot;name=123&quot;, &quot;age=11&quot;&#125;</span><br><span class="line">)</span><br><span class="line">public class PropertySourceSimpleTest implements EnvironmentAware &#123;</span><br><span class="line"></span><br><span class="line">    private Environment environment;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void testOne()&#123;</span><br><span class="line">        Assert.assertEquals(environment.getProperty(&quot;name&quot;), &quot;123&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void setEnvironment(Environment environment) &#123;</span><br><span class="line">        this.environment = environment;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>测试通过。大家可以将<code>@TestPropertySource</code>注解去掉来观察输出结果。</p>
<h3 id="对springboot提供的类型安全的属性配置进行mock"><a href="#对springboot提供的类型安全的属性配置进行mock" class="headerlink" title="对springboot提供的类型安全的属性配置进行mock"></a>对springboot提供的类型安全的属性配置进行mock</h3><p>前面已经讲过如何进行<strong>类型安全的属性配置</strong>。这种情况依然可以使用@TestPropertySource对属性进行mock:</p>
<p>编写测试类:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">@RunWith(SpringRunner.class)</span><br><span class="line">@SpringBootTest(classes = &#123;BasicserviceApplication.class&#125;)</span><br><span class="line">@Slf4j</span><br><span class="line">@TestPropertySource(</span><br><span class="line">        properties = &#123;&quot;basic-service.name=dudu&quot;, &quot;basic-service.age=12&quot;&#125;</span><br><span class="line">)</span><br><span class="line">public class PropertySourceTest &#123;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private AppProps appProps;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void testOne() &#123;</span><br><span class="line">        log.info(appProps.getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>测试通过。大家可以将@TestPropertySource注解去掉来观察输出结果。</p>
<h3 id="为单元测试单独提供测试配置"><a href="#为单元测试单独提供测试配置" class="headerlink" title="为单元测试单独提供测试配置"></a>为单元测试单独提供测试配置</h3><p>在src/test/resources目录下创建一个单元测试专用的属性配置文件。就可以在@TestPropertySource指定加载这个配置即可。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">@RunWith(SpringRunner.class)</span><br><span class="line">@SpringBootTest</span><br><span class="line">@Slf4j</span><br><span class="line">@ContextConfiguration(classes = PropertySourceConfig.class) // 加载属性配置</span><br><span class="line">@TestPropertySource(</span><br><span class="line">        locations = &quot;classpath:test-property-source.yml&quot;</span><br><span class="line">)</span><br><span class="line">public class PropertySourceSimpleTestBetter implements EnvironmentAware &#123;</span><br><span class="line"></span><br><span class="line">    private Environment environment;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void testOne()&#123;</span><br><span class="line">        Assert.assertEquals(environment.getProperty(&quot;name&quot;), &quot;ghost2&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void setEnvironment(Environment environment) &#123;</span><br><span class="line">        this.environment = environment;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="对AOP进行测试"><a href="#对AOP进行测试" class="headerlink" title="对AOP进行测试"></a>对AOP进行测试</h3><h4 id="引入AOP依赖"><a href="#引入AOP依赖" class="headerlink" title="引入AOP依赖"></a>引入AOP依赖</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-aop&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<h4 id="对AOP进行测试-1"><a href="#对AOP进行测试-1" class="headerlink" title="对AOP进行测试"></a>对AOP进行测试</h4><p>我们这里对HelloService使用Aspect进行AOP代理</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@Component</span><br><span class="line">@Aspect</span><br><span class="line">public class HelloAspect &#123;</span><br><span class="line"></span><br><span class="line">    @Pointcut(&quot;execution(* com.misaniy.basicservice.service.HelloService.getRemoteVal()))&quot;)</span><br><span class="line">    public void pointCut()&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Around(&quot;pointCut()&quot;)</span><br><span class="line">    public String changeGetRemoteVal(ProceedingJoinPoint pjp) &#123;</span><br><span class="line">        return &quot;aopResult&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用springboot进行配置，启用aop</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">@EnableAspectJAutoProxy(proxyTargetClass = true) // 启用AOP</span><br><span class="line">@ComponentScan(&quot;com.misaniy.basicservice.service&quot;)</span><br><span class="line">public class AopConfig &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们对MockMvcExampleTests添加一个测试方法，验证一下结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void simpleTest2() throws Exception &#123;</span><br><span class="line">    this.mockMvc</span><br><span class="line">            .perform(get(&quot;/getRemoteVal&quot;))</span><br><span class="line">            .andExpect(status().isOk())</span><br><span class="line">            .andExpect(content().string(&quot;aopResult&quot;))</span><br><span class="line">            .andDo(MockMvcResultHandlers.print());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="另一种AOP测试"><a href="#另一种AOP测试" class="headerlink" title="另一种AOP测试"></a>另一种AOP测试</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">@RunWith(SpringRunner.class)</span><br><span class="line">@SpringBootTest(classes = &#123;BasicserviceApplication.class&#125;)</span><br><span class="line">@TestExecutionListeners(listeners = MockitoTestExecutionListener.class)</span><br><span class="line">@Slf4j</span><br><span class="line">public class SpringBootAopTest extends AbstractTestNGSpringContextTests &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @SpyBean</span><br><span class="line">    private HelloAspect helloAspect;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private HelloService helloService;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void aopSimpleTest()&#123;</span><br><span class="line">        // 判断helloService对象是不是HelloServiceImpl</span><br><span class="line">        Assert.assertNotEquals(helloService.getClass(), HelloServiceImpl.class);</span><br><span class="line"></span><br><span class="line">        // 接下来通过AopUtils、AopProxyUtils、AopTestUtils来判断helloService是否是代理的</span><br><span class="line">        Assert.assertTrue(AopUtils.isAopProxy(helloService));</span><br><span class="line">        Assert.assertTrue(AopUtils.isCglibProxy(helloService));</span><br><span class="line"></span><br><span class="line">        Assert.assertEquals(AopProxyUtils.ultimateTargetClass(helloService), HelloServiceImpl.class);</span><br><span class="line"></span><br><span class="line">        Assert.assertEquals(AopTestUtils.getTargetObject(helloService).getClass(), HelloServiceImpl.class);</span><br><span class="line">        Assert.assertEquals(AopTestUtils.getUltimateTargetObject(helloService).getClass(), HelloServiceImpl.class);</span><br><span class="line"></span><br><span class="line">        /**</span><br><span class="line">         * 但是证明HelloServiceImpl Bean被代理并不意味着HelloAspect生效了</span><br><span class="line">         * 那么我们还需要验证HelloServiceImpl.getRemoveVal的行为。</span><br><span class="line">         * 这里调用两次</span><br><span class="line">         */</span><br><span class="line">        Assert.assertEquals(helloService.getRemoteVal(), &quot;aopResult&quot;);</span><br><span class="line">        Assert.assertEquals(helloService.getRemoteVal(), &quot;aopResult&quot;);</span><br><span class="line"></span><br><span class="line">        /**</span><br><span class="line">         * 通过MockitoTestExecutionListener来监听是否调用了两次helloService.getRemoteVal()</span><br><span class="line">         * 注意这一行代码测试的是HelloAspect的行为，而不是HelloService的行为</span><br><span class="line">         */</span><br><span class="line">        verify(helloAspect, times(2)).changeGetRemoteVal(any());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="SpringBoot-整合MyBatis"><a href="#SpringBoot-整合MyBatis" class="headerlink" title="SpringBoot 整合MyBatis"></a>SpringBoot 整合MyBatis</h2><blockquote>
<p>环境介绍<br>MySQL驱动: 8.X<br>使用pagehelper分页<br>使用druid连接池(    1.5.X默认Tomcat连接池，2.X默认是hikari连接池)<br>使用mybatis-generator插件</p>
</blockquote>
<h3 id="创建表"><a href="#创建表" class="headerlink" title="创建表"></a>创建表</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">DROP TABLE IF EXISTS `basic_user`;</span><br><span class="line">CREATE TABLE `basic_user`  (</span><br><span class="line">  `id` int(11) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  `real_name` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL,</span><br><span class="line">  `phone_num` varchar(11) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL,</span><br><span class="line">  PRIMARY KEY (`id`) USING BTREE</span><br><span class="line">) ENGINE = InnoDB CHARACTER SET = utf8 COLLATE = utf8_general_ci ROW_FORMAT = Dynamic;</span><br></pre></td></tr></table></figure>
<h3 id="引入依赖"><a href="#引入依赖" class="headerlink" title="引入依赖"></a>引入依赖</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-jdbc&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.1.4.RELEASE&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;mysql&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;8.0.15&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.0.1&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.alibaba&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;druid-spring-boot-starter&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.1.16&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.github.pagehelper&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;pagehelper-spring-boot-starter&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.2.10&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<h3 id="MybatisGenerator插件"><a href="#MybatisGenerator插件" class="headerlink" title="MybatisGenerator插件"></a>MybatisGenerator插件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;build&gt;</span><br><span class="line">    &lt;plugins&gt;</span><br><span class="line">        &lt;plugin&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;</span><br><span class="line">        &lt;/plugin&gt;</span><br><span class="line">        &lt;!-- MyBatis 生成SQL插件 --&gt;</span><br><span class="line">        &lt;plugin&gt;</span><br><span class="line">            &lt;groupId&gt;org.mybatis.generator&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;mybatis-generator-maven-plugin&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.3.7&lt;/version&gt;</span><br><span class="line">            &lt;configuration&gt;</span><br><span class="line">                &lt;configurationFile&gt;$&#123;basedir&#125;/src/main/resources/generator/generatorConfig.xml&lt;/configurationFile&gt;</span><br><span class="line">                &lt;overwrite&gt;true&lt;/overwrite&gt;</span><br><span class="line">                &lt;verbose&gt;true&lt;/verbose&gt;</span><br><span class="line">            &lt;/configuration&gt;</span><br><span class="line">        &lt;/plugin&gt;</span><br><span class="line">    &lt;/plugins&gt;</span><br><span class="line">&lt;/build&gt;</span><br></pre></td></tr></table></figure>
<h3 id="在src-main-resources-generator目录下新建generatorConfig-xml"><a href="#在src-main-resources-generator目录下新建generatorConfig-xml" class="headerlink" title="在src/main/resources/generator目录下新建generatorConfig.xml"></a>在src/main/resources/generator目录下新建generatorConfig.xml</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE generatorConfiguration</span><br><span class="line">        PUBLIC &quot;-//mybatis.org//DTD MyBatis Generator Configuration 1.0//EN&quot;</span><br><span class="line">        &quot;http://mybatis.org/dtd/mybatis-generator-config_1_0.dtd&quot;&gt;</span><br><span class="line">&lt;generatorConfiguration&gt;</span><br><span class="line">    &lt;!-- 数据库驱动:选择你的本地硬盘上面的数据库驱动包--&gt;</span><br><span class="line">    &lt;classPathEntry  location=&quot;F:\Program Files\Maven\LocalWareHouse\mysql\mysql-connector-java\8.0.15\mysql-connector-java-8.0.15.jar&quot;/&gt;</span><br><span class="line">    &lt;context id=&quot;DB2Tables&quot;  targetRuntime=&quot;MyBatis3&quot;&gt;</span><br><span class="line">        &lt;commentGenerator&gt;</span><br><span class="line">            &lt;property name=&quot;suppressDate&quot; value=&quot;true&quot;/&gt;</span><br><span class="line">            &lt;!-- 是否去除自动生成的注释 true：是 ： false:否 --&gt;</span><br><span class="line">            &lt;property name=&quot;suppressAllComments&quot; value=&quot;true&quot;/&gt;</span><br><span class="line">        &lt;/commentGenerator&gt;</span><br><span class="line">        &lt;!--数据库链接URL，用户名、密码 --&gt;</span><br><span class="line">        &lt;jdbcConnection driverClass=&quot;com.mysql.cj.jdbc.Driver&quot; connectionURL=&quot;jdbc:mysql://127.0.0.1:3306/base_service&quot; userId=&quot;root&quot; password=&quot;root&quot;&gt;</span><br><span class="line">        &lt;/jdbcConnection&gt;</span><br><span class="line">        &lt;javaTypeResolver&gt;</span><br><span class="line">            &lt;property name=&quot;forceBigDecimals&quot; value=&quot;false&quot;/&gt;</span><br><span class="line">        &lt;/javaTypeResolver&gt;</span><br><span class="line">        &lt;!-- 生成模型的包名和位置--&gt;</span><br><span class="line">        &lt;javaModelGenerator targetPackage=&quot;com.misaniy.basicservice.model&quot; targetProject=&quot;src/main/java&quot;&gt;</span><br><span class="line">            &lt;property name=&quot;enableSubPackages&quot; value=&quot;true&quot;/&gt;</span><br><span class="line">            &lt;property name=&quot;trimStrings&quot; value=&quot;true&quot;/&gt;</span><br><span class="line">        &lt;/javaModelGenerator&gt;</span><br><span class="line">        &lt;!-- 生成映射文件的包名和位置--&gt;</span><br><span class="line">        &lt;sqlMapGenerator targetPackage=&quot;dao&quot; targetProject=&quot;src/main/resources&quot;&gt;</span><br><span class="line">            &lt;property name=&quot;enableSubPackages&quot; value=&quot;true&quot;/&gt;</span><br><span class="line">        &lt;/sqlMapGenerator&gt;</span><br><span class="line">        &lt;!-- 生成DAO的包名和位置--&gt;</span><br><span class="line">        &lt;!-- XMLMAPPER生成xml映射文件, ANNOTATEDMAPPER生成的dao采用注解来写sql --&gt;</span><br><span class="line">        &lt;javaClientGenerator type=&quot;ANNOTATEDMAPPER&quot; targetPackage=&quot;com.misaniy.basicservice.dao&quot; targetProject=&quot;src/main/java&quot;&gt;</span><br><span class="line">            &lt;property name=&quot;enableSubPackages&quot; value=&quot;true&quot;/&gt;</span><br><span class="line">        &lt;/javaClientGenerator&gt;</span><br><span class="line">        &lt;!-- 要生成的表 tableName是数据库中的表名或视图名 domainObjectName是实体类名--&gt;</span><br><span class="line">        &lt;table tableName=&quot;basic_user&quot; domainObjectName=&quot;User&quot;</span><br><span class="line">               enableCountByExample=&quot;true&quot; enableUpdateByExample=&quot;true&quot; enableDeleteByExample=&quot;true&quot;</span><br><span class="line">               enableSelectByExample=&quot;true&quot; selectByExampleQueryId=&quot;true&quot;/&gt;</span><br><span class="line">    &lt;/context&gt;</span><br><span class="line">&lt;/generatorConfiguration&gt;</span><br></pre></td></tr></table></figure>
<h3 id="application-yml-1"><a href="#application-yml-1" class="headerlink" title="application.yml"></a>application.yml</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  datasource:</span><br><span class="line">    type: com.alibaba.druid.pool.DruidDataSource</span><br><span class="line">    druid:</span><br><span class="line">      driver-class-name: com.mysql.cj.jdbc.Driver</span><br><span class="line">      # 基本属性</span><br><span class="line">      url: jdbc:mysql://127.0.0.1:3306/base_service?serverTimezone=Shanghai&amp;charset=utf8mb4&amp;useSSL=false</span><br><span class="line">      username: root</span><br><span class="line">      password: root</span><br><span class="line">      # 配置初始化大小/最小/最大 [仅用于测试，生产环境需要修改]</span><br><span class="line">      initial-size: 5</span><br><span class="line">      min-idle: 5</span><br><span class="line">      max-active: 20</span><br><span class="line">      # 获取连接等待超时时间</span><br><span class="line">      max-wait: 60000</span><br><span class="line">      # 间隔多久进行一次检测，检测需要关闭的空闲连接</span><br><span class="line">      time-between-eviction-runs-millis: 60000</span><br><span class="line">      # 一个连接在池中最小生存的时间</span><br><span class="line">      min-evictable-idle-time-millis: 300000</span><br><span class="line">      # 指定获取连接时连接校验的SQL查询语句</span><br><span class="line">      validation-query: SELECT &apos;x&apos;</span><br><span class="line">      # 验证连接的有效性</span><br><span class="line">      test-while-idle: true</span><br><span class="line">      # 获取连接时验证(会影响性能,不建议true)</span><br><span class="line">      test-on-borrow: false</span><br><span class="line">      # 打开PSCache，并指定每个连接上PSCache的大小。oracle设为true，MySQL设为false。分库分表较多推荐设置为false</span><br><span class="line">      pool-prepared-statements: false</span><br><span class="line">      max-pool-prepared-statement-per-connection-size: 20</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 下划线转驼峰</span><br><span class="line">mybatis:</span><br><span class="line">  configuration:</span><br><span class="line">    map-underscore-to-camel-case: true</span><br><span class="line"></span><br><span class="line">#pagehelper</span><br><span class="line">pagehelper:</span><br><span class="line">  # 分页参数合理化，默认false禁用，启用合理化时，如果pageNum&lt;1 会查询第一页，如果pageNum&gt;pages会查询最后一页</span><br><span class="line">  # 用合理化时，如果pageNum&lt;1 活pageNum&gt;pages会返回空数据</span><br><span class="line">  reasonable: true</span><br><span class="line">  support-methods-arguments: true</span><br><span class="line">  # 设置为true时，使用RowBounds分页会进行count查询，默认false</span><br><span class="line">  row-bounds-with-count: true</span><br><span class="line">  helper-dialect: mysql</span><br></pre></td></tr></table></figure>
<h3 id="MAVEN中双击执行mybatis-generator-generate生成mapper及实体类。"><a href="#MAVEN中双击执行mybatis-generator-generate生成mapper及实体类。" class="headerlink" title="MAVEN中双击执行mybatis-generator:generate生成mapper及实体类。"></a>MAVEN中双击执行mybatis-generator:generate生成mapper及实体类。</h3><h4 id="User-java"><a href="#User-java" class="headerlink" title="User.java"></a>User.java</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">package com.misaniy.basicservice.model;</span><br><span class="line"></span><br><span class="line">public class User &#123;</span><br><span class="line">    private Integer id;</span><br><span class="line"></span><br><span class="line">    private String realName;</span><br><span class="line"></span><br><span class="line">    private String phoneNum;</span><br><span class="line"></span><br><span class="line">    public Integer getId() &#123;</span><br><span class="line">        return id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setId(Integer id) &#123;</span><br><span class="line">        this.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getRealName() &#123;</span><br><span class="line">        return realName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setRealName(String realName) &#123;</span><br><span class="line">        this.realName = realName == null ? null : realName.trim();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getPhoneNum() &#123;</span><br><span class="line">        return phoneNum;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setPhoneNum(String phoneNum) &#123;</span><br><span class="line">        this.phoneNum = phoneNum == null ? null : phoneNum.trim();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>稍作修改</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@Data</span><br><span class="line">@Validated</span><br><span class="line">public class User &#123;</span><br><span class="line">    private Integer id;</span><br><span class="line"></span><br><span class="line">    @NotBlank(message = &quot;姓名不可为空&quot;)</span><br><span class="line">    private String realName;</span><br><span class="line"></span><br><span class="line">    @Pattern(regexp = &quot;^((13[0-9])|(14[5,7])|(15[0-3,5-9])|(17[0,3,5-8])|(18[0-9])|166|198|199|(147))\\\\d&#123;8&#125;$&quot;,message = &quot;手机号码格式错误&quot;)</span><br><span class="line">    private String phoneNum;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="UserExample-java"><a href="#UserExample-java" class="headerlink" title="UserExample.java"></a>UserExample.java</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br></pre></td><td class="code"><pre><span class="line">package com.misaniy.basicservice.model;</span><br><span class="line"></span><br><span class="line">import java.util.ArrayList;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">public class UserExample &#123;</span><br><span class="line">    protected String orderByClause;</span><br><span class="line"></span><br><span class="line">    protected boolean distinct;</span><br><span class="line"></span><br><span class="line">    protected List&lt;Criteria&gt; oredCriteria;</span><br><span class="line"></span><br><span class="line">    public UserExample() &#123;</span><br><span class="line">        oredCriteria = new ArrayList&lt;Criteria&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setOrderByClause(String orderByClause) &#123;</span><br><span class="line">        this.orderByClause = orderByClause;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getOrderByClause() &#123;</span><br><span class="line">        return orderByClause;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setDistinct(boolean distinct) &#123;</span><br><span class="line">        this.distinct = distinct;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public boolean isDistinct() &#123;</span><br><span class="line">        return distinct;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public List&lt;Criteria&gt; getOredCriteria() &#123;</span><br><span class="line">        return oredCriteria;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void or(Criteria criteria) &#123;</span><br><span class="line">        oredCriteria.add(criteria);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Criteria or() &#123;</span><br><span class="line">        Criteria criteria = createCriteriaInternal();</span><br><span class="line">        oredCriteria.add(criteria);</span><br><span class="line">        return criteria;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Criteria createCriteria() &#123;</span><br><span class="line">        Criteria criteria = createCriteriaInternal();</span><br><span class="line">        if (oredCriteria.size() == 0) &#123;</span><br><span class="line">            oredCriteria.add(criteria);</span><br><span class="line">        &#125;</span><br><span class="line">        return criteria;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    protected Criteria createCriteriaInternal() &#123;</span><br><span class="line">        Criteria criteria = new Criteria();</span><br><span class="line">        return criteria;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void clear() &#123;</span><br><span class="line">        oredCriteria.clear();</span><br><span class="line">        orderByClause = null;</span><br><span class="line">        distinct = false;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    protected abstract static class GeneratedCriteria &#123;</span><br><span class="line">        protected List&lt;Criterion&gt; criteria;</span><br><span class="line"></span><br><span class="line">        protected GeneratedCriteria() &#123;</span><br><span class="line">            super();</span><br><span class="line">            criteria = new ArrayList&lt;Criterion&gt;();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public boolean isValid() &#123;</span><br><span class="line">            return criteria.size() &gt; 0;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public List&lt;Criterion&gt; getAllCriteria() &#123;</span><br><span class="line">            return criteria;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public List&lt;Criterion&gt; getCriteria() &#123;</span><br><span class="line">            return criteria;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        protected void addCriterion(String condition) &#123;</span><br><span class="line">            if (condition == null) &#123;</span><br><span class="line">                throw new RuntimeException(&quot;Value for condition cannot be null&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">            criteria.add(new Criterion(condition));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        protected void addCriterion(String condition, Object value, String property) &#123;</span><br><span class="line">            if (value == null) &#123;</span><br><span class="line">                throw new RuntimeException(&quot;Value for &quot; + property + &quot; cannot be null&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">            criteria.add(new Criterion(condition, value));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        protected void addCriterion(String condition, Object value1, Object value2, String property) &#123;</span><br><span class="line">            if (value1 == null || value2 == null) &#123;</span><br><span class="line">                throw new RuntimeException(&quot;Between values for &quot; + property + &quot; cannot be null&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">            criteria.add(new Criterion(condition, value1, value2));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public Criteria andIdIsNull() &#123;</span><br><span class="line">            addCriterion(&quot;id is null&quot;);</span><br><span class="line">            return (Criteria) this;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public Criteria andIdIsNotNull() &#123;</span><br><span class="line">            addCriterion(&quot;id is not null&quot;);</span><br><span class="line">            return (Criteria) this;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public Criteria andIdEqualTo(Integer value) &#123;</span><br><span class="line">            addCriterion(&quot;id =&quot;, value, &quot;id&quot;);</span><br><span class="line">            return (Criteria) this;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public Criteria andIdNotEqualTo(Integer value) &#123;</span><br><span class="line">            addCriterion(&quot;id &lt;&gt;&quot;, value, &quot;id&quot;);</span><br><span class="line">            return (Criteria) this;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public Criteria andIdGreaterThan(Integer value) &#123;</span><br><span class="line">            addCriterion(&quot;id &gt;&quot;, value, &quot;id&quot;);</span><br><span class="line">            return (Criteria) this;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public Criteria andIdGreaterThanOrEqualTo(Integer value) &#123;</span><br><span class="line">            addCriterion(&quot;id &gt;=&quot;, value, &quot;id&quot;);</span><br><span class="line">            return (Criteria) this;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public Criteria andIdLessThan(Integer value) &#123;</span><br><span class="line">            addCriterion(&quot;id &lt;&quot;, value, &quot;id&quot;);</span><br><span class="line">            return (Criteria) this;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public Criteria andIdLessThanOrEqualTo(Integer value) &#123;</span><br><span class="line">            addCriterion(&quot;id &lt;=&quot;, value, &quot;id&quot;);</span><br><span class="line">            return (Criteria) this;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public Criteria andIdIn(List&lt;Integer&gt; values) &#123;</span><br><span class="line">            addCriterion(&quot;id in&quot;, values, &quot;id&quot;);</span><br><span class="line">            return (Criteria) this;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public Criteria andIdNotIn(List&lt;Integer&gt; values) &#123;</span><br><span class="line">            addCriterion(&quot;id not in&quot;, values, &quot;id&quot;);</span><br><span class="line">            return (Criteria) this;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public Criteria andIdBetween(Integer value1, Integer value2) &#123;</span><br><span class="line">            addCriterion(&quot;id between&quot;, value1, value2, &quot;id&quot;);</span><br><span class="line">            return (Criteria) this;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public Criteria andIdNotBetween(Integer value1, Integer value2) &#123;</span><br><span class="line">            addCriterion(&quot;id not between&quot;, value1, value2, &quot;id&quot;);</span><br><span class="line">            return (Criteria) this;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public Criteria andRealNameIsNull() &#123;</span><br><span class="line">            addCriterion(&quot;real_name is null&quot;);</span><br><span class="line">            return (Criteria) this;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public Criteria andRealNameIsNotNull() &#123;</span><br><span class="line">            addCriterion(&quot;real_name is not null&quot;);</span><br><span class="line">            return (Criteria) this;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public Criteria andRealNameEqualTo(String value) &#123;</span><br><span class="line">            addCriterion(&quot;real_name =&quot;, value, &quot;realName&quot;);</span><br><span class="line">            return (Criteria) this;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public Criteria andRealNameNotEqualTo(String value) &#123;</span><br><span class="line">            addCriterion(&quot;real_name &lt;&gt;&quot;, value, &quot;realName&quot;);</span><br><span class="line">            return (Criteria) this;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public Criteria andRealNameGreaterThan(String value) &#123;</span><br><span class="line">            addCriterion(&quot;real_name &gt;&quot;, value, &quot;realName&quot;);</span><br><span class="line">            return (Criteria) this;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public Criteria andRealNameGreaterThanOrEqualTo(String value) &#123;</span><br><span class="line">            addCriterion(&quot;real_name &gt;=&quot;, value, &quot;realName&quot;);</span><br><span class="line">            return (Criteria) this;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public Criteria andRealNameLessThan(String value) &#123;</span><br><span class="line">            addCriterion(&quot;real_name &lt;&quot;, value, &quot;realName&quot;);</span><br><span class="line">            return (Criteria) this;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public Criteria andRealNameLessThanOrEqualTo(String value) &#123;</span><br><span class="line">            addCriterion(&quot;real_name &lt;=&quot;, value, &quot;realName&quot;);</span><br><span class="line">            return (Criteria) this;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public Criteria andRealNameLike(String value) &#123;</span><br><span class="line">            addCriterion(&quot;real_name like&quot;, value, &quot;realName&quot;);</span><br><span class="line">            return (Criteria) this;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public Criteria andRealNameNotLike(String value) &#123;</span><br><span class="line">            addCriterion(&quot;real_name not like&quot;, value, &quot;realName&quot;);</span><br><span class="line">            return (Criteria) this;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public Criteria andRealNameIn(List&lt;String&gt; values) &#123;</span><br><span class="line">            addCriterion(&quot;real_name in&quot;, values, &quot;realName&quot;);</span><br><span class="line">            return (Criteria) this;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public Criteria andRealNameNotIn(List&lt;String&gt; values) &#123;</span><br><span class="line">            addCriterion(&quot;real_name not in&quot;, values, &quot;realName&quot;);</span><br><span class="line">            return (Criteria) this;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public Criteria andRealNameBetween(String value1, String value2) &#123;</span><br><span class="line">            addCriterion(&quot;real_name between&quot;, value1, value2, &quot;realName&quot;);</span><br><span class="line">            return (Criteria) this;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public Criteria andRealNameNotBetween(String value1, String value2) &#123;</span><br><span class="line">            addCriterion(&quot;real_name not between&quot;, value1, value2, &quot;realName&quot;);</span><br><span class="line">            return (Criteria) this;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public Criteria andPhoneNumIsNull() &#123;</span><br><span class="line">            addCriterion(&quot;phone_num is null&quot;);</span><br><span class="line">            return (Criteria) this;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public Criteria andPhoneNumIsNotNull() &#123;</span><br><span class="line">            addCriterion(&quot;phone_num is not null&quot;);</span><br><span class="line">            return (Criteria) this;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public Criteria andPhoneNumEqualTo(String value) &#123;</span><br><span class="line">            addCriterion(&quot;phone_num =&quot;, value, &quot;phoneNum&quot;);</span><br><span class="line">            return (Criteria) this;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public Criteria andPhoneNumNotEqualTo(String value) &#123;</span><br><span class="line">            addCriterion(&quot;phone_num &lt;&gt;&quot;, value, &quot;phoneNum&quot;);</span><br><span class="line">            return (Criteria) this;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public Criteria andPhoneNumGreaterThan(String value) &#123;</span><br><span class="line">            addCriterion(&quot;phone_num &gt;&quot;, value, &quot;phoneNum&quot;);</span><br><span class="line">            return (Criteria) this;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public Criteria andPhoneNumGreaterThanOrEqualTo(String value) &#123;</span><br><span class="line">            addCriterion(&quot;phone_num &gt;=&quot;, value, &quot;phoneNum&quot;);</span><br><span class="line">            return (Criteria) this;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public Criteria andPhoneNumLessThan(String value) &#123;</span><br><span class="line">            addCriterion(&quot;phone_num &lt;&quot;, value, &quot;phoneNum&quot;);</span><br><span class="line">            return (Criteria) this;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public Criteria andPhoneNumLessThanOrEqualTo(String value) &#123;</span><br><span class="line">            addCriterion(&quot;phone_num &lt;=&quot;, value, &quot;phoneNum&quot;);</span><br><span class="line">            return (Criteria) this;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public Criteria andPhoneNumLike(String value) &#123;</span><br><span class="line">            addCriterion(&quot;phone_num like&quot;, value, &quot;phoneNum&quot;);</span><br><span class="line">            return (Criteria) this;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public Criteria andPhoneNumNotLike(String value) &#123;</span><br><span class="line">            addCriterion(&quot;phone_num not like&quot;, value, &quot;phoneNum&quot;);</span><br><span class="line">            return (Criteria) this;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public Criteria andPhoneNumIn(List&lt;String&gt; values) &#123;</span><br><span class="line">            addCriterion(&quot;phone_num in&quot;, values, &quot;phoneNum&quot;);</span><br><span class="line">            return (Criteria) this;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public Criteria andPhoneNumNotIn(List&lt;String&gt; values) &#123;</span><br><span class="line">            addCriterion(&quot;phone_num not in&quot;, values, &quot;phoneNum&quot;);</span><br><span class="line">            return (Criteria) this;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public Criteria andPhoneNumBetween(String value1, String value2) &#123;</span><br><span class="line">            addCriterion(&quot;phone_num between&quot;, value1, value2, &quot;phoneNum&quot;);</span><br><span class="line">            return (Criteria) this;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public Criteria andPhoneNumNotBetween(String value1, String value2) &#123;</span><br><span class="line">            addCriterion(&quot;phone_num not between&quot;, value1, value2, &quot;phoneNum&quot;);</span><br><span class="line">            return (Criteria) this;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static class Criteria extends GeneratedCriteria &#123;</span><br><span class="line"></span><br><span class="line">        protected Criteria() &#123;</span><br><span class="line">            super();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static class Criterion &#123;</span><br><span class="line">        private String condition;</span><br><span class="line"></span><br><span class="line">        private Object value;</span><br><span class="line"></span><br><span class="line">        private Object secondValue;</span><br><span class="line"></span><br><span class="line">        private boolean noValue;</span><br><span class="line"></span><br><span class="line">        private boolean singleValue;</span><br><span class="line"></span><br><span class="line">        private boolean betweenValue;</span><br><span class="line"></span><br><span class="line">        private boolean listValue;</span><br><span class="line"></span><br><span class="line">        private String typeHandler;</span><br><span class="line"></span><br><span class="line">        public String getCondition() &#123;</span><br><span class="line">            return condition;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public Object getValue() &#123;</span><br><span class="line">            return value;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public Object getSecondValue() &#123;</span><br><span class="line">            return secondValue;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public boolean isNoValue() &#123;</span><br><span class="line">            return noValue;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public boolean isSingleValue() &#123;</span><br><span class="line">            return singleValue;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public boolean isBetweenValue() &#123;</span><br><span class="line">            return betweenValue;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public boolean isListValue() &#123;</span><br><span class="line">            return listValue;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public String getTypeHandler() &#123;</span><br><span class="line">            return typeHandler;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        protected Criterion(String condition) &#123;</span><br><span class="line">            super();</span><br><span class="line">            this.condition = condition;</span><br><span class="line">            this.typeHandler = null;</span><br><span class="line">            this.noValue = true;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        protected Criterion(String condition, Object value, String typeHandler) &#123;</span><br><span class="line">            super();</span><br><span class="line">            this.condition = condition;</span><br><span class="line">            this.value = value;</span><br><span class="line">            this.typeHandler = typeHandler;</span><br><span class="line">            if (value instanceof List&lt;?&gt;) &#123;</span><br><span class="line">                this.listValue = true;</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                this.singleValue = true;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        protected Criterion(String condition, Object value) &#123;</span><br><span class="line">            this(condition, value, null);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        protected Criterion(String condition, Object value, Object secondValue, String typeHandler) &#123;</span><br><span class="line">            super();</span><br><span class="line">            this.condition = condition;</span><br><span class="line">            this.value = value;</span><br><span class="line">            this.secondValue = secondValue;</span><br><span class="line">            this.typeHandler = typeHandler;</span><br><span class="line">            this.betweenValue = true;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        protected Criterion(String condition, Object value, Object secondValue) &#123;</span><br><span class="line">            this(condition, value, secondValue, null);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="UserMapper-java"><a href="#UserMapper-java" class="headerlink" title="UserMapper.java"></a>UserMapper.java</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">@Mapper</span><br><span class="line">public interface UserMapper &#123;</span><br><span class="line">    @SelectProvider(type=UserSqlProvider.class, method=&quot;countByExample&quot;)</span><br><span class="line">    long countByExample(UserExample example);</span><br><span class="line"></span><br><span class="line">    @DeleteProvider(type=UserSqlProvider.class, method=&quot;deleteByExample&quot;)</span><br><span class="line">    int deleteByExample(UserExample example);</span><br><span class="line"></span><br><span class="line">    @Delete(&#123;</span><br><span class="line">        &quot;delete from basic_user&quot;,</span><br><span class="line">        &quot;where id = #&#123;id,jdbcType=INTEGER&#125;&quot;</span><br><span class="line">    &#125;)</span><br><span class="line">    int deleteByPrimaryKey(Integer id);</span><br><span class="line"></span><br><span class="line">    @Insert(&#123;</span><br><span class="line">        &quot;insert into basic_user (id, real_name, &quot;,</span><br><span class="line">        &quot;phone_num)&quot;,</span><br><span class="line">        &quot;values (#&#123;id,jdbcType=INTEGER&#125;, #&#123;realName,jdbcType=VARCHAR&#125;, &quot;,</span><br><span class="line">        &quot;#&#123;phoneNum,jdbcType=VARCHAR&#125;)&quot;</span><br><span class="line">    &#125;)</span><br><span class="line">    int insert(User record);</span><br><span class="line"></span><br><span class="line">    @InsertProvider(type=UserSqlProvider.class, method=&quot;insertSelective&quot;)</span><br><span class="line">    int insertSelective(User record);</span><br><span class="line"></span><br><span class="line">    @SelectProvider(type=UserSqlProvider.class, method=&quot;selectByExample&quot;)</span><br><span class="line">    List&lt;User&gt; selectByExample(UserExample example);</span><br><span class="line"></span><br><span class="line">    @Select(&#123;</span><br><span class="line">        &quot;select&quot;,</span><br><span class="line">        &quot;id, real_name, phone_num&quot;,</span><br><span class="line">        &quot;from basic_user&quot;,</span><br><span class="line">        &quot;where id = #&#123;id,jdbcType=INTEGER&#125;&quot;</span><br><span class="line">    &#125;)</span><br><span class="line">    User selectByPrimaryKey(Integer id);</span><br><span class="line"></span><br><span class="line">    @UpdateProvider(type=UserSqlProvider.class, method=&quot;updateByExampleSelective&quot;)</span><br><span class="line">    int updateByExampleSelective(@Param(&quot;record&quot;) User record, @Param(&quot;example&quot;) UserExample example);</span><br><span class="line"></span><br><span class="line">    @UpdateProvider(type=UserSqlProvider.class, method=&quot;updateByExample&quot;)</span><br><span class="line">    int updateByExample(@Param(&quot;record&quot;) User record, @Param(&quot;example&quot;) UserExample example);</span><br><span class="line"></span><br><span class="line">    @UpdateProvider(type=UserSqlProvider.class, method=&quot;updateByPrimaryKeySelective&quot;)</span><br><span class="line">    int updateByPrimaryKeySelective(User record);</span><br><span class="line"></span><br><span class="line">    @Update(&#123;</span><br><span class="line">        &quot;update basic_user&quot;,</span><br><span class="line">        &quot;set real_name = #&#123;realName,jdbcType=VARCHAR&#125;,&quot;,</span><br><span class="line">          &quot;phone_num = #&#123;phoneNum,jdbcType=VARCHAR&#125;&quot;,</span><br><span class="line">        &quot;where id = #&#123;id,jdbcType=INTEGER&#125;&quot;</span><br><span class="line">    &#125;)</span><br><span class="line">    int updateByPrimaryKey(User record);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="UserSqlProvider-java"><a href="#UserSqlProvider-java" class="headerlink" title="UserSqlProvider.java"></a>UserSqlProvider.java</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br></pre></td><td class="code"><pre><span class="line">public class UserSqlProvider &#123;</span><br><span class="line"></span><br><span class="line">    public String countByExample(UserExample example) &#123;</span><br><span class="line">        SQL sql = new SQL();</span><br><span class="line">        sql.SELECT(&quot;count(*)&quot;).FROM(&quot;basic_user&quot;);</span><br><span class="line">        applyWhere(sql, example, false);</span><br><span class="line">        return sql.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String deleteByExample(UserExample example) &#123;</span><br><span class="line">        SQL sql = new SQL();</span><br><span class="line">        sql.DELETE_FROM(&quot;basic_user&quot;);</span><br><span class="line">        applyWhere(sql, example, false);</span><br><span class="line">        return sql.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String insertSelective(User record) &#123;</span><br><span class="line">        SQL sql = new SQL();</span><br><span class="line">        sql.INSERT_INTO(&quot;basic_user&quot;);</span><br><span class="line">        </span><br><span class="line">        if (record.getId() != null) &#123;</span><br><span class="line">            sql.VALUES(&quot;id&quot;, &quot;#&#123;id,jdbcType=INTEGER&#125;&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        if (record.getRealName() != null) &#123;</span><br><span class="line">            sql.VALUES(&quot;real_name&quot;, &quot;#&#123;realName,jdbcType=VARCHAR&#125;&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        if (record.getPhoneNum() != null) &#123;</span><br><span class="line">            sql.VALUES(&quot;phone_num&quot;, &quot;#&#123;phoneNum,jdbcType=VARCHAR&#125;&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        return sql.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String selectByExample(UserExample example) &#123;</span><br><span class="line">        SQL sql = new SQL();</span><br><span class="line">        if (example != null &amp;&amp; example.isDistinct()) &#123;</span><br><span class="line">            sql.SELECT_DISTINCT(&quot;id&quot;);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            sql.SELECT(&quot;id&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        sql.SELECT(&quot;real_name&quot;);</span><br><span class="line">        sql.SELECT(&quot;phone_num&quot;);</span><br><span class="line">        sql.FROM(&quot;basic_user&quot;);</span><br><span class="line">        applyWhere(sql, example, false);</span><br><span class="line">        </span><br><span class="line">        if (example != null &amp;&amp; example.getOrderByClause() != null) &#123;</span><br><span class="line">            sql.ORDER_BY(example.getOrderByClause());</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        return sql.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String updateByExampleSelective(Map&lt;String, Object&gt; parameter) &#123;</span><br><span class="line">        User record = (User) parameter.get(&quot;record&quot;);</span><br><span class="line">        UserExample example = (UserExample) parameter.get(&quot;example&quot;);</span><br><span class="line">        </span><br><span class="line">        SQL sql = new SQL();</span><br><span class="line">        sql.UPDATE(&quot;basic_user&quot;);</span><br><span class="line">        </span><br><span class="line">        if (record.getId() != null) &#123;</span><br><span class="line">            sql.SET(&quot;id = #&#123;record.id,jdbcType=INTEGER&#125;&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        if (record.getRealName() != null) &#123;</span><br><span class="line">            sql.SET(&quot;real_name = #&#123;record.realName,jdbcType=VARCHAR&#125;&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        if (record.getPhoneNum() != null) &#123;</span><br><span class="line">            sql.SET(&quot;phone_num = #&#123;record.phoneNum,jdbcType=VARCHAR&#125;&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        applyWhere(sql, example, true);</span><br><span class="line">        return sql.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String updateByExample(Map&lt;String, Object&gt; parameter) &#123;</span><br><span class="line">        SQL sql = new SQL();</span><br><span class="line">        sql.UPDATE(&quot;basic_user&quot;);</span><br><span class="line">        </span><br><span class="line">        sql.SET(&quot;id = #&#123;record.id,jdbcType=INTEGER&#125;&quot;);</span><br><span class="line">        sql.SET(&quot;real_name = #&#123;record.realName,jdbcType=VARCHAR&#125;&quot;);</span><br><span class="line">        sql.SET(&quot;phone_num = #&#123;record.phoneNum,jdbcType=VARCHAR&#125;&quot;);</span><br><span class="line">        </span><br><span class="line">        UserExample example = (UserExample) parameter.get(&quot;example&quot;);</span><br><span class="line">        applyWhere(sql, example, true);</span><br><span class="line">        return sql.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String updateByPrimaryKeySelective(User record) &#123;</span><br><span class="line">        SQL sql = new SQL();</span><br><span class="line">        sql.UPDATE(&quot;basic_user&quot;);</span><br><span class="line">        </span><br><span class="line">        if (record.getRealName() != null) &#123;</span><br><span class="line">            sql.SET(&quot;real_name = #&#123;realName,jdbcType=VARCHAR&#125;&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        if (record.getPhoneNum() != null) &#123;</span><br><span class="line">            sql.SET(&quot;phone_num = #&#123;phoneNum,jdbcType=VARCHAR&#125;&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        sql.WHERE(&quot;id = #&#123;id,jdbcType=INTEGER&#125;&quot;);</span><br><span class="line">        </span><br><span class="line">        return sql.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    protected void applyWhere(SQL sql, UserExample example, boolean includeExamplePhrase) &#123;</span><br><span class="line">        if (example == null) &#123;</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        String parmPhrase1;</span><br><span class="line">        String parmPhrase1_th;</span><br><span class="line">        String parmPhrase2;</span><br><span class="line">        String parmPhrase2_th;</span><br><span class="line">        String parmPhrase3;</span><br><span class="line">        String parmPhrase3_th;</span><br><span class="line">        if (includeExamplePhrase) &#123;</span><br><span class="line">            parmPhrase1 = &quot;%s #&#123;example.oredCriteria[%d].allCriteria[%d].value&#125;&quot;;</span><br><span class="line">            parmPhrase1_th = &quot;%s #&#123;example.oredCriteria[%d].allCriteria[%d].value,typeHandler=%s&#125;&quot;;</span><br><span class="line">            parmPhrase2 = &quot;%s #&#123;example.oredCriteria[%d].allCriteria[%d].value&#125; and #&#123;example.oredCriteria[%d].criteria[%d].secondValue&#125;&quot;;</span><br><span class="line">            parmPhrase2_th = &quot;%s #&#123;example.oredCriteria[%d].allCriteria[%d].value,typeHandler=%s&#125; and #&#123;example.oredCriteria[%d].criteria[%d].secondValue,typeHandler=%s&#125;&quot;;</span><br><span class="line">            parmPhrase3 = &quot;#&#123;example.oredCriteria[%d].allCriteria[%d].value[%d]&#125;&quot;;</span><br><span class="line">            parmPhrase3_th = &quot;#&#123;example.oredCriteria[%d].allCriteria[%d].value[%d],typeHandler=%s&#125;&quot;;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            parmPhrase1 = &quot;%s #&#123;oredCriteria[%d].allCriteria[%d].value&#125;&quot;;</span><br><span class="line">            parmPhrase1_th = &quot;%s #&#123;oredCriteria[%d].allCriteria[%d].value,typeHandler=%s&#125;&quot;;</span><br><span class="line">            parmPhrase2 = &quot;%s #&#123;oredCriteria[%d].allCriteria[%d].value&#125; and #&#123;oredCriteria[%d].criteria[%d].secondValue&#125;&quot;;</span><br><span class="line">            parmPhrase2_th = &quot;%s #&#123;oredCriteria[%d].allCriteria[%d].value,typeHandler=%s&#125; and #&#123;oredCriteria[%d].criteria[%d].secondValue,typeHandler=%s&#125;&quot;;</span><br><span class="line">            parmPhrase3 = &quot;#&#123;oredCriteria[%d].allCriteria[%d].value[%d]&#125;&quot;;</span><br><span class="line">            parmPhrase3_th = &quot;#&#123;oredCriteria[%d].allCriteria[%d].value[%d],typeHandler=%s&#125;&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        StringBuilder sb = new StringBuilder();</span><br><span class="line">        List&lt;Criteria&gt; oredCriteria = example.getOredCriteria();</span><br><span class="line">        boolean firstCriteria = true;</span><br><span class="line">        for (int i = 0; i &lt; oredCriteria.size(); i++) &#123;</span><br><span class="line">            Criteria criteria = oredCriteria.get(i);</span><br><span class="line">            if (criteria.isValid()) &#123;</span><br><span class="line">                if (firstCriteria) &#123;</span><br><span class="line">                    firstCriteria = false;</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    sb.append(&quot; or &quot;);</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                sb.append(&apos;(&apos;);</span><br><span class="line">                List&lt;Criterion&gt; criterions = criteria.getAllCriteria();</span><br><span class="line">                boolean firstCriterion = true;</span><br><span class="line">                for (int j = 0; j &lt; criterions.size(); j++) &#123;</span><br><span class="line">                    Criterion criterion = criterions.get(j);</span><br><span class="line">                    if (firstCriterion) &#123;</span><br><span class="line">                        firstCriterion = false;</span><br><span class="line">                    &#125; else &#123;</span><br><span class="line">                        sb.append(&quot; and &quot;);</span><br><span class="line">                    &#125;</span><br><span class="line">                    </span><br><span class="line">                    if (criterion.isNoValue()) &#123;</span><br><span class="line">                        sb.append(criterion.getCondition());</span><br><span class="line">                    &#125; else if (criterion.isSingleValue()) &#123;</span><br><span class="line">                        if (criterion.getTypeHandler() == null) &#123;</span><br><span class="line">                            sb.append(String.format(parmPhrase1, criterion.getCondition(), i, j));</span><br><span class="line">                        &#125; else &#123;</span><br><span class="line">                            sb.append(String.format(parmPhrase1_th, criterion.getCondition(), i, j,criterion.getTypeHandler()));</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; else if (criterion.isBetweenValue()) &#123;</span><br><span class="line">                        if (criterion.getTypeHandler() == null) &#123;</span><br><span class="line">                            sb.append(String.format(parmPhrase2, criterion.getCondition(), i, j, i, j));</span><br><span class="line">                        &#125; else &#123;</span><br><span class="line">                            sb.append(String.format(parmPhrase2_th, criterion.getCondition(), i, j, criterion.getTypeHandler(), i, j, criterion.getTypeHandler()));</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; else if (criterion.isListValue()) &#123;</span><br><span class="line">                        sb.append(criterion.getCondition());</span><br><span class="line">                        sb.append(&quot; (&quot;);</span><br><span class="line">                        List&lt;?&gt; listItems = (List&lt;?&gt;) criterion.getValue();</span><br><span class="line">                        boolean comma = false;</span><br><span class="line">                        for (int k = 0; k &lt; listItems.size(); k++) &#123;</span><br><span class="line">                            if (comma) &#123;</span><br><span class="line">                                sb.append(&quot;, &quot;);</span><br><span class="line">                            &#125; else &#123;</span><br><span class="line">                                comma = true;</span><br><span class="line">                            &#125;</span><br><span class="line">                            if (criterion.getTypeHandler() == null) &#123;</span><br><span class="line">                                sb.append(String.format(parmPhrase3, i, j, k));</span><br><span class="line">                            &#125; else &#123;</span><br><span class="line">                                sb.append(String.format(parmPhrase3_th, i, j, k, criterion.getTypeHandler()));</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                        sb.append(&apos;)&apos;);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                sb.append(&apos;)&apos;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        if (sb.length() &gt; 0) &#123;</span><br><span class="line">            sql.WHERE(sb.toString());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="编写一个简单的CRUD"><a href="#编写一个简单的CRUD" class="headerlink" title="编写一个简单的CRUD"></a>编写一个简单的CRUD</h3><h4 id="UserInfoService-java"><a href="#UserInfoService-java" class="headerlink" title="UserInfoService.java"></a>UserInfoService.java</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">public interface UserInfoService &#123;</span><br><span class="line"></span><br><span class="line">    public int insert(User user);</span><br><span class="line"></span><br><span class="line">    public int deleteByPrimaryKey(int primeryKey);</span><br><span class="line"></span><br><span class="line">    public int updateByExample(User user);</span><br><span class="line"></span><br><span class="line">    public List&lt;User&gt; selectByExample(User user);</span><br><span class="line"></span><br><span class="line">    public User selectByPrimaryKey(int primeryKey);</span><br><span class="line"></span><br><span class="line">    public PageInfo&lt;User&gt; selectByExampleWithPage(User user, Page page);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="UserInfoServiceImpl-java"><a href="#UserInfoServiceImpl-java" class="headerlink" title="UserInfoServiceImpl.java"></a>UserInfoServiceImpl.java</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">@Service</span><br><span class="line">public class UserInfoServiceImpl implements UserInfoService &#123;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public int insert(User user) &#123;</span><br><span class="line">        return userMapper.insert(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public int deleteByPrimaryKey(int primaryKey) &#123;</span><br><span class="line">        return userMapper.deleteByPrimaryKey(primaryKey);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public int updateByExample(User user) &#123;</span><br><span class="line">        Validate.notNull(user.getId(), &quot;唯一标志不可为空&quot;);</span><br><span class="line">        return userMapper.updateByPrimaryKeySelective(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public List&lt;User&gt; selectByExample(User user) &#123;</span><br><span class="line">        return userMapper.selectByExample(getUserExample(user));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private UserExample getUserExample(User user) &#123;</span><br><span class="line">        UserExample userExample = new UserExample();</span><br><span class="line">        if(null != user) &#123;</span><br><span class="line">            if(null != user.getId()) &#123;</span><br><span class="line">                userExample.createCriteria().andIdEqualTo(user.getId());</span><br><span class="line">            &#125;</span><br><span class="line">            if(null != user.getPhoneNum()) &#123;</span><br><span class="line">                userExample.createCriteria().andPhoneNumEqualTo(user.getPhoneNum());</span><br><span class="line">            &#125;</span><br><span class="line">            if(null != user.getRealName()) &#123;</span><br><span class="line">                userExample.createCriteria().andRealNameEqualTo(user.getRealName());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return userExample;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public User selectByPrimaryKey(int primaryKey) &#123;</span><br><span class="line">        return userMapper.selectByPrimaryKey(primaryKey);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public PageInfo&lt;User&gt; selectByExampleWithPage(User user, Page page) &#123;</span><br><span class="line">        PageHelper.startPage(page.getPageNum(), page.getPageSize());</span><br><span class="line">        return new PageInfo&lt;&gt;(userMapper.selectByExample(getUserExample(user)));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="UserInfoController-java"><a href="#UserInfoController-java" class="headerlink" title="UserInfoController.java"></a>UserInfoController.java</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">@RestController</span><br><span class="line">public class UserInfoController &#123;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private UserInfoService userInfoService;</span><br><span class="line"></span><br><span class="line">    @PostMapping(&quot;userInfo&quot;)</span><br><span class="line">    public Boolean insert(@Valid User user) &#123;</span><br><span class="line">        int i = userInfoService.insert(user);</span><br><span class="line">        return i &gt; 0;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @DeleteMapping(&quot;userInfo&quot;)</span><br><span class="line">    public Boolean delete(int id) &#123;</span><br><span class="line">        return userInfoService.deleteByPrimaryKey(id) &gt; 0;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @PutMapping(&quot;userInfo&quot;)</span><br><span class="line">    public Boolean update(User user) &#123;</span><br><span class="line">        return userInfoService.updateByExample(user) &gt; 0;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @GetMapping(&quot;userInfo&quot;)</span><br><span class="line">    public PageInfo&lt;User&gt; get(</span><br><span class="line">            User user,</span><br><span class="line">            @RequestParam(defaultValue = &quot;20&quot;) int pageSize,</span><br><span class="line">            @RequestParam(defaultValue = &quot;1&quot;) int pageNum</span><br><span class="line">    ) &#123;</span><br><span class="line">        return userInfoService.selectByExampleWithPage(user, new Page(pageNum, pageSize));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="SpringBoot-配置多数据源和事务"><a href="#SpringBoot-配置多数据源和事务" class="headerlink" title="SpringBoot 配置多数据源和事务"></a>SpringBoot 配置多数据源和事务</h2><p>由于配置了多数据源，就不能使用springboot默认的配置了，我们需要手动配置多个数据源，并且配置相关的事务管理器。为了便于管理，这里我们将不同的数据源进行了包的拆分。</p>
<h3 id="多数据源属性配置"><a href="#多数据源属性配置" class="headerlink" title="多数据源属性配置"></a>多数据源属性配置</h3><h4 id="application-yml-需要增加第二个数据源的配置"><a href="#application-yml-需要增加第二个数据源的配置" class="headerlink" title="application.yml 需要增加第二个数据源的配置"></a><code>application.yml</code> 需要增加第二个数据源的配置</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  profiles:</span><br><span class="line">    active: dev</span><br><span class="line">  datasource:</span><br><span class="line">    multiplenames: register</span><br><span class="line">    type: com.alibaba.druid.pool.DruidDataSource</span><br><span class="line">    druid:</span><br><span class="line">        driver-class-name: com.mysql.cj.jdbc.Driver</span><br><span class="line">        # 基本属性</span><br><span class="line">        url: jdbc:mysql://127.0.0.1:3306/base_service?serverTimezone=Shanghai&amp;charset=utf8mb4&amp;useSSL=false</span><br><span class="line">        username: root</span><br><span class="line">        password: root</span><br><span class="line">        # 配置初始化大小/最小/最大 [仅用于测试，生产环境需要修改]</span><br><span class="line">        initial-size: 5</span><br><span class="line">        min-idle: 5</span><br><span class="line">        max-active: 20</span><br><span class="line">        # 获取连接等待超时时间</span><br><span class="line">        max-wait: 60000</span><br><span class="line">        # 间隔多久进行一次检测，检测需要关闭的空闲连接</span><br><span class="line">        time-between-eviction-runs-millis: 60000</span><br><span class="line">        # 一个连接在池中最小生存的时间</span><br><span class="line">        min-evictable-idle-time-millis: 300000</span><br><span class="line">        # 指定获取连接时连接校验的SQL查询语句</span><br><span class="line">        validation-query: SELECT &apos;x&apos;</span><br><span class="line">        # 验证连接的有效性</span><br><span class="line">        test-while-idle: true</span><br><span class="line">        # 获取连接时验证(会影响性能,不建议true)</span><br><span class="line">        test-on-borrow: false</span><br><span class="line">        # 打开PSCache，并指定每个连接上PSCache的大小。oracle设为true，MySQL设为false。分库分表较多推荐设置为false</span><br><span class="line">        pool-prepared-statements: false</span><br><span class="line">        max-pool-prepared-statement-per-connection-size: 20</span><br><span class="line">    register:</span><br><span class="line">      type: com.alibaba.druid.pool.DruidDataSource</span><br><span class="line">      druid:</span><br><span class="line">        driver-class-name: com.mysql.cj.jdbc.Driver</span><br><span class="line">        # 基本属性</span><br><span class="line">        url: jdbc:mysql://127.0.0.1:3306/register_service?serverTimezone=Shanghai&amp;charset=utf8mb4&amp;useSSL=false</span><br><span class="line">        username: root</span><br><span class="line">        password: root</span><br><span class="line">        # 配置初始化大小/最小/最大 [仅用于测试，生产环境需要修改]</span><br><span class="line">        initial-size: 5</span><br><span class="line">        min-idle: 5</span><br><span class="line">        max-active: 20</span><br><span class="line">        # 获取连接等待超时时间</span><br><span class="line">        max-wait: 60000</span><br><span class="line">        # 间隔多久进行一次检测，检测需要关闭的空闲连接</span><br><span class="line">        time-between-eviction-runs-millis: 60000</span><br><span class="line">        # 一个连接在池中最小生存的时间</span><br><span class="line">        min-evictable-idle-time-millis: 300000</span><br><span class="line">        # 指定获取连接时连接校验的SQL查询语句</span><br><span class="line">        validation-query: SELECT &apos;x&apos;</span><br><span class="line">        # 验证连接的有效性</span><br><span class="line">        test-while-idle: true</span><br><span class="line">        # 获取连接时验证(会影响性能,不建议true)</span><br><span class="line">        test-on-borrow: false</span><br><span class="line">        # 打开PSCache，并指定每个连接上PSCache的大小。oracle设为true，MySQL设为false。分库分表较多推荐设置为false</span><br><span class="line">        pool-prepared-statements: false</span><br><span class="line">        max-pool-prepared-statement-per-connection-size: 20</span><br></pre></td></tr></table></figure>
<p>主要是添加了这两行 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">   multiplenames: register</span><br><span class="line">//省略...</span><br><span class="line">register:</span><br><span class="line">//省略...</span><br></pre></td></tr></table></figure>
<h4 id="配置数据源及事务"><a href="#配置数据源及事务" class="headerlink" title="配置数据源及事务"></a>配置数据源及事务</h4><p>主数据源</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">@Configuration</span><br><span class="line">@MapperScan(basePackages = &#123;&quot;com.misaniy.basicservice.dao.baseMapper&quot;&#125;, sqlSessionTemplateRef = &quot;baseSqlSessionTemplate&quot;)</span><br><span class="line">public class MyBatisBaseDbConfig &#123;</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    // 默认数据源</span><br><span class="line">    @Primary</span><br><span class="line">    // 类型安全的属性配置</span><br><span class="line">    @ConfigurationProperties(prefix = &quot;spring.datasource.druid&quot;)</span><br><span class="line">    public DataSource mysqlDataSource() &#123;</span><br><span class="line">        // 通过DataSourceBuilder勾弦数据库</span><br><span class="line">        return DataSourceBuilder.create().type(DruidDataSource.class).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    @Primary</span><br><span class="line">    public SqlSessionFactory baseSqlSessionFactory(DataSource dataSource) throws Exception &#123;</span><br><span class="line">        SqlSessionFactoryBean bean = new SqlSessionFactoryBean();</span><br><span class="line">        bean.setDataSource(dataSource);</span><br><span class="line">        return bean.getObject();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 事务管理器</span><br><span class="line">    @Bean(name = &quot;baseTransactionManager&quot;)</span><br><span class="line">    @Primary</span><br><span class="line">    public DataSourceTransactionManager baseServiceTransactionManager(DataSource dataSource)&#123;</span><br><span class="line">        return new DataSourceTransactionManager(dataSource);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    @Primary</span><br><span class="line">    public SqlSessionTemplate baseSqlSessionTemplate(@Qualifier(&quot;baseSqlSessionFactory&quot;) SqlSessionFactory sqlSessionFactory)&#123;</span><br><span class="line">        return new SqlSessionTemplate(sqlSessionFactory);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>第二个数据源的配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">@MapperScan(basePackages = &#123;&quot;com.misaniy.basicService.dao.registerMapper&quot;&#125;,sqlSessionTemplateRef = &quot;registerdbSqlSessionTemplate&quot;)</span><br><span class="line">public class MyBatisRegisterDbConfig &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    @Qualifier(&quot;registerdb&quot;)</span><br><span class="line">    @ConfigurationProperties(prefix = &quot;spring.datasource.registerdb.druid&quot;)</span><br><span class="line">    public DataSource registerDataSource()&#123;</span><br><span class="line">        return DataSourceBuilder.create().type(DruidDataSource.class).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Bean(name = &quot;registerdbSqlSessionFactory&quot;)</span><br><span class="line">    public SqlSessionFactory registerSqlSessionFactory (@Qualifier(&quot;registerdb&quot;)DataSource dataSource) throws Exception &#123;</span><br><span class="line">        SqlSessionFactoryBean bean = new SqlSessionFactoryBean();</span><br><span class="line">        bean.setDataSource(dataSource);</span><br><span class="line">        return bean.getObject();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Bean(name = &quot;registerdbTransactionMapper&quot;)</span><br><span class="line">    public DataSourceTransactionManager registerTransactionMapper(@Qualifier(&quot;registerdb&quot;) DataSource dataSource) &#123;</span><br><span class="line">        return new DataSourceTransactionManager(dataSource);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Bean(name = &quot;registerdbSqlSessionTemplate&quot;)</span><br><span class="line">    public SqlSessionTemplate registerTransactionTemplate(@Qualifier(&quot;registerdbSqlSessionFactory&quot;) SqlSessionFactory sqlSessionFactory) &#123;</span><br><span class="line">        return new SqlSessionTemplate(sqlSessionFactory);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后写了一个事务测试，这里<strong>事务只支持单数据源事务</strong>，多数据源事务归属于分布式事务的问题</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">@Transactional(rollbackFor = Exception.class, transactionManager = &quot;registerTransactionMapper&quot;)</span><br><span class="line">public void transactionTest() &#123;</span><br><span class="line">    User user = userMapper.selectByPrimaryKey(1);</span><br><span class="line">    user.setRealName(&quot;修改2&quot;);</span><br><span class="line">    userMapper.updateByPrimaryKeySelective(user);</span><br><span class="line">    UserInfo userInfo = userInfoMapper.selectByPrimaryKey(1);</span><br><span class="line">    userInfo.setUserMobile(&quot;10001&quot;);</span><br><span class="line">    userInfoMapper.updateByPrimaryKeySelective(userInfo);</span><br><span class="line"></span><br><span class="line">    int i = 1/0;</span><br><span class="line"></span><br><span class="line">    user.setRealName(&quot;修改3&quot;);</span><br><span class="line">    userMapper.updateByPrimaryKeySelective(user);</span><br><span class="line">    userInfo.setUserMobile(&quot;10002&quot;);</span><br><span class="line">    userInfoMapper.updateByPrimaryKeySelective(userInfo);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="SpringBoot-集成-Redis"><a href="#SpringBoot-集成-Redis" class="headerlink" title="SpringBoot 集成 Redis"></a>SpringBoot 集成 Redis</h2><h3 id="序列化"><a href="#序列化" class="headerlink" title="序列化"></a>序列化</h3><h4 id="StringRedisTemplate"><a href="#StringRedisTemplate" class="headerlink" title="StringRedisTemplate"></a>StringRedisTemplate</h4><p>可以看到StringRedisTemplate 是用的RedisSerializer.string() 序列化<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">public class StringRedisTemplate extends RedisTemplate&lt;String, String&gt; &#123;</span><br><span class="line"></span><br><span class="line">	/**</span><br><span class="line">	 * Constructs a new &lt;code&gt;StringRedisTemplate&lt;/code&gt; instance. &#123;@link #setConnectionFactory(RedisConnectionFactory)&#125;</span><br><span class="line">	 * and &#123;@link #afterPropertiesSet()&#125; still need to be called.</span><br><span class="line">	 */</span><br><span class="line">	public StringRedisTemplate() &#123;</span><br><span class="line">		setKeySerializer(RedisSerializer.string());</span><br><span class="line">		setValueSerializer(RedisSerializer.string());</span><br><span class="line">		setHashKeySerializer(RedisSerializer.string());</span><br><span class="line">		setHashValueSerializer(RedisSerializer.string());</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure></p>
<p>RedisSerializer.string()</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">static RedisSerializer&lt;String&gt; string() &#123;</span><br><span class="line">	return StringRedisSerializer.UTF_8;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>UTF_8</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public static final StringRedisSerializer UTF_8 = new StringRedisSerializer(StandardCharsets.UTF_8);</span><br></pre></td></tr></table></figure>
<h3 id="RedisTemplate"><a href="#RedisTemplate" class="headerlink" title="RedisTemplate"></a>RedisTemplate</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">public void afterPropertiesSet() &#123;</span><br><span class="line"></span><br><span class="line">	super.afterPropertiesSet();</span><br><span class="line"></span><br><span class="line">	boolean defaultUsed = false;</span><br><span class="line"></span><br><span class="line">	if (defaultSerializer == null) &#123;</span><br><span class="line"></span><br><span class="line">		defaultSerializer = new JdkSerializationRedisSerializer(</span><br><span class="line">				classLoader != null ? classLoader : this.getClass().getClassLoader());</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	if (enableDefaultSerializer) &#123;</span><br><span class="line"></span><br><span class="line">		if (keySerializer == null) &#123;</span><br><span class="line">			keySerializer = defaultSerializer;</span><br><span class="line">			defaultUsed = true;</span><br><span class="line">		&#125;</span><br><span class="line">		if (valueSerializer == null) &#123;</span><br><span class="line">			valueSerializer = defaultSerializer;</span><br><span class="line">			defaultUsed = true;</span><br><span class="line">		&#125;</span><br><span class="line">		if (hashKeySerializer == null) &#123;</span><br><span class="line">			hashKeySerializer = defaultSerializer;</span><br><span class="line">			defaultUsed = true;</span><br><span class="line">		&#125;</span><br><span class="line">		if (hashValueSerializer == null) &#123;</span><br><span class="line">			hashValueSerializer = defaultSerializer;</span><br><span class="line">			defaultUsed = true;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	if (enableDefaultSerializer &amp;&amp; defaultUsed) &#123;</span><br><span class="line">		Assert.notNull(defaultSerializer, &quot;default serializer null and not all serializers initialized&quot;);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	if (scriptExecutor == null) &#123;</span><br><span class="line">		this.scriptExecutor = new DefaultScriptExecutor&lt;&gt;(this);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	initialized = true;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看到RedisTemplate是用的jdk序列化</p>
<p>所以, <strong> 两者是不可通用的 </strong></p>
<h3 id="切换序列化方式"><a href="#切换序列化方式" class="headerlink" title="切换序列化方式"></a>切换序列化方式</h3><p>假如我们使用fastjson，则需要自定义RedisTemplate的bean，替换springboot原有注入的bean：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">public class SpringBootConfig &#123;</span><br><span class="line">    //@Bean表示如果这里自定义了bean，则不加载springboot starter中提供的默认bean。</span><br><span class="line">    @Bean</span><br><span class="line">    public RedisTemplate&lt;String, String&gt; redisTemplate(</span><br><span class="line">            RedisConnectionFactory factory) &#123;</span><br><span class="line">        StringRedisTemplate template = new StringRedisTemplate(factory);</span><br><span class="line">        template.setKeySerializer(RedisSerializer.string());</span><br><span class="line">        template.setValueSerializer(new FastJsonRedisSerializer&lt;&gt;(Object.class));</span><br><span class="line">        template.setHashKeySerializer(RedisSerializer.string());</span><br><span class="line">        template.setHashValueSerializer(new FastJsonRedisSerializer&lt;&gt;(Object.class));</span><br><span class="line">        template.afterPropertiesSet();</span><br><span class="line">        return template;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="集成多数据源"><a href="#集成多数据源" class="headerlink" title="集成多数据源"></a>集成多数据源</h2><p>有时候会遇到在一个项目中访问多个redis数据源的情况，这里就模拟一下springboot2.1+redis多数据源的配置</p>
<h3 id="多数据源配置"><a href="#多数据源配置" class="headerlink" title="多数据源配置"></a>多数据源配置</h3><p>SpringBoot 2.x 默认使用了Lettuce作Redis客户端，相较于Jedis，它的连接是基于Netty的，连接实例可以在多个线程间并发访问，多线程下线程安全，而Jedis要满足这一点必须得用连接池。这里我们两个方法都实现一遍。</p>
<h4 id="Lettuce"><a href="#Lettuce" class="headerlink" title="Lettuce"></a>Lettuce</h4><p>这里采用不同的datebase模拟多数据源</p>
<p>引入依赖pom.xml</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- Redis --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;!-- spring2.X集成redis所需common-pool2--&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">&lt;groupId&gt;org.apache.commons&lt;/groupId&gt;</span><br><span class="line">&lt;artifactId&gt;commons-pool2&lt;/artifactId&gt;</span><br><span class="line">&lt;version&gt;2.6.2&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<p>多数据源配置application.yml</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">redis:</span><br><span class="line">  host: 127.0.0.1</span><br><span class="line">  timeout: 3000</span><br><span class="line">  password: 12345</span><br><span class="line">  lettuce:</span><br><span class="line">    pool:</span><br><span class="line">      max-active: 8 # 最大连接数</span><br><span class="line">      max-wait: 1 # 最大阻塞等待时间</span><br><span class="line">      max-idle: 8 # 最大空闲连接</span><br><span class="line">      min-idle: 0 # 最小空闲连接</span><br><span class="line">  database: 0</span><br><span class="line">redis2:</span><br><span class="line">  host: 127.0.0.1</span><br><span class="line">  password: 12345</span><br><span class="line">  database: 1</span><br></pre></td></tr></table></figure>
<p>多数据源不能使用springboot默认配置，需要自定义配置</p>
<blockquote>
<p>lettuce 连接池 &gt; LettuceConnectionFactory &gt; RedisTemplate</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">public class RedisLettuceConfig &#123;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 配置Lettuce 连接池</span><br><span class="line">     */</span><br><span class="line">    @Bean</span><br><span class="line">    @ConfigurationProperties(prefix = &quot;spring.redis.lettuce.pool&quot;)</span><br><span class="line">    public GenericObjectPoolConfig poolConfig()&#123;</span><br><span class="line">         return new GenericObjectPoolConfig&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    @ConfigurationProperties(prefix = &quot;spring.redis&quot;)</span><br><span class="line">    public RedisStandaloneConfiguration redisConfig()&#123;</span><br><span class="line">        return new RedisStandaloneConfiguration();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    @ConfigurationProperties(prefix = &quot;spring.redis2&quot;)</span><br><span class="line">    public RedisStandaloneConfiguration redisConfig2()&#123;</span><br><span class="line">        return new RedisStandaloneConfiguration();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     *  配置第一个数据源的连接工厂</span><br><span class="line">     *</span><br><span class="line">     */</span><br><span class="line">    @Bean(&quot;factory&quot;)</span><br><span class="line">    @Primary</span><br><span class="line">    public LettuceConnectionFactory factory(GenericObjectPoolConfig config, RedisStandaloneConfiguration redisConfig) &#123;</span><br><span class="line">        LettucePoolingClientConfiguration configuration = LettucePoolingClientConfiguration.builder().poolConfig(config).build();</span><br><span class="line">        return new LettuceConnectionFactory(redisConfig, configuration);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Bean(&quot;factory2&quot;)</span><br><span class="line">    public LettuceConnectionFactory factory2(GenericObjectPoolConfig config, RedisStandaloneConfiguration redisConfig2) &#123;</span><br><span class="line">        LettucePoolingClientConfiguration configuration = LettucePoolingClientConfiguration.builder().poolConfig(config).build();</span><br><span class="line">        return new LettuceConnectionFactory(redisConfig2, configuration);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 配置第一个数据源的RedisTemplate</span><br><span class="line">     * 这里指定使用名称=factory的RedisConnectionFactory</span><br><span class="line">     * 并且标识第一个数据源是默认数据源 @Primary</span><br><span class="line">     *</span><br><span class="line">     */</span><br><span class="line">    @Bean(&quot;redisTemplate&quot;)</span><br><span class="line">    @Primary</span><br><span class="line">    public StringRedisTemplate redisTemplate(@Qualifier(&quot;factory&quot;)RedisConnectionFactory factory) &#123;</span><br><span class="line">        return new StringRedisTemplate(factory);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Bean(&quot;redisTemplate2&quot;)</span><br><span class="line">    public StringRedisTemplate redisTemplate2(@Qualifier(&quot;factory2&quot;)RedisConnectionFactory factory2) &#123;</span><br><span class="line">        return new StringRedisTemplate(factory2);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用的话,默认使用@Primary，添加@Qualifier注解可指定</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@Autowired</span><br><span class="line">@Qualifier(&quot;redisTemplate2&quot;)</span><br><span class="line">private StringRedisTemplate stringRedisTemplate;</span><br></pre></td></tr></table></figure>
<h3 id="Jedis"><a href="#Jedis" class="headerlink" title="Jedis"></a>Jedis</h3><p>引入pom.xml</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- Redis --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;</span><br><span class="line">    &lt;exclusions&gt;</span><br><span class="line">        &lt;exclusion&gt;</span><br><span class="line">            &lt;groupId&gt;io.lettuce&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;lettuce-core&lt;/artifactId&gt;</span><br><span class="line">        &lt;/exclusion&gt;</span><br><span class="line">    &lt;/exclusions&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;redis.clients&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;jedis&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- spring2.X集成redis所需common-pool2--&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">&lt;groupId&gt;org.apache.commons&lt;/groupId&gt;</span><br><span class="line">&lt;artifactId&gt;commons-pool2&lt;/artifactId&gt;</span><br><span class="line">&lt;version&gt;2.6.2&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<p>编写RedisJedisConfig.java</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">public class RedisJedisConfig &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @Bean()</span><br><span class="line">    @ConfigurationProperties(prefix = &quot;spring.redis.jedis.pool&quot;)</span><br><span class="line">    public JedisPoolConfig poolConfig() &#123;</span><br><span class="line">        return new JedisPoolConfig();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    @ConfigurationProperties(prefix = &quot;spring.redis&quot;)</span><br><span class="line">    public RedisStandaloneConfiguration redisConfig()&#123;</span><br><span class="line">        return new RedisStandaloneConfiguration();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    @ConfigurationProperties(prefix = &quot;spring.redis2&quot;)</span><br><span class="line">    public RedisStandaloneConfiguration redisConfig2()&#123;</span><br><span class="line">        return new RedisStandaloneConfiguration();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Bean()</span><br><span class="line">    @Primary</span><br><span class="line">    public RedisConnectionFactory connectionFactory(@Qualifier(&quot;redisConfig&quot;) RedisStandaloneConfiguration config, JedisPoolConfig poolConfig)&#123;</span><br><span class="line">        JedisClientConfiguration configuration = JedisClientConfiguration.builder().usePooling().poolConfig(poolConfig).build();</span><br><span class="line">        return new JedisConnectionFactory(config,configuration);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Bean()</span><br><span class="line">    public RedisConnectionFactory connectionFactory2(@Qualifier(&quot;redisConfig2&quot;) RedisStandaloneConfiguration config, JedisPoolConfig poolConfig)&#123;</span><br><span class="line">        JedisClientConfiguration configuration = JedisClientConfiguration.builder().usePooling().poolConfig(poolConfig).build();</span><br><span class="line">        return new JedisConnectionFactory(config,configuration);</span><br><span class="line">    &#125;</span><br><span class="line">    @Bean(&quot;jedisTemplate&quot;)</span><br><span class="line">    @Primary</span><br><span class="line">    public StringRedisTemplate redisTemplate(@Qualifier(&quot;connectionFactory&quot;) RedisConnectionFactory redisConnectionFactory)&#123;</span><br><span class="line">        return new StringRedisTemplate(redisConnectionFactory);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Bean(&quot;jedisTemplate2&quot;)</span><br><span class="line">    public StringRedisTemplate redisTemplate2(@Qualifier(&quot;connectionFactory2&quot;) RedisConnectionFactory redisConnectionFactory)&#123;</span><br><span class="line">        return new StringRedisTemplate(redisConnectionFactory);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="SpringBoot-整合-Dubbo"><a href="#SpringBoot-整合-Dubbo" class="headerlink" title="SpringBoot 整合 Dubbo"></a>SpringBoot 整合 Dubbo</h2><h3 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h3><h4 id="zk搭建"><a href="#zk搭建" class="headerlink" title="zk搭建"></a>zk搭建</h4><p><a href="https://mirrors.tuna.tsinghua.edu.cn/apache/zookeeper/" title="zk下载地址" target="_blank" rel="noopener">zk下载地址</a></p>
<ol>
<li>解压并打开文件夹进入conf目录</li>
<li>复制<code>zoo_sample.cfg</code>并重命名为 <code>zoo.cfg</code></li>
<li>进入bin目录下，运行zkServer.sh start</li>
</ol>
<h4 id="dubbo搭建"><a href="#dubbo搭建" class="headerlink" title="dubbo搭建"></a>dubbo搭建</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/apache/incubator-dubbo-admin.git</span><br><span class="line">cd incubator-dubbo-admin</span><br><span class="line">mvn clean package</span><br><span class="line">cd dubbo-admin-distribution/target</span><br><span class="line">java -jar dubbo-admin-0.1.jar</span><br></pre></td></tr></table></figure>
<p>详情见<a href="http://dubbo.apache.org/zh-cn/docs/admin/introduction.html" title="dubbo搭建" target="_blank" rel="noopener">dubbo管理台介绍</a></p>
<h3 id="项目结构"><a href="#项目结构" class="headerlink" title="项目结构"></a>项目结构</h3><ul>
<li>dubbo-demo<ul>
<li>demo-dubbo-annotation<ul>
<li>demo-dubbo-annotation-consumer</li>
<li>demo-dubbo-annotation-provider</li>
</ul>
</li>
<li>demo-dubbo-interface</li>
</ul>
</li>
</ul>
<h3 id="版本控制"><a href="#版本控制" class="headerlink" title="版本控制"></a>版本控制</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;properties&gt;</span><br><span class="line">    &lt;java.version&gt;1.8&lt;/java.version&gt;</span><br><span class="line">    &lt;zookeeper.version&gt;3.4.10&lt;/zookeeper.version&gt;</span><br><span class="line">    &lt;curator.version&gt;4.2.0&lt;/curator.version&gt;</span><br><span class="line">    &lt;dubbo.version&gt;2.7.1&lt;/dubbo.version&gt;</span><br><span class="line">&lt;/properties&gt;</span><br></pre></td></tr></table></figure>
<h3 id="demo-dubbo-interface"><a href="#demo-dubbo-interface" class="headerlink" title="demo-dubbo-interface"></a>demo-dubbo-interface</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">public interface DemoService &#123;</span><br><span class="line"></span><br><span class="line">    String sayHello(String name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>maven插件install到本地仓库</p>
<h3 id="demo-dubbo-annotation"><a href="#demo-dubbo-annotation" class="headerlink" title="demo-dubbo-annotation"></a>demo-dubbo-annotation</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;modules&gt;</span><br><span class="line">    &lt;module&gt;demo-dubbo-annotation-consumer&lt;/module&gt;</span><br><span class="line">    &lt;module&gt;demo-dubbo-annotation-provider&lt;/module&gt;</span><br><span class="line">&lt;/modules&gt;</span><br></pre></td></tr></table></figure>
<h4 id="demo-dubbo-annotation-provider"><a href="#demo-dubbo-annotation-provider" class="headerlink" title="demo-dubbo-annotation-provider"></a>demo-dubbo-annotation-provider</h4><h5 id="引入依赖pom-xml"><a href="#引入依赖pom-xml" class="headerlink" title="引入依赖pom.xml"></a>引入依赖pom.xml</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">    &lt;properties&gt;</span><br><span class="line">        &lt;java.version&gt;1.8&lt;/java.version&gt;</span><br><span class="line">        &lt;zookeeper.version&gt;3.4.10&lt;/zookeeper.version&gt;</span><br><span class="line">        &lt;curator.version&gt;4.2.0&lt;/curator.version&gt;</span><br><span class="line">        &lt;dubbo.version&gt;2.7.1&lt;/dubbo.version&gt;</span><br><span class="line">    &lt;/properties&gt;</span><br><span class="line"></span><br><span class="line">    &lt;repositories&gt;</span><br><span class="line">        &lt;repository&gt;</span><br><span class="line">            &lt;id&gt;sonatype-nexus-snapshots&lt;/id&gt;</span><br><span class="line">            &lt;url&gt;https://oss.sonatype.org/content/repositories/snapshots&lt;/url&gt;</span><br><span class="line">            &lt;releases&gt;</span><br><span class="line">                &lt;enabled&gt;false&lt;/enabled&gt;</span><br><span class="line">            &lt;/releases&gt;</span><br><span class="line">            &lt;snapshots&gt;</span><br><span class="line">                &lt;enabled&gt;true&lt;/enabled&gt;</span><br><span class="line">            &lt;/snapshots&gt;</span><br><span class="line">        &lt;/repository&gt;</span><br><span class="line">    &lt;/repositories&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;</span><br><span class="line">            &lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;demo.dubbo&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;demo-dubbo-interface&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &lt;!-- Dubbo Spring Boot Starter --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.apache.dubbo&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;dubbo-spring-boot-starter&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;$&#123;dubbo.version&#125;&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.apache.dubbo&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;dubbo&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;$&#123;dubbo.version&#125;&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!-- zookeeper --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.apache.zookeeper&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;zookeeper&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;$&#123;zookeeper.version&#125;&lt;/version&gt;</span><br><span class="line">            &lt;exclusions&gt;</span><br><span class="line">                &lt;exclusion&gt;</span><br><span class="line">                    &lt;groupId&gt;org.slf4j&lt;/groupId&gt;</span><br><span class="line">                    &lt;artifactId&gt;slf4j-log4j12&lt;/artifactId&gt;</span><br><span class="line">                &lt;/exclusion&gt;</span><br><span class="line">                &lt;exclusion&gt;</span><br><span class="line">                    &lt;groupId&gt;log4j&lt;/groupId&gt;</span><br><span class="line">                    &lt;artifactId&gt;log4j&lt;/artifactId&gt;</span><br><span class="line">                &lt;/exclusion&gt;</span><br><span class="line">                &lt;exclusion&gt;</span><br><span class="line">                    &lt;groupId&gt;io.netty&lt;/groupId&gt;</span><br><span class="line">                    &lt;artifactId&gt;netty&lt;/artifactId&gt;</span><br><span class="line">                &lt;/exclusion&gt;</span><br><span class="line">            &lt;/exclusions&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.apache.curator&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;curator-framework&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;$&#123;curator.version&#125;&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.apache.curator&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;curator-recipes&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;$&#123;curator.version&#125;&lt;/version&gt;</span><br><span class="line">            &lt;exclusions&gt;</span><br><span class="line">                &lt;exclusion&gt;</span><br><span class="line">                    &lt;groupId&gt;org.apache.zookeeper&lt;/groupId&gt;</span><br><span class="line">                    &lt;artifactId&gt;zookeeper&lt;/artifactId&gt;</span><br><span class="line">                &lt;/exclusion&gt;</span><br><span class="line">            &lt;/exclusions&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">    &lt;/dependencies&gt;</span><br><span class="line"></span><br><span class="line">    &lt;build&gt;</span><br><span class="line">        &lt;plugins&gt;</span><br><span class="line">            &lt;plugin&gt;</span><br><span class="line">                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;</span><br><span class="line">            &lt;/plugin&gt;</span><br><span class="line">        &lt;/plugins&gt;</span><br><span class="line">    &lt;/build&gt;</span><br><span class="line"></span><br><span class="line">&lt;/project&gt;</span><br></pre></td></tr></table></figure>
<p><strong>curator官方文档说道</strong>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ZooKeeper Version Compatibility</span><br><span class="line">While ZooKeeper 3.5.x is still considered &quot;beta&quot; by the ZooKeeper development team, the reality is that it is used in production by many users. However, ZooKeeper 3.4.x is also used in production. Prior to Apache Curator 4.0, both versions of ZooKeeper were supported via two versions of Apache Curator. Starting with Curator 4.0 both versions of ZooKeeper are supported via the same Curator libraries.</span><br><span class="line"></span><br><span class="line">ZooKeeper 3.5.x</span><br><span class="line">Curator 4.0 has a hard dependency on ZooKeeper 3.5.x</span><br><span class="line">If you are using ZooKeeper 3.5.x there&apos;s nothing additional to do - just use Curator 4.0</span><br><span class="line">ZooKeeper 3.4.x</span><br><span class="line">Curator 4.0 supports ZooKeeper 3.4.x ensembles in a soft-compatibility mode. To use this mode you must exclude ZooKeeper when adding Curator to your dependency management tool.</span><br></pre></td></tr></table></figure>
<blockquote>
<p>curator的官网写道3.5的zookeeper 虽然是Beta版，但用的人不少，要想4.0 的curator搭配3.4的ZooKeeper，需要在pom里移除zk依赖</p>
</blockquote>
<h5 id="DemoServiceImpl"><a href="#DemoServiceImpl" class="headerlink" title="DemoServiceImpl"></a>DemoServiceImpl</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">import com.demo.service.DemoService;</span><br><span class="line">import org.apache.dubbo.config.annotation.Service;</span><br><span class="line">import org.springframework.beans.factory.annotation.Value;</span><br><span class="line"></span><br><span class="line">@Service</span><br><span class="line">public class DemoServiceImpl implements DemoService &#123;</span><br><span class="line"></span><br><span class="line">    @Value(&quot;$&#123;dubbo.application.name&#125;&quot;)</span><br><span class="line">    private String serviceName;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String sayHello(String name) &#123;</span><br><span class="line">        return &quot;Hello &quot; + name + &quot;, this is &quot; + serviceName;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意这里的Service是dubbo包的，不要依赖成spring的了</p>
</blockquote>
<h5 id="application-yml-2"><a href="#application-yml-2" class="headerlink" title="application.yml"></a>application.yml</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">server:</span><br><span class="line">  port: 8081</span><br><span class="line"></span><br><span class="line">dubbo:</span><br><span class="line">  application:</span><br><span class="line">    name: dubboprovider</span><br><span class="line">  scan:</span><br><span class="line">    base-packages: demo.dubbo.demodubboannotationprovider.service</span><br><span class="line">  # Protocol Config</span><br><span class="line">  protocol:</span><br><span class="line">    name: dubbo</span><br><span class="line">    port: 20880</span><br><span class="line">  registry:</span><br><span class="line">    address: zookeeper://127.0.0.1:2181</span><br></pre></td></tr></table></figure>
<h4 id="demo-dubbo-annotation-consumer"><a href="#demo-dubbo-annotation-consumer" class="headerlink" title="demo-dubbo-annotation-consumer"></a>demo-dubbo-annotation-consumer</h4><h5 id="DemoController"><a href="#DemoController" class="headerlink" title="DemoController"></a>DemoController</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">import org.apache.dubbo.config.annotation.Reference;</span><br><span class="line">import org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line">import org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line">@RestController</span><br><span class="line">public class DemoController &#123;</span><br><span class="line"></span><br><span class="line">    @Reference</span><br><span class="line">    private DemoService demoService;</span><br><span class="line"></span><br><span class="line">    @GetMapping(&quot;/test&quot;)</span><br><span class="line">    public String test(String name)&#123;</span><br><span class="line">        return demoService.sayHello(name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="application-yml-3"><a href="#application-yml-3" class="headerlink" title="application.yml"></a>application.yml</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">dubbo:</span><br><span class="line">  application:</span><br><span class="line">    name: dubboconsumer</span><br><span class="line">  ## ProtocolConfig</span><br><span class="line">  protocol:</span><br><span class="line">    name: dubbo</span><br><span class="line">    port: 20880</span><br><span class="line">  scan:</span><br><span class="line">    base-packages: demo.dubbo.demodubboannotationconsumer.controller</span><br><span class="line">  registry:</span><br><span class="line">    address: zookeeper://127.0.0.1:2181</span><br><span class="line"></span><br><span class="line">server:</span><br><span class="line">  port: 8082</span><br></pre></td></tr></table></figure>
<p>启动服务，访问 <a href="http://localhos:8081/test?name=micheal" target="_blank" rel="noopener">http://localhos:8081/test?name=micheal</a></p>

        
    

    
</div>


                

                <!-- Post Comments -->
                
                    
                
            </div>

            <!-- Post Prev & Next Nav -->
            <nav class="material-nav mdl-color-text--grey-50 mdl-cell mdl-cell--12-col">
    <!-- Prev Nav -->
    
        <a href="/2019/04/18/MySQL/" id="post_nav-newer" class="prev-content">
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_back</i>
            </button>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            新篇
        </a>
    

    <!-- Section Spacer -->
    <div class="section-spacer"></div>

    <!-- Next Nav -->
    
        <a href="/2018/03/26/zipkin/" id="post_nav-older" class="next-content">
            旧篇
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_forward</i>
            </button>
        </a>
    
</nav>

        </div>
    </div>



                    
                        <!-- Overlay For Active Sidebar -->
<div class="sidebar-overlay"></div>

<!-- Material sidebar -->
<aside id="sidebar" class="sidebar sidebar-colored sidebar-fixed-left" role="navigation">
    <div id="sidebar-main">
        <!-- Sidebar Header -->
        <div class="sidebar-header header-cover" style="background-image: url(/img/sidebar_header.png);">
    <!-- Top bar -->
    <div class="top-bar"></div>

    <!-- Sidebar toggle button -->
    <button type="button" class="sidebar-toggle mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" style="display: initial;" data-upgraded=",MaterialButton,MaterialRipple">
        <i class="material-icons">clear_all</i>
        <span class="mdl-button__ripple-container">
            <span class="mdl-ripple">
            </span>
        </span>
    </button>

    <!-- Sidebar Avatar -->
    <div class="sidebar-image">
        <img src="/img/avatar.png" alt="WarmCute's avatar">
    </div>

    <!-- Sidebar Email -->
    <a data-toggle="dropdown" class="sidebar-brand" href="#settings-dropdown">
        youremail@email.com
        <b class="caret"></b>
    </a>
</div>


        <!-- Sidebar Navigation  -->
        <ul class="nav sidebar-nav">
    <!-- User dropdown  -->
    <li class="dropdown">
        <ul id="settings-dropdown" class="dropdown-menu">
            
                <li>
                    <a href="#" target="_blank" title="Email Me">
                        
                            <i class="material-icons sidebar-material-icons sidebar-indent-left1pc-element">email</i>
                        
                        Email Me
                    </a>
                </li>
            
        </ul>
    </li>

    <!-- Homepage -->
    
        <li id="sidebar-first-li">
            <a href="/">
                
                    <i class="material-icons sidebar-material-icons">home</i>
                
                主页
            </a>
        </li>
        
    

    <!-- Archives  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">inbox</i>
                
                    归档
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
            <li>
                <a class="sidebar_archives-link" href="/archives/2019/04/">四月 2019<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/03/">三月 2018<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/01/">一月 2018<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/12/">十二月 2017<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/11/">十一月 2017<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/10/">十月 2017<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/09/">九月 2017<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/04/">四月 2017<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/03/">三月 2017<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/01/">一月 2017<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/11/">十一月 2016<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/09/">九月 2016<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/08/">八月 2016<span class="sidebar_archives-count">1</span></a>
            </li></ul>
        </li>
        
    

    <!-- Categories  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">chrome_reader_mode</i>
                
                分类
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
                <li>
                <a class="sidebar_archives-link" href="/categories/JAVA基础/">JAVA基础<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/categories/SQL/">SQL<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/Spring/">Spring<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/Spring-Boot-2-1-X/">Spring Boot 2.1.X<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/分享/">分享<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/categories/基础/">基础<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/categories/数据库/">数据库<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/框架/">框架<span class="sidebar_archives-count">12</span></a></li><li><a class="sidebar_archives-link" href="/categories/检索/">检索<span class="sidebar_archives-count">1</span></a>
            </li></ul>
        </li>
        
    

    <!-- Pages  -->
    

    <!-- Article Number  -->
    
</ul>


        <!-- Sidebar Footer -->
        <!--
I'm glad you use this theme, the development is no so easy, I hope you can keep the copyright, I will thank you so much.
If you still want to delete the copyrights, could you still retain the first one? Which namely "Theme Material"
It will not impact the appearance and can give developers a lot of support :)

很高兴您使用并喜欢该主题，开发不易 十分谢谢与希望您可以保留一下版权声明。
如果您仍然想删除的话 能否只保留第一项呢？即 "Theme Material"
它不会影响美观并可以给开发者很大的支持和动力。 :)
-->

<!-- Sidebar Divider -->

    <div class="sidebar-divider"></div>


<!-- Theme Material -->

    <a href="https://github.com/viosey/hexo-theme-material" class="sidebar-footer-text-a" target="_blank">
        <div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
            主题 - Material
            <span class="sidebar-badge badge-circle">i</span>
        </div>
    </a>


<!-- Help & Support -->
<!--

-->

<!-- Feedback -->
<!--

-->

<!-- About Theme -->
<!--

-->

    </div>

    <!-- Sidebar Image -->
    

</aside>

                    

                    
                        <!-- Footer Top Button -->
                        <div id="back-to-top" class="toTop-wrap">
    <a href="#top" class="toTop">
        <i class="material-icons footer_top-i">expand_less</i>
    </a>
</div>

                    

                    <!--Footer-->
<footer class="mdl-mini-footer" id="bottom">
    
        <!-- Paradox Footer Left Section -->
        <div class="mdl-mini-footer--left-section sns-list">
    <!-- Twitter -->
    
        <a href="https://twitter.com/twitter" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-twitter">
                <span class="visuallyhidden">Twitter</span>
            </button><!--
     --></a>
    

    <!-- Facebook -->
    
        <a href="https://www.facebook.com/facebook" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-facebook">
                <span class="visuallyhidden">Facebook</span>
            </button><!--
     --></a>
    

    <!-- Google + -->
    
        <a href="https://www.google.com/" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-gplus">
                <span class="visuallyhidden">Google Plus</span>
            </button><!--
     --></a>
    

    <!-- Weibo -->
    

    <!-- Instagram -->
    

    <!-- Tumblr -->
    

    <!-- Github -->
    

    <!-- LinkedIn -->
    

    <!-- Zhihu -->
    

    <!-- Bilibili -->
    

    <!-- Telegram -->
    

    <!-- V2EX -->
    

    <!-- Segmentfault -->
    
</div>


        <!--Copyright-->
        <div id="copyright">
            Copyright&nbsp;©&nbsp;<span year></span>&nbsp;WarmCute's Blog
            
        </div>

        <!-- Paradox Footer Right Section -->

        <!--
        I am glad you use this theme, the development is no so easy, I hope you can keep the copyright.
        It will not impact the appearance and can give developers a lot of support :)

        很高兴您使用该主题，开发不易，希望您可以保留一下版权声明。
        它不会影响美观并可以给开发者很大的支持。 :)
        -->

        <div class="mdl-mini-footer--right-section">
            <div>
                <div class="footer-develop-div">Powered by <a href="https://hexo.io" target="_blank" class="footer-develop-a">Hexo</a></div>
                <div class="footer-develop-div">Theme - <a href="https://github.com/viosey/hexo-theme-material" target="_blank" class="footer-develop-a">Material</a></div>
            </div>
        </div>
    
</footer>


                    <!-- Import JS File -->

    <script>lsloader.load("lazyload_js","/js/lazyload.min.js?1BcfzuNXqV+ntF6gq+5X3Q==", true)</script>



    <script>lsloader.load("js_js","/js/js.min.js?Bn9UzEm8RrBSxqyZB0zPjA==", true)</script>



    <script>lsloader.load("np_js","/js/nprogress.js?pl3Qhb9lvqR1FlyLUna1Yw==", true)</script>


<script type="text/ls-javascript" id="NProgress-script">
    NProgress.configure({
        showSpinner: true
    });
    NProgress.start();
    $('#nprogress .bar').css({
        'background': '#29d'
    });
    $('#nprogress .peg').css({
        'box-shadow': '0 0 10px #29d, 0 0 15px #29d'
    });
    $('#nprogress .spinner-icon').css({
        'border-top-color': '#29d',
        'border-left-color': '#29d'
    });
    setTimeout(function() {
        NProgress.done();
        $('.fade').removeClass('out');
    }, 800);
</script>













<!-- UC Browser Compatible -->
<script>
	var agent = navigator.userAgent.toLowerCase();
	if(agent.indexOf('ucbrowser')>0) {
		document.write('<link rel="stylesheet" href="/css/uc.css">');
	   alert('由于 UC 浏览器使用极旧的内核，而本网站使用了一些新的特性。\n为了您能更好的浏览，推荐使用 Chrome 或 Firefox 浏览器。');
	}
</script>

<!-- Import prettify js  -->



<!-- Window Load -->
<!-- add class for prettify -->
<script type="text/ls-javascript" id="window-load">
    $(window).on('load', function() {
        // Post_Toc parent position fixed
        $('.post-toc-wrap').parent('.mdl-menu__container').css('position', 'fixed');
    });

    
    
</script>

<!-- MathJax Load-->


<!-- Bing Background -->


<script type="text/ls-javascript" id="lazy-load">
    // Offer LazyLoad
    queue.offer(function(){
        $('.lazy').lazyload({
            effect : 'show'
        });
    });

    // Start Queue
    $(document).ready(function(){
        setInterval(function(){
            queue.execNext();
        },200);
    });
</script>

<!-- Custom Footer -->



<script>
    var copyrightNow = new Date().getFullYear();
    var textContent = document.querySelector('span[year]')

    copyrightSince = 0000;
    if (copyrightSince === copyrightNow||copyrightSince === 0000) {
        textContent.textContent = copyrightNow
    } else {
        textContent.textContent = copyrightSince + ' - ' + copyrightNow
    }

    (function(){
        var scriptList = document.querySelectorAll('script[type="text/ls-javascript"]')

        for (var i = 0; i < scriptList.length; ++i) {
            var item = scriptList[i];
            lsloader.runInlineScript(item.id,item.id);
        }
    })()
console.log('\n %c © Material Theme | Version: 1.5.6 | https://github.com/viosey/hexo-theme-material %c \n', 'color:#455a64;background:#e0e0e0;padding:5px 0;border-top-left-radius:5px;border-bottom-left-radius:5px;', 'color:#455a64;background:#e0e0e0;padding:5px 0;border-top-right-radius:5px;border-bottom-right-radius:5px;');
</script>

                </main>
            </div>
        </body>
    
</html>
